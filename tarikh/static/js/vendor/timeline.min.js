/*
    TimelineJS - ver. 3.4.1 - 2016-10-04
    Copyright (c) 2012-2016 Northwestern University
    a project of the Northwestern University Knight Lab, originally created by Zach Wise
    https://github.com/NUKnightLab/TimelineJS3
    This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
    If a copy of the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/
function TL_Error(a,b){this.name="TL.Error",this.message=a||"error",this.message_key=this.message,this.detail=b||"";var c=new Error;c.hasOwnProperty("stack")&&(this.stack=c.stack)}!function(a){a.TL={VERSION:"0.1",_originalL:a.TL}}(this),TL.debug=!1,TL.Bind=function(a,b){return function(){return a.apply(b,arguments)}},trace=function(a){TL.debug&&(window.console?console.log(a):"undefined"!=typeof jsTrace&&jsTrace.send(a))},TL_Error.prototype=Object.create(Error.prototype),TL_Error.prototype.constructor=TL_Error,TL.Error=TL_Error,TL.Util={mergeData:function(a,b){var c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);return a},extend:function(a){for(var e,b=Array.prototype.slice.call(arguments,1),c=0,d=b.length;c<d;c++)e=b[c]||{},TL.Util.mergeData(a,e);return a},isEven:function(a){return a==parseFloat(a)?!(a%2):void 0},isTrue:function(a){return null!=a&&(1==a||"true"==String(a).toLowerCase()||1==Number(a))},findArrayNumberByUniqueID:function(a,b,c,d){for(var e=d||0,f=0;f<b.length;f++)b[f].data[c]==a&&(e=f);return e},convertUnixTime:function(a){var b,c,d,e,f,g,h=[],i={ymd:"",time:"",time_array:[],date_array:[],full_array:[]};i.ymd=a.split(" ")[0],i.time=a.split(" ")[1],i.date_array=i.ymd.split("-"),i.time_array=i.time.split(":"),i.full_array=i.date_array.concat(i.time_array);for(var j=0;j<i.full_array.length;j++)h.push(parseInt(i.full_array[j]));return b=new Date(h[0],h[1],h[2],h[3],h[4],h[5]),c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],d=b.getFullYear(),e=c[b.getMonth()],f=b.getDate(),g=e+", "+f+" "+d},setData:function(a,b){a.data=TL.Util.extend({},a.data,b),""===a.data.unique_id&&(a.data.unique_id=TL.Util.unique_ID(6))},stamp:function(){var a=0,b="_tl_id";return function(c){return c[b]=c[b]||++a,c[b]}}(),isArray:function(){if(Array.isArray)return Array.isArray;var a=Object.prototype.toString,b=a.call([]);return function(c){return a.call(c)===b}}(),getRandomNumber:function(a){return Math.floor(Math.random()*a)},unique_ID:function(a,b){var c=function(a){return Math.floor(Math.random()*a)},d=function(){var a="abcdefghijklmnopqurstuvwxyz";return a.substr(c(32),1)},e=function(a){for(var b="",c=0;c<a;c++)b+=d();return b};return b?b+"-"+e(a):"tl-"+e(a)},ensureUniqueKey:function(a,b){if(b||(b=TL.Util.unique_ID(6)),!(b in a))return b;var c=b.match(/^(.+)(-\d+)?$/)[1],d=[];for(key in a)key.match(/^(.+?)(-\d+)?$/)[1]==c&&d.push(key);b=c+"-"+(d.length+1);for(var e=d.length;d.indexOf(b)!=-1;e++)b=c+"-"+e;return b},htmlify:function(a){return a.match(/<p>[\s\S]*?<\/p>/)?a:"<p>"+a+"</p>"},linkify:function(a,b,c){var d=function(a,b,c){c||(c="");var d=30;return b&&b.length>d&&(b=b.substring(0,d)+"\u2026"),c+"<a class='tl-makelink' href='"+a+"' onclick='void(0)'>"+b+"</a>"},e=/\b(?:https?|ftp):\/\/([a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|])/gim,f=/(^|[^\/>])(www\.[\S]+(\b|$))/gim,g=/([a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+)/gim;return a.replace(e,function(a,b,c,e){if(c>0){var f=e[c-1];if('"'==f||"'"==f||"="==f)return a}return d(a,b)}).replace(f,function(a,b,c,e,f){return d("http://"+c,c,b)}).replace(g,function(a,b,c,e){return d("mailto:"+b,b)})},unlinkify:function(a){return a?(a=a.replace(/<a\b[^>]*>/i,""),a=a.replace(/<\/a>/i,"")):a},getParamString:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+"="+a[c]);return"?"+b.join("&")},formatNum:function(a,b){var c=Math.pow(10,b||5);return Math.round(a*c)/c},falseFn:function(){return!1},requestAnimFrame:function(){function a(a){window.setTimeout(a,1e3/60)}var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||a;return function(c,d,e,f){c=d?TL.Util.bind(c,d):c,e&&b===a?c():b(c,f)}}(),bind:function(a,b){return function(){return a.apply(b,arguments)}},template:function(a,b){return a.replace(/\{ *([\w_]+) *\}/g,function(a,c){var d=b[c];if(!b.hasOwnProperty(c))throw new TL.Error("template_value_err",a);return d})},hexToRgb:function(a){TL.Util.css_named_colors[a.toLowerCase()]&&(a=TL.Util.css_named_colors[a.toLowerCase()]);var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},rgbToHex:function(a){var b,c,d;if("object"==typeof a)b=a.r,c=a.g,d=a.b;else if("function"==typeof a.match){var e=a.match(/^rgb\((\d+),(\d+),(\d+)\)$/);e&&(b=e[1],c=e[2],d=e[3])}if(isNaN(b)||isNaN(d)||isNaN(c))throw new TL.Error("invalid_rgb_err");return"#"+TL.Util.intToHexString(b)+TL.Util.intToHexString(c)+TL.Util.intToHexString(d)},colorObjToHex:function(a){var b=[a.r,a.g,a.b];return TL.Util.rgbToHex("rgb("+b.join(",")+")")},css_named_colors:{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},ratio:{square:function(a){var b={w:0,h:0};return a.w>a.h&&a.h>0?(b.h=a.h,b.w=a.h):(b.w=a.w,b.h=a.w),b},r16_9:function(a){return null!==a.w&&""!==a.w?Math.round(a.w/16*9):null!==a.h&&""!==a.h?Math.round(a.h/9*16):0},r4_3:function(a){return null!==a.w&&""!==a.w?Math.round(a.w/4*3):null!==a.h&&""!==a.h?Math.round(a.h/3*4):void 0}},getObjectAttributeByIndex:function(a,b){if("undefined"!=typeof a){var c=0;for(var d in a){if(b===c)return a[d];c++}return""}return""},getUrlVars:function(a){var b,d,e,c=[];b=a.toString(),b.match("&#038;")?b=b.replace("&#038;","&"):b.match("&#38;")?b=b.replace("&#38;","&"):b.match("&amp;")&&(b=b.replace("&amp;","&")),e=b.slice(b.indexOf("?")+1).split("&");for(var f=0;f<e.length;f++)d=e[f].split("="),c.push(d[0]),c[d[0]]=d[1];return c},trim:function(a){return a&&"function"==typeof a.replace?a.replace(/^\s+|\s+$/g,""):""},slugify:function(a){a=TL.Util.trim(a),a=a.toLowerCase();for(var b="Ã£Ã Ã¡Ã¤Ã¢áº½Ã¨Ã©Ã«ÃªÃ¬Ã­Ã¯Ã®ÃµÃ²Ã³Ã¶Ã´Ã¹ÃºÃ¼Ã»Ã±Ã§Â·/_,:;",c="aaaaaeeeeeiiiiooooouuuunc------",d=0,e=b.length;d<e;d++)a=a.replace(new RegExp(b.charAt(d),"g"),c.charAt(d));return a=a.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),a=a.replace(/^([0-9])/,"_$1")},maxDepth:function(a){for(var b=[],c=0,d=0;d<a.length;d++){if(b.push(a[d]),b.length>1){for(var e=b[b.length-1],f=-1,g=0;g<b.length-1;g++)b[g][1]<e[0]&&(f=g);f>=0&&(b=b.slice(f+1))}b.length>c&&(c=b.length)}return c},pad:function(a,b){for(a=String(a),b=b||2;a.length<b;)a="0"+a;return a},intToHexString:function(a){return TL.Util.pad(parseInt(a,10).toString(16))},findNextGreater:function(a,b,c){for(var d=0;d<a.length;d++)if(b<a[d])return a[d];return c?c:b},findNextLesser:function(a,b,c){for(var d=a.length-1;d>=0;d--)if(b>a[d])return a[d];return c?c:b},isEmptyObject:function(a){var b=[];if(Object.keys)b=Object.keys(a);else for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);for(var d=0;d<b.length;d++){var e=b[d];if(null!=a[e]&&"string"!=typeof a[e])return!1;if(0!=TL.Util.trim(a[e]).length)return!1}return!0},parseYouTubeTime:function(a){if("string"==typeof a){if(parts=a.match(/^\s*(\d+h)?(\d+m)?(\d+s)?\s*/i),parts){var b=parseInt(parts[1])||0,c=parseInt(parts[2])||0,d=parseInt(parts[3])||0;return d+60*c+60*b*60}}else if("number"==typeof a)return a;return 0},transformImageURL:function(a){return a.replace(/(.*)www.dropbox.com\/(.*)/,"$1dl.dropboxusercontent.com/$2")},base58:function(a){var b=a||"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ",c=b.length;return{encode:function(a){if("number"!=typeof a||a!==parseInt(a))throw'"encode" only accepts integers.';for(var d="";a;){var e=a%c;a=Math.floor(a/c),d=b[e].toString()+d}return d},decode:function(a){if("string"!=typeof a)throw'"decode" only accepts strings.';for(var d=0;a;){var e=b.indexOf(a[0]);if(e<0)throw'"decode" can\'t find "'+a[0]+'" in the alphabet: "'+b+'"';var f=a.length-1;d+=e*Math.pow(c,f),a=a.substring(1)}return d}}}()},function(a){var b=function(){function H(a){return null==a?String(a):z[A.call(a)]||"object"}function I(a){return"function"==H(a)}function J(a){return null!=a&&a==a.window}function K(a){return null!=a&&a.nodeType==a.DOCUMENT_NODE}function L(a){return"object"==H(a)}function M(a){return L(a)&&!J(a)&&Object.getPrototypeOf(a)==Object.prototype}function N(a){return"number"==typeof a.length}function O(a){return g.call(a,function(a){return null!=a})}function P(a){return a.length>0?c.fn.concat.apply([],a):a}function Q(a){return a.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function R(a){return a in j?j[a]:j[a]=new RegExp("(^|\\s)"+a+"(\\s|$)")}function S(a,b){return"number"!=typeof b||k[Q(a)]?b:b+"px"}function T(a){var b,c;return i[a]||(b=h.createElement(a),h.body.appendChild(b),c=getComputedStyle(b,"").getPropertyValue("display"),b.parentNode.removeChild(b),"none"==c&&(c="block"),i[a]=c),i[a]}function U(a){return"children"in a?f.call(a.children):c.map(a.childNodes,function(a){if(1==a.nodeType)return a})}function V(c,d,e){for(b in d)e&&(M(d[b])||G(d[b]))?(M(d[b])&&!M(c[b])&&(c[b]={}),G(d[b])&&!G(c[b])&&(c[b]=[]),V(c[b],d[b],e)):d[b]!==a&&(c[b]=d[b])}function W(a,b){return null==b?c(a):c(a).filter(b)}function X(a,b,c,d){return I(b)?b.call(a,c,d):b}function Y(a,b,c){null==c?a.removeAttribute(b):a.setAttribute(b,c)}function Z(b,c){var d=b.className,e=d&&d.baseVal!==a;return c===a?e?d.baseVal:d:void(e?d.baseVal=c:b.className=c)}function $(a){var b;try{return a?"true"==a||"false"!=a&&("null"==a?null:/^0/.test(a)||isNaN(b=Number(a))?/^[\[\{]/.test(a)?c.parseJSON(a):a:b):a}catch(b){return a}}function _(a,b){b(a);for(var c in a.childNodes)_(a.childNodes[c],b)}var a,b,c,d,C,D,e=[],f=e.slice,g=e.filter,h=window.document,i={},j={},k={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},l=/^\s*<(\w+|!)[^>]*>/,m=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,n=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,o=/^(?:body|html)$/i,p=/([A-Z])/g,q=["val","css","html","text","data","width","height","offset"],r=["after","prepend","before","append"],s=h.createElement("table"),t=h.createElement("tr"),u={tr:h.createElement("tbody"),tbody:s,thead:s,tfoot:s,td:t,th:t,"*":h.createElement("div")},v=/complete|loaded|interactive/,y=/^[\w-]*$/,z={},A=z.toString,B={},E=h.createElement("div"),F={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},G=Array.isArray||function(a){return a instanceof Array};return B.matches=function(a,b){if(!b||!a||1!==a.nodeType)return!1;var c=a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.matchesSelector;if(c)return c.call(a,b);var d,e=a.parentNode,f=!e;return f&&(e=E).appendChild(a),d=~B.qsa(e,b).indexOf(a),f&&E.removeChild(a),d},C=function(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})},D=function(a){return g.call(a,function(b,c){return a.indexOf(b)==c})},B.fragment=function(b,d,e){var g,i,j;return m.test(b)&&(g=c(h.createElement(RegExp.$1))),g||(b.replace&&(b=b.replace(n,"<$1></$2>")),d===a&&(d=l.test(b)&&RegExp.$1),d in u||(d="*"),j=u[d],j.innerHTML=""+b,g=c.each(f.call(j.childNodes),function(){j.removeChild(this)})),M(e)&&(i=c(g),c.each(e,function(a,b){q.indexOf(a)>-1?i[a](b):i.attr(a,b)})),g},B.Z=function(a,b){return a=a||[],a.__proto__=c.fn,a.selector=b||"",a},B.isZ=function(a){return a instanceof B.Z},B.init=function(b,d){var e;if(!b)return B.Z();if("string"==typeof b)if(b=b.trim(),"<"==b[0]&&l.test(b))e=B.fragment(b,RegExp.$1,d),b=null;else{if(d!==a)return c(d).find(b);e=B.qsa(h,b)}else{if(I(b))return c(h).ready(b);if(B.isZ(b))return b;if(G(b))e=O(b);else if(L(b))e=[b],b=null;else if(l.test(b))e=B.fragment(b.trim(),RegExp.$1,d),b=null;else{if(d!==a)return c(d).find(b);e=B.qsa(h,b)}}return B.Z(e,b)},c=function(a,b){return B.init(a,b)},c.extend=function(a){var b,c=f.call(arguments,1);return"boolean"==typeof a&&(b=a,a=c.shift()),c.forEach(function(c){V(a,c,b)}),a},B.qsa=function(a,b){var c,d="#"==b[0],e=!d&&"."==b[0],g=d||e?b.slice(1):b,h=y.test(g);return K(a)&&h&&d?(c=a.getElementById(g))?[c]:[]:1!==a.nodeType&&9!==a.nodeType?[]:f.call(h&&!d?e?a.getElementsByClassName(g):a.getElementsByTagName(b):a.querySelectorAll(b))},c.contains=function(a,b){return a!==b&&a.contains(b)},c.type=H,c.isFunction=I,c.isWindow=J,c.isArray=G,c.isPlainObject=M,c.isEmptyObject=function(a){var b;for(b in a)return!1;return!0},c.inArray=function(a,b,c){return e.indexOf.call(b,a,c)},c.camelCase=C,c.trim=function(a){return null==a?"":String.prototype.trim.call(a)},c.uuid=0,c.support={},c.expr={},c.map=function(a,b){var c,e,f,d=[];if(N(a))for(e=0;e<a.length;e++)c=b(a[e],e),null!=c&&d.push(c);else for(f in a)c=b(a[f],f),null!=c&&d.push(c);return P(d)},c.each=function(a,b){var c,d;if(N(a)){for(c=0;c<a.length;c++)if(b.call(a[c],c,a[c])===!1)return a}else for(d in a)if(b.call(a[d],d,a[d])===!1)return a;return a},c.grep=function(a,b){return g.call(a,b)},window.JSON&&(c.parseJSON=JSON.parse),c.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){z["[object "+b+"]"]=b.toLowerCase()}),c.fn={forEach:e.forEach,reduce:e.reduce,push:e.push,sort:e.sort,indexOf:e.indexOf,concat:e.concat,map:function(a){return c(c.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return c(f.apply(this,arguments))},ready:function(a){return v.test(h.readyState)&&h.body?a(c):h.addEventListener("DOMContentLoaded",function(){a(c)},!1),this},get:function(b){return b===a?f.call(this):this[b>=0?b:b+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(a){return e.every.call(this,function(b,c){return a.call(b,c,b)!==!1}),this},filter:function(a){return I(a)?this.not(this.not(a)):c(g.call(this,function(b){return B.matches(b,a)}))},add:function(a,b){return c(D(this.concat(c(a,b))))},is:function(a){return this.length>0&&B.matches(this[0],a)},not:function(b){var d=[];if(I(b)&&b.call!==a)this.each(function(a){b.call(this,a)||d.push(this)});else{var e="string"==typeof b?this.filter(b):N(b)&&I(b.item)?f.call(b):c(b);this.forEach(function(a){e.indexOf(a)<0&&d.push(a)})}return c(d)},has:function(a){return this.filter(function(){return L(a)?c.contains(this,a):c(this).find(a).size()})},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){var a=this[0];return a&&!L(a)?a:c(a)},last:function(){var a=this[this.length-1];return a&&!L(a)?a:c(a)},find:function(a){var b,d=this;return b="object"==typeof a?c(a).filter(function(){var a=this;return e.some.call(d,function(b){return c.contains(b,a)})}):1==this.length?c(B.qsa(this[0],a)):this.map(function(){return B.qsa(this,a)})},closest:function(a,b){var d=this[0],e=!1;for("object"==typeof a&&(e=c(a));d&&!(e?e.indexOf(d)>=0:B.matches(d,a));)d=d!==b&&!K(d)&&d.parentNode;return c(d)},parents:function(a){for(var b=[],d=this;d.length>0;)d=c.map(d,function(a){if((a=a.parentNode)&&!K(a)&&b.indexOf(a)<0)return b.push(a),a});return W(b,a)},parent:function(a){return W(D(this.pluck("parentNode")),a)},children:function(a){return W(this.map(function(){return U(this)}),a)},contents:function(){return this.map(function(){return f.call(this.childNodes)})},siblings:function(a){return W(this.map(function(a,b){return g.call(U(b.parentNode),function(a){return a!==b})}),a)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(a){return c.map(this,function(b){return b[a]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=T(this.nodeName))})},replaceWith:function(a){return this.before(a).remove()},wrap:function(a){var b=I(a);if(this[0]&&!b)var d=c(a).get(0),e=d.parentNode||this.length>1;return this.each(function(f){c(this).wrapAll(b?a.call(this,f):e?d.cloneNode(!0):d)})},wrapAll:function(a){if(this[0]){c(this[0]).before(a=c(a));for(var b;(b=a.children()).length;)a=b.first();c(a).append(this)}return this},wrapInner:function(a){var b=I(a);return this.each(function(d){var e=c(this),f=e.contents(),g=b?a.call(this,d):a;f.length?f.wrapAll(g):e.append(g)})},unwrap:function(){return this.parent().each(function(){c(this).replaceWith(c(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(b){return this.each(function(){var d=c(this);(b===a?"none"==d.css("display"):b)?d.show():d.hide()})},prev:function(a){return c(this.pluck("previousElementSibling")).filter(a||"*")},next:function(a){return c(this.pluck("nextElementSibling")).filter(a||"*")},html:function(a){return 0===arguments.length?this.length>0?this[0].innerHTML:null:this.each(function(b){var d=this.innerHTML;c(this).empty().append(X(this,a,b,d))})},text:function(b){return 0===arguments.length?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=b===a?"":""+b})},attr:function(c,d){var e;return"string"==typeof c&&d===a?0==this.length||1!==this[0].nodeType?a:"value"==c&&"INPUT"==this[0].nodeName?this.val():!(e=this[0].getAttribute(c))&&c in this[0]?this[0][c]:e:this.each(function(a){if(1===this.nodeType)if(L(c))for(b in c)Y(this,b,c[b]);else Y(this,c,X(this,d,a,this.getAttribute(c)))})},removeAttr:function(a){return this.each(function(){1===this.nodeType&&Y(this,a)})},prop:function(b,c){return b=F[b]||b,c===a?this[0]&&this[0][b]:this.each(function(a){this[b]=X(this,c,a,this[b])})},data:function(b,c){var d=this.attr("data-"+b.replace(p,"-$1").toLowerCase(),c);return null!==d?$(d):a},val:function(a){return 0===arguments.length?this[0]&&(this[0].multiple?c(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value):this.each(function(b){this.value=X(this,a,b,this.value)})},offset:function(a){if(a)return this.each(function(b){var d=c(this),e=X(this,a,b,d.offset()),f=d.offsetParent().offset(),g={top:e.top-f.top,left:e.left-f.left};"static"==d.css("position")&&(g.position="relative"),d.css(g)});if(0==this.length)return null;var b=this[0].getBoundingClientRect();return{left:b.left+window.pageXOffset,top:b.top+window.pageYOffset,width:Math.round(b.width),height:Math.round(b.height)}},css:function(a,d){if(arguments.length<2){var e=this[0],f=getComputedStyle(e,"");if(!e)return;if("string"==typeof a)return e.style[C(a)]||f.getPropertyValue(a);if(G(a)){var g={};return c.each(G(a)?a:[a],function(a,b){g[b]=e.style[C(b)]||f.getPropertyValue(b)}),g}}var h="";if("string"==H(a))d||0===d?h=Q(a)+":"+S(a,d):this.each(function(){this.style.removeProperty(Q(a))});else for(b in a)a[b]||0===a[b]?h+=Q(b)+":"+S(b,a[b])+";":this.each(function(){this.style.removeProperty(Q(b))});return this.each(function(){this.style.cssText+=";"+h})},index:function(a){return a?this.indexOf(c(a)[0]):this.parent().children().indexOf(this[0])},hasClass:function(a){return!!a&&e.some.call(this,function(a){return this.test(Z(a))},R(a))},addClass:function(a){return a?this.each(function(b){d=[];var e=Z(this),f=X(this,a,b,e);f.split(/\s+/g).forEach(function(a){c(this).hasClass(a)||d.push(a)},this),d.length&&Z(this,e+(e?" ":"")+d.join(" "))}):this},removeClass:function(b){return this.each(function(c){return b===a?Z(this,""):(d=Z(this),X(this,b,c,d).split(/\s+/g).forEach(function(a){d=d.replace(R(a)," ")}),void Z(this,d.trim()))})},toggleClass:function(b,d){return b?this.each(function(e){var f=c(this),g=X(this,b,e,Z(this));g.split(/\s+/g).forEach(function(b){(d===a?!f.hasClass(b):d)?f.addClass(b):f.removeClass(b)})}):this},scrollTop:function(b){if(this.length){var c="scrollTop"in this[0];return b===a?c?this[0].scrollTop:this[0].pageYOffset:this.each(c?function(){this.scrollTop=b}:function(){this.scrollTo(this.scrollX,b)})}},scrollLeft:function(b){if(this.length){var c="scrollLeft"in this[0];return b===a?c?this[0].scrollLeft:this[0].pageXOffset:this.each(c?function(){this.scrollLeft=b}:function(){this.scrollTo(b,this.scrollY)})}},position:function(){if(this.length){var a=this[0],b=this.offsetParent(),d=this.offset(),e=o.test(b[0].nodeName)?{top:0,left:0}:b.offset();return d.top-=parseFloat(c(a).css("margin-top"))||0,d.left-=parseFloat(c(a).css("margin-left"))||0,e.top+=parseFloat(c(b[0]).css("border-top-width"))||0,e.left+=parseFloat(c(b[0]).css("border-left-width"))||0,{top:d.top-e.top,left:d.left-e.left}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||h.body;a&&!o.test(a.nodeName)&&"static"==c(a).css("position");)a=a.offsetParent;return a})}},c.fn.detach=c.fn.remove,["width","height"].forEach(function(b){var d=b.replace(/./,function(a){return a[0].toUpperCase()});c.fn[b]=function(e){var f,g=this[0];return e===a?J(g)?g["inner"+d]:K(g)?g.documentElement["scroll"+d]:(f=this.offset())&&f[b]:this.each(function(a){g=c(this),g.css(b,X(this,e,a,g[b]()))})}}),r.forEach(function(a,b){var d=b%2;c.fn[a]=function(){var a,f,e=c.map(arguments,function(b){return a=H(b),"object"==a||"array"==a||null==b?b:B.fragment(b)}),g=this.length>1;return e.length<1?this:this.each(function(a,h){f=d?h:h.parentNode,h=0==b?h.nextSibling:1==b?h.firstChild:2==b?h:null,e.forEach(function(a){if(g)a=a.cloneNode(!0);else if(!f)return c(a).remove();_(f.insertBefore(a,h),function(a){null==a.nodeName||"SCRIPT"!==a.nodeName.toUpperCase()||a.type&&"text/javascript"!==a.type||a.src||window.eval.call(window,a.innerHTML)})})})},c.fn[d?a+"To":"insert"+(b?"Before":"After")]=function(b){return c(b)[a](this),this}}),B.Z.prototype=c.fn,B.uniq=D,B.deserializeValue=$,c.zepto=B,c}();window.Zepto=b,void 0===window.$&&(window.$=b),function(a){function m(a){return a._zid||(a._zid=c++)}function n(a,b,c,d){if(b=o(b),b.ns)var e=p(b.ns);return(h[m(a)]||[]).filter(function(a){return a&&(!b.e||a.e==b.e)&&(!b.ns||e.test(a.ns))&&(!c||m(a.fn)===m(c))&&(!d||a.sel==d)})}function o(a){var b=(""+a).split(".");return{e:b[0],ns:b.slice(1).sort().join(" ")}}function p(a){return new RegExp("(?:^| )"+a.replace(" "," .* ?")+"(?: |$)")}function q(a,b){return a.del&&!j&&a.e in k||!!b}function r(a){return l[a]||j&&k[a]||a}function s(b,c,e,f,g,i,j){var k=m(b),n=h[k]||(h[k]=[]);c.split(/\s/).forEach(function(c){if("ready"==c)return a(document).ready(e);var h=o(c);h.fn=e,h.sel=g,h.e in l&&(e=function(b){var c=b.relatedTarget;if(!c||c!==this&&!a.contains(this,c))return h.fn.apply(this,arguments)}),h.del=i;var k=i||e;h.proxy=function(a){if(a=y(a),!a.isImmediatePropagationStopped()){a.data=f;var c=k.apply(b,a._args==d?[a]:[a].concat(a._args));return c===!1&&(a.preventDefault(),a.stopPropagation()),c}},h.i=n.length,n.push(h),"addEventListener"in b&&b.addEventListener(r(h.e),h.proxy,q(h,j))})}function t(a,b,c,d,e){var f=m(a);(b||"").split(/\s/).forEach(function(b){n(a,b,c,d).forEach(function(b){delete h[f][b.i],"removeEventListener"in a&&a.removeEventListener(r(b.e),b.proxy,q(b,e))})})}function y(b,c){return!c&&b.isDefaultPrevented||(c||(c=b),a.each(x,function(a,d){var e=c[a];b[a]=function(){return this[d]=u,e&&e.apply(c,arguments)},b[d]=v}),(c.defaultPrevented!==d?c.defaultPrevented:"returnValue"in c?c.returnValue===!1:c.getPreventDefault&&c.getPreventDefault())&&(b.isDefaultPrevented=u)),b}function z(a){var b,c={originalEvent:a};for(b in a)w.test(b)||a[b]===d||(c[b]=a[b]);return y(c,a)}var d,c=(a.zepto.qsa,1),e=Array.prototype.slice,f=a.isFunction,g=function(a){return"string"==typeof a},h={},i={},j="onfocusin"in window,k={focus:"focusin",blur:"focusout"},l={mouseenter:"mouseover",mouseleave:"mouseout"};i.click=i.mousedown=i.mouseup=i.mousemove="MouseEvents",a.event={add:s,remove:t},a.proxy=function(b,c){if(f(b)){var d=function(){return b.apply(c,arguments)};return d._zid=m(b),d}if(g(c))return a.proxy(b[c],b);throw new TypeError("expected function")},a.fn.bind=function(a,b,c){return this.on(a,b,c)},a.fn.unbind=function(a,b){return this.off(a,b)},a.fn.one=function(a,b,c,d){return this.on(a,b,c,d,1)};var u=function(){return!0},v=function(){return!1},w=/^([A-Z]|returnValue$|layer[XY]$)/,x={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};a.fn.delegate=function(a,b,c){return this.on(b,a,c)},a.fn.undelegate=function(a,b,c){return this.off(b,a,c)},a.fn.live=function(b,c){return a(document.body).delegate(this.selector,b,c),this},a.fn.die=function(b,c){return a(document.body).undelegate(this.selector,b,c),this},a.fn.on=function(b,c,h,i,j){var k,l,m=this;return b&&!g(b)?(a.each(b,function(a,b){m.on(a,c,h,b,j)}),m):(g(c)||f(i)||i===!1||(i=h,h=c,c=d),(f(h)||h===!1)&&(i=h,h=d),i===!1&&(i=v),m.each(function(d,f){j&&(k=function(a){return t(f,a.type,i),i.apply(this,arguments)}),c&&(l=function(b){var d,g=a(b.target).closest(c,f).get(0);if(g&&g!==f)return d=a.extend(z(b),{currentTarget:g,liveFired:f}),(k||i).apply(g,[d].concat(e.call(arguments,1)))}),s(f,b,i,h,c,l||k)}))},a.fn.off=function(b,c,e){var h=this;return b&&!g(b)?(a.each(b,function(a,b){h.off(a,c,b)}),h):(g(c)||f(e)||e===!1||(e=c,c=d),e===!1&&(e=v),h.each(function(){t(this,b,e,c)}))},a.fn.trigger=function(b,c){return b=g(b)||a.isPlainObject(b)?a.Event(b):y(b),b._args=c,this.each(function(){"dispatchEvent"in this?this.dispatchEvent(b):a(this).triggerHandler(b,c)})},a.fn.triggerHandler=function(b,c){var d,e;return this.each(function(f,h){d=z(g(b)?a.Event(b):b),d._args=c,d.target=h,a.each(n(h,b.type||b),function(a,b){if(e=b.proxy(d),d.isImmediatePropagationStopped())return!1})}),e},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(b){a.fn[b]=function(a){return a?this.bind(b,a):this.trigger(b)}}),["focus","blur"].forEach(function(b){a.fn[b]=function(a){return a?this.bind(b,a):this.each(function(){try{this[b]()}catch(a){}}),this}}),a.Event=function(a,b){g(a)||(b=a,a=b.type);var c=document.createEvent(i[a]||"Events"),d=!0;if(b)for(var e in b)"bubbles"==e?d=!!b[e]:c[e]=b[e];return c.initEvent(a,d,!0),y(c)}}(b),function(a){function l(b,c,d){var e=a.Event(c);return a(b).trigger(e,d),!e.isDefaultPrevented()}function m(a,b,d,e){if(a.global)return l(b||c,d,e)}function n(b){b.global&&0===a.active++&&m(b,null,"ajaxStart")}function o(b){b.global&&!--a.active&&m(b,null,"ajaxStop")}function p(a,b){var c=b.context;return b.beforeSend.call(c,a,b)!==!1&&m(b,c,"ajaxBeforeSend",[a,b])!==!1&&void m(b,c,"ajaxSend",[a,b])}function q(a,b,c,d){var e=c.context,f="success";c.success.call(e,a,f,b),d&&d.resolveWith(e,[a,f,b]),m(c,e,"ajaxSuccess",[b,c,a]),s(f,b,c)}function r(a,b,c,d,e){var f=d.context;d.error.call(f,c,b,a),e&&e.rejectWith(f,[c,b,a]),m(d,f,"ajaxError",[c,d,a||b]),s(b,c,d)}function s(a,b,c){var d=c.context;c.complete.call(d,b,a),m(c,d,"ajaxComplete",[b,c]),o(c)}function t(){}function u(a){return a&&(a=a.split(";",2)[0]),a&&(a==j?"html":a==i?"json":g.test(a)?"script":h.test(a)&&"xml")||"text"}function v(a,b){return""==b?a:(a+"&"+b).replace(/[&?]{1,2}/,"?")}function w(b){b.processData&&b.data&&"string"!=a.type(b.data)&&(b.data=a.param(b.data,b.traditional)),!b.data||b.type&&"GET"!=b.type.toUpperCase()||(b.url=v(b.url,b.data),b.data=void 0)}function x(b,c,d,e){var f=!a.isFunction(c);return{url:b,data:f?c:void 0,success:f?a.isFunction(d)?d:void 0:c,dataType:f?e||d:d}}function z(b,c,d,e){var f,g=a.isArray(c),h=a.isPlainObject(c);a.each(c,function(c,i){f=a.type(i),e&&(c=d?e:e+"["+(h||"object"==f||"array"==f?c:"")+"]"),!e&&g?b.add(i.name,i.value):"array"==f||!d&&"object"==f?z(b,i,d,c):b.add(c,i)})}var d,e,b=0,c=window.document,f=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,g=/^(?:text|application)\/javascript/i,h=/^(?:text|application)\/xml/i,i="application/json",j="text/html",k=/^\s*$/;a.active=0,a.ajaxJSONP=function(d,e){if(!("type"in d))return a.ajax(d);var j,m,f=d.jsonpCallback,g=(a.isFunction(f)?f():f)||"jsonp"+ ++b,h=c.createElement("script"),i=window[g],k=function(b){a(h).triggerHandler("error",b||"abort")},l={abort:k};return e&&e.promise(l),a(h).on("load error",function(b,c){clearTimeout(m),a(h).off().remove(),"error"!=b.type&&j?q(j[0],l,d,e):r(null,c||"error",l,d,e),window[g]=i,j&&a.isFunction(i)&&i(j[0]),i=j=void 0}),p(l,d)===!1?(k("abort"),l):(window[g]=function(){j=arguments},h.src=d.url.replace(/\?(.+)=\?/,"?$1="+g),c.head.appendChild(h),d.timeout>0&&(m=setTimeout(function(){k("timeout")},d.timeout)),l)},a.ajaxSettings={type:"GET",beforeSend:t,success:t,error:t,complete:t,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:i,xml:"application/xml, text/xml",html:j,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},a.ajax=function(b){var c=a.extend({},b||{}),f=a.Deferred&&a.Deferred();for(d in a.ajaxSettings)void 0===c[d]&&(c[d]=a.ajaxSettings[d]);n(c),c.crossDomain||(c.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(c.url)&&RegExp.$2!=window.location.host),c.url||(c.url=window.location.toString()),w(c),c.cache===!1&&(c.url=v(c.url,"_="+Date.now()));var g=c.dataType,h=/\?.+=\?/.test(c.url);if("jsonp"==g||h)return h||(c.url=v(c.url,c.jsonp?c.jsonp+"=?":c.jsonp===!1?"":"callback=?")),
a.ajaxJSONP(c,f);var x,i=c.accepts[g],j={},l=function(a,b){j[a.toLowerCase()]=[a,b]},m=/^([\w-]+:)\/\//.test(c.url)?RegExp.$1:window.location.protocol,o=c.xhr(),s=o.setRequestHeader;if(f&&f.promise(o),c.crossDomain||l("X-Requested-With","XMLHttpRequest"),l("Accept",i||"*/*"),(i=c.mimeType||i)&&(i.indexOf(",")>-1&&(i=i.split(",",2)[0]),o.overrideMimeType&&o.overrideMimeType(i)),(c.contentType||c.contentType!==!1&&c.data&&"GET"!=c.type.toUpperCase())&&l("Content-Type",c.contentType||"application/x-www-form-urlencoded"),c.headers)for(e in c.headers)l(e,c.headers[e]);if(o.setRequestHeader=l,o.onreadystatechange=function(){if(4==o.readyState){o.onreadystatechange=t,clearTimeout(x);var b,d=!1;if(o.status>=200&&o.status<300||304==o.status||0==o.status&&"file:"==m){g=g||u(c.mimeType||o.getResponseHeader("content-type")),b=o.responseText;try{"script"==g?(0,eval)(b):"xml"==g?b=o.responseXML:"json"==g&&(b=k.test(b)?null:a.parseJSON(b))}catch(a){d=a}d?r(d,"parsererror",o,c,f):q(b,o,c,f)}else r(o.statusText||null,o.status?"error":"abort",o,c,f)}},p(o,c)===!1)return o.abort(),r(null,"abort",o,c,f),o;if(c.xhrFields)for(e in c.xhrFields)o[e]=c.xhrFields[e];var y=!("async"in c)||c.async;o.open(c.type,c.url,y,c.username,c.password);for(e in j)s.apply(o,j[e]);return c.timeout>0&&(x=setTimeout(function(){o.onreadystatechange=t,o.abort(),r(null,"timeout",o,c,f)},c.timeout)),o.send(c.data?c.data:null),o},a.get=function(b,c,d,e){return a.ajax(x.apply(null,arguments))},a.post=function(b,c,d,e){var f=x.apply(null,arguments);return f.type="POST",a.ajax(f)},a.getJSON=function(b,c,d){var e=x.apply(null,arguments);return e.dataType="json",a.ajax(e)},a.fn.load=function(b,c,d){if(!this.length)return this;var h,e=this,g=b.split(/\s/),i=x(b,c,d),j=i.success;return g.length>1&&(i.url=g[0],h=g[1]),i.success=function(b){e.html(h?a("<div>").html(b.replace(f,"")).find(h):b),j&&j.apply(e,arguments)},a.ajax(i),this};var y=encodeURIComponent;a.param=function(a,b){var c=[];return c.add=function(a,b){this.push(y(a)+"="+y(b))},z(c,a,b),c.join("&").replace(/%20/g,"+")}}(b),function(a){a.fn.serializeArray=function(){var c,b=[];return a([].slice.call(this.get(0).elements)).each(function(){c=a(this);var d=c.attr("type");"fieldset"!=this.nodeName.toLowerCase()&&!this.disabled&&"submit"!=d&&"reset"!=d&&"button"!=d&&("radio"!=d&&"checkbox"!=d||this.checked)&&b.push({name:c.attr("name"),value:c.val()})}),b},a.fn.serialize=function(){var a=[];return this.serializeArray().forEach(function(b){a.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value))}),a.join("&")},a.fn.submit=function(b){if(b)this.bind("submit",b);else if(this.length){var c=a.Event("submit");this.eq(0).trigger(c),c.isDefaultPrevented()||this.get(0).submit()}return this}}(b),function(a){"__proto__"in{}||a.extend(a.zepto,{Z:function(b,c){return b=b||[],a.extend(b,a.fn),b.selector=c||"",b.__Z=!0,b},isZ:function(b){return"array"===a.type(b)&&"__Z"in b}});try{getComputedStyle(void 0)}catch(a){var b=getComputedStyle;window.getComputedStyle=function(a,c){try{return b(a,c)}catch(a){return null}}}}(b),a.getJSON=b.getJSON,a.ajax=b.ajax}(TL),TL.Class=function(){},TL.Class.extend=function(a){var b=function(){this.initialize&&this.initialize.apply(this,arguments)},c=function(){};c.prototype=this.prototype;var d=new c;d.constructor=b,b.prototype=d,b.superclass=this.prototype;for(var e in this)this.hasOwnProperty(e)&&"prototype"!==e&&"superclass"!==e&&(b[e]=this[e]);return a.statics&&(TL.Util.extend(b,a.statics),delete a.statics),a.includes&&(TL.Util.extend.apply(null,[d].concat(a.includes)),delete a.includes),a.options&&d.options&&(a.options=TL.Util.extend({},d.options,a.options)),TL.Util.extend(d,a),b.extend=TL.Class.extend,b.include=function(a){TL.Util.extend(this.prototype,a)},b},TL.Events={addEventListener:function(a,b,c){var d=this._tl_events=this._tl_events||{};return d[a]=d[a]||[],d[a].push({action:b,context:c||this}),this},hasEventListeners:function(a){var b="_tl_events";return b in this&&a in this[b]&&this[b][a].length>0},removeEventListener:function(a,b,c){if(!this.hasEventListeners(a))return this;for(var d=0,e=this._tl_events,f=e[a].length;d<f;d++)if(e[a][d].action===b&&(!c||e[a][d].context===c))return e[a].splice(d,1),this;return this},fireEvent:function(a,b){if(!this.hasEventListeners(a))return this;for(var c=TL.Util.mergeData({type:a,target:this},b),d=this._tl_events[a].slice(),e=0,f=d.length;e<f;e++)d[e].action.call(d[e].context||this,c);return this}},TL.Events.on=TL.Events.addEventListener,TL.Events.off=TL.Events.removeEventListener,TL.Events.fire=TL.Events.fireEvent,function(){var a=navigator.userAgent.toLowerCase(),b=document.documentElement,c="ActiveXObject"in window,d=a.indexOf("webkit")!==-1,e=a.indexOf("phantom")!==-1,f=a.search("android [23]")!==-1,g="undefined"!=typeof orientation,h=navigator.msPointerEnabled&&navigator.msMaxTouchPoints&&!window.PointerEvent,i=window.PointerEvent&&navigator.pointerEnabled&&navigator.maxTouchPoints||h,j=c&&"transition"in b.style,k="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!f,l="MozPerspective"in b.style,m="OTransition"in b.style,o=(window.opera,"devicePixelRatio"in window&&window.devicePixelRatio>1);if(!o&&"matchMedia"in window){var p=window.matchMedia("(min-resolution:144dpi)");o=p&&p.matches}var q=!window.L_NO_TOUCH&&!e&&(i||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);TL.Browser={ie:c,ua:a,ie9:Boolean(c&&a.match(/MSIE 9/i)),ielt9:c&&!document.addEventListener,webkit:d,firefox:a.indexOf("gecko")!==-1&&!d&&!window.opera&&!c,android:a.indexOf("android")!==-1,android23:f,chrome:a.indexOf("chrome")!==-1,edge:a.indexOf("edge/")!==-1,ie3d:j,webkit3d:k,gecko3d:l,opera3d:m,any3d:!window.L_DISABLE_3D&&(j||k||l||m)&&!e,mobile:g,mobileWebkit:g&&d,mobileWebkit3d:g&&k,mobileOpera:g&&window.opera,touch:!!q,msPointer:!!h,pointer:!!i,retina:!!o,orientation:function(){var a=window.innerWidth,b=window.innerHeight,c="portrait";return a>b&&(c="landscape"),90==Math.abs(window.orientation),trace(c),c}}}(),TL.Load=function(a){function c(a){var c=0,d=!1;for(c=0;c<b.length;c++)b[c]==a&&(d=!0);return!!d||(b.push(a),!1)}var b=[];return{css:function(a,b,d,e){c(a)?b():TL.LoadIt.css(a,b,d,e)},js:function(a,b,d,e){c(a)?b():TL.LoadIt.js(a,b,d,e)}}}(this.document),TL.LoadIt=function(a){function h(b,c){var e,d=a.createElement(b);for(e in c)c.hasOwnProperty(e)&&d.setAttribute(e,c[e]);return d}function i(a){var c,g,b=d[a];b&&(c=b.callback,g=b.urls,g.shift(),e=0,g.length||(c&&c.call(b.context,b.obj),d[a]=null,f[a].length&&k(a)))}function j(){var c=navigator.userAgent;b={async:a.createElement("script").async===!0},(b.webkit=/AppleWebKit\//.test(c))||(b.ie=/MSIE/.test(c))||(b.opera=/Opera/.test(c))||(b.gecko=/Gecko\//.test(c))||(b.unknown=!0)}function k(e,g,k,n,o){var s,t,u,v,w,x,p=function(){i(e)},q="css"===e,r=[];if(b||j(),g)if(g="string"==typeof g?[g]:g.concat(),q||b.async||b.gecko||b.opera)f[e].push({urls:g,callback:k,obj:n,context:o});else for(s=0,t=g.length;s<t;++s)f[e].push({urls:[g[s]],callback:s===t-1?k:null,obj:n,context:o});if(!d[e]&&(v=d[e]=f[e].shift())){for(c||(c=a.head||a.getElementsByTagName("head")[0]),w=v.urls,s=0,t=w.length;s<t;++s)x=w[s],q?u=b.gecko?h("style"):h("link",{href:x,rel:"stylesheet"}):(u=h("script",{src:x}),u.async=!1),u.className="lazyload",u.setAttribute("charset","utf-8"),b.ie&&!q?u.onreadystatechange=function(){/loaded|complete/.test(u.readyState)&&(u.onreadystatechange=null,p())}:q&&(b.gecko||b.webkit)?b.webkit?(v.urls[s]=u.href,m()):(u.innerHTML='@import "'+x+'";',l(u)):u.onload=u.onerror=p,r.push(u);for(s=0,t=r.length;s<t;++s)c.appendChild(r[s])}}function l(a){var b;try{b=!!a.sheet.cssRules}catch(c){return e+=1,void(e<200?setTimeout(function(){l(a)},50):b&&i("css"))}i("css")}function m(){var b,a=d.css;if(a){for(b=g.length;--b>=0;)if(g[b].href===a.urls[0]){i("css");break}e+=1,a&&(e<200?setTimeout(m,50):i("css"))}}var b,c,d={},e=0,f={css:[],js:[]},g=a.styleSheets;return{css:function(a,b,c,d){k("css",a,b,c,d)},js:function(a,b,c,d){k("js",a,b,c,d)}}}(this.document),TL.TimelineConfig=TL.Class.extend({includes:[],initialize:function(a){if(this.title="",this.scale="",this.events=[],this.eras=[],this.event_dict={},this.messages={errors:[],warnings:[]},"object"==typeof a&&a.events){if(this.scale=a.scale,this.events=[],this._ensureValidScale(a.events),a.title){var b=this._assignID(a.title);this._tidyFields(a.title),this.title=a.title,this.event_dict[b]=this.title}for(var c=0;c<a.events.length;c++)try{this.addEvent(a.events[c],!0)}catch(a){this.logError(a)}if(a.eras)for(var c=0;c<a.eras.length;c++)try{this.addEra(a.eras[c],!0)}catch(a){this.logError("Era "+c+": "+a)}TL.DateUtil.sortByDate(this.events),TL.DateUtil.sortByDate(this.eras)}},logError:function(a){trace(a),this.messages.errors.push(a)},getErrors:function(a){return a?this.messages.errors.join(a):this.messages.errors},validate:function(){"undefined"!=typeof this.events&&"undefined"!=typeof this.events.length&&0!=this.events.length||this.logError("Timeline configuration has no events.");for(var a=0;a<this.eras.length;a++)if("undefined"==typeof this.eras[a].start_date||"undefined"==typeof this.eras[a].end_date){var b;b=this.eras[a].text&&this.eras[a].text.headline?this.eras[a].text.headline:"era "+(a+1),this.logError("All eras must have start and end dates. ["+b+"]")}},isValid:function(){return 0==this.messages.errors.length},addEvent:function(a,b){var c=this._assignID(a);if("undefined"==typeof a.start_date)throw new TL.Error("missing_start_date_err",c);return this._processDates(a),this._tidyFields(a),this.events.push(a),this.event_dict[c]=a,b||TL.DateUtil.sortByDate(this.events),c},addEra:function(a,b){var c=this._assignID(a);if("undefined"==typeof a.start_date)throw new TL.Error("missing_start_date_err",c);return this._processDates(a),this._tidyFields(a),this.eras.push(a),this.event_dict[c]=a,b||TL.DateUtil.sortByDate(this.eras),c},_assignID:function(a){var b=a.unique_id;return TL.Util.trim(b)||(b=a.text?TL.Util.slugify(a.text.headline):null),a.unique_id=TL.Util.ensureUniqueKey(this.event_dict,b),a.unique_id},_makeUniqueIdentifiers:function(a,b){for(var c=[a],d=0;d<b.length;d++)TL.Util.trim(b[d].unique_id)&&(b[d].unique_id=TL.Util.slugify(b[d].unique_id),c.indexOf(b[d].unique_id)==-1?c.push(b[d].unique_id):b[d].unique_id="");if(c.length!=b.length+1)for(var d=0;d<b.length;d++)if(!b[d].unique_id){var e=b[d].text?TL.Util.slugify(b[d].text.headline):null;e||(e=TL.Util.unique_ID(6)),c.indexOf(e)!=-1&&(e=e+"-"+d),c.push(e),b[d].unique_id=e}},_ensureValidScale:function(a){if(!this.scale){trace("Determining scale dynamically"),this.scale="human";for(var b=0;b<a.length;b++){if("cosmological"==a[b].scale){this.scale="cosmological";break}if(a[b].start_date&&"undefined"!=typeof a[b].start_date.year){var c=new TL.BigDate(a[b].start_date),d=c.data.date_obj.year;if(d<-271820||d>275759){this.scale="cosmological";break}}}}var e=TL.DateUtil.SCALE_DATE_CLASSES[this.scale];e||this.logError("Don't know how to process dates on scale "+this.scale)},_processDates:function(a){var b=TL.DateUtil.SCALE_DATE_CLASSES[this.scale];if(!(a.start_date instanceof b)){var c=a.start_date;if(a.start_date=new b(c),"undefined"!=typeof a.end_date&&!(a.end_date instanceof b)){var d=a.end_date,e=!0;for(property in c)e=e&&c[property]==d[property];e?(trace("End date same as start date is redundant; dropping end date"),delete a.end_date):a.end_date=new b(d)}}},getEarliestDate:function(){var a=this.events[0].start_date;return this.eras&&this.eras.length>0&&this.eras[0].start_date.isBefore(a)?this.eras[0].start_date:a},getLatestDate:function(){for(var a=[],b=0;b<this.events.length;b++)this.events[b].end_date?a.push({date:this.events[b].end_date}):a.push({date:this.events[b].start_date});for(var b=0;b<this.eras.length;b++)this.eras[b].end_date?a.push({date:this.eras[b].end_date}):a.push({date:this.eras[b].start_date});return TL.DateUtil.sortByDate(a,"date"),a.slice(-1)[0].date},_tidyFields:function(a){function b(a,b,c){c||(c=""),a.hasOwnProperty(b)||(a[b]=c)}a.group&&(a.group=TL.Util.trim(a.group)),a.text||(a.text={}),b(a.text,"text"),b(a.text,"headline")}}),function(a){function b(a){parts={key:null,worksheet:0};var b=/\bkey=([-_A-Za-z0-9]+)&?/i,c=/docs.google.com\/spreadsheets(.*?)\/d\//;if(a.match(b))parts.key=a.match(b)[1];else if(a.match(c)){var d=a.search(c)+a.match(c)[0].length,e=a.substr(d);parts.key=e.split("/")[0],a.match(/\?gid=(\d+)/)&&(parts.worksheet=a.match(/\?gid=(\d+)/)[1])}else a.match(/^\b[-_A-Za-z0-9]+$/)&&(parts.key=a);return parts.key?parts:null}function c(b){var c={};for(k in b)0==k.indexOf("gsx$")&&(c[k.substr(4)]=b[k].$t);if(a.Util.isEmptyObject(c))return null;var d={media:{caption:c.mediacaption||"",credit:c.mediacredit||"",url:c.media||"",thumbnail:c.mediathumbnail||""},text:{headline:c.headline||"",text:c.text||""},group:c.tag||"",type:c.type||""};return c.startdate&&(d.start_date=a.Date.parseDate(c.startdate)),c.enddate&&(d.end_date=a.Date.parseDate(c.enddate)),d}function d(b){function c(a){if(a)return a.replace(/[\s,]+/g,"")}var d={};for(k in b)0==k.indexOf("gsx$")&&(d[k.substr(4)]=a.Util.trim(b[k].$t));if(a.Util.isEmptyObject(d))return null;var e={media:{caption:d.mediacaption||"",credit:d.mediacredit||"",url:d.media||"",thumbnail:d.mediathumbnail||""},text:{headline:d.headline||"",text:d.text||""},start_date:{year:c(d.year),month:c(d.month)||"",day:c(d.day)||""},end_date:{year:c(d.endyear)||"",month:c(d.endmonth)||"",day:c(d.endday)||""},display_date:d.displaydate||"",type:d.type||""};if(d.time&&a.Util.mergeData(e.start_date,a.DateUtil.parseTime(d.time)),d.endtime&&a.Util.mergeData(e.end_date,a.DateUtil.parseTime(d.endtime)),d.group&&(e.group=d.group),""==e.end_date.year){var f=e.end_date;if(delete e.end_date,""!=f.month||""!=f.day||""!=f.time){e.text.headline||trace("Invalid end date for spreadsheet row. Must have a year if any other date fields are specified.");trace(b)}}return d.background&&(d.background.match(/^(https?:)?\/\/?/)?e.background={url:d.background}:e.background={color:d.background}),e}var e=function(b){if("undefined"==typeof b.feed.entry||0==b.feed.entry.length)throw new a.Error("empty_feed_err");var e=b.feed.entry[0];if("undefined"!=typeof e.gsx$startdate)return c;if("undefined"!=typeof e.gsx$year){return d}throw new a.Error("invalid_data_format_err")},f=function(a){return"https://spreadsheets.google.com/feeds/list/"+a.key+"/1/public/values?alt=json"},g=function(c){var c=f(b(c)),e=a.ajax({url:c,async:!1});return e=JSON.parse(e.responseText),h(e)},h=function(a){for(var b={events:[],errors:[],warnings:[],eras:[]},c=e(a),d=0;d<a.feed.entry.length;d++)try{var f=c(a.feed.entry[d]);if(f){var g="event";"undefined"!=typeof f.type&&(g=f.type,delete f.type),"title"==g?b.title?(b.warnings.push("Multiple title slides detected."),b.events.push(f)):b.title=f:"era"==g?b.eras.push(f):b.events.push(f)}}catch(a){a.message&&(a=a.message),b.errors.push(a+" ["+d+"]")}return b},i=function(c,d){var e,f=b(c);if(f){try{var h=g(c)}catch(b){return e=new a.TimelineConfig,"NetworkError"==b.name?e.logError(new a.Error("network_err")):"TL.Error"==b.name?e.logError(b):e.logError(new a.Error("unknown_read_err",b.name)),void d(e)}if(e=new a.TimelineConfig(h),h.errors)for(var i=0;i<h.errors.length;i++)e.logError(h.errors[i]);d(e)}else a.ajax({url:c,dataType:"json",success:function(b){try{e=new a.TimelineConfig(b)}catch(b){e=new a.TimelineConfig,e.logError(b)}d(e)},error:function(b,c,f){if(e=new a.TimelineConfig,"parsererror"==c)var f=new a.Error("invalid_url_err");else var f=new a.Error("unknown_read_err",c);e.logError(f),d(e)}})};a.ConfigFactory={parseGoogleSpreadsheetURL:b,googleFeedJSONtoTimelineJSON:h,fromGoogle:function(a){return console.warn("TL.ConfigFactory.fromGoogle is deprecated and will be removed soon. Use TL.ConfigFactory.makeConfig(url,callback)"),g(a)},makeConfig:i}}(TL),TL.Language=function(a){for(k in TL.Language.languages.en)this[k]=TL.Language.languages.en[k];if(a&&a.language&&"string"==typeof a.language&&"en"!=a.language){var b=a.language;if(!(b in TL.Language.languages)){if(/\.json$/.test(b))var c=b;else{var d="/locale/"+b+".json",e=a.script_path||TL.Timeline.source_path;/\/$/.test(e)&&(d=d.substr(1));var c=e+d}var g=TL.ajax({url:c,async:!1});if(200!=g.status)throw"Could not load language ["+b+"]: "+g.statusText;TL.Language.languages[b]=JSON.parse(g.responseText)}TL.Util.mergeData(this,TL.Language.languages[b])}},TL.Language.formatNumber=function(a,b){if(b.match(/%(\.(\d+))?f/)){var c=b.match(/%(\.(\d+))?f/),d=c[0];return c[2]&&(a=a.toFixed(c[2])),b.replace(d,a)}return b},TL.Language.prototype.mergeData=function(a){for(k in TL.Language.languages.en)a[k]&&("object"==typeof this[k]?TL.Util.mergeData(a[k],this[k]):this[k]=a[k])},TL.Language.fallback={messages:{}},TL.Language.prototype.getMessage=function(a){return this.messages[a]||TL.Language.fallback.messages[a]||a},TL.Language.prototype._=TL.Language.prototype.getMessage,TL.Language.prototype.formatDate=function(a,b){return a.constructor==Date?this.formatJSDate(a,b):a.constructor==TL.BigYear?this.formatBigYear(a,b):a.data&&a.data.date_obj?this.formatDate(a.data.date_obj,b):(trace("Unfamiliar date presented for formatting"),a.toString())},TL.Language.prototype.formatBigYear=function(a,b){var c=a.year,d=this.bigdateformats[b]||this.bigdateformats.fallback;if(d){for(var e=0;e<d.length;e++){var f=d[e];if(Math.abs(c/f[0])>1)return TL.Language.formatNumber(Math.abs(c/f[0]),f[1])}return c.toString()}return trace("Language file dateformats missing cosmological. Falling back."),TL.Language.formatNumber(c,b)},TL.Language.prototype.formatJSDate=function(a,b){var c=this,d=function(a,b){var d=c.period_labels[a];if(d)var a=b<12?d[0]:d[1];return"<span class='tl-timeaxis-timesuffix'>"+a+"</span>"},e=!1,f=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,g=/[^-+\dA-Z]/g;b||(b="full");var h=this.dateformats[b]||TL.Language.fallback.dateformats[b];h||(h=b);var i=e?"getUTC":"get",j=a[i+"Date"](),k=a[i+"Day"](),l=a[i+"Month"](),m=a[i+"FullYear"](),n=a[i+"Hours"](),o=a[i+"Minutes"](),p=a[i+"Seconds"](),q=a[i+"Milliseconds"](),r=e?0:a.getTimezoneOffset(),t={d:j,dd:TL.Util.pad(j),ddd:this.date.day_abbr[k],dddd:this.date.day[k],m:l+1,mm:TL.Util.pad(l+1),mmm:this.date.month_abbr[l],mmmm:this.date.month[l],yy:String(m).slice(2),yyyy:m<0&&this.has_negative_year_modifier()?Math.abs(m):m,h:n%12||12,hh:TL.Util.pad(n%12||12),H:n,HH:TL.Util.pad(n),M:o,MM:TL.Util.pad(o),s:p,ss:TL.Util.pad(p),l:TL.Util.pad(q,3),L:TL.Util.pad(q>99?Math.round(q/10):q),t:d("t",n),tt:d("tt",n),T:d("T",n),TT:d("TT",n),Z:e?"UTC":(String(a).match(f)||[""]).pop().replace(g,""),o:(r>0?"-":"+")+TL.Util.pad(100*Math.floor(Math.abs(r)/60)+Math.abs(r)%60,4),S:["th","st","nd","rd"][j%10>3?0:(j%100-j%10!=10)*j%10]},u=h.replace(TL.Language.DATE_FORMAT_TOKENS,function(a){return a in t?t[a]:a.slice(1,a.length-1)});return this._applyEra(u,m)},TL.Language.prototype.has_negative_year_modifier=function(){return Boolean(this.era_labels.negative_year.prefix||this.era_labels.negative_year.suffix)},TL.Language.prototype._applyEra=function(a,b){var c=b<0?this.era_labels.negative_year:this.era_labels.positive_year,d="";return c.prefix&&(d+="<span>"+c.prefix+"</span> "),d+=a,c.suffix&&(d+=" <span>"+c.suffix+"</span>"),d},TL.Language.DATE_FORMAT_TOKENS=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,TL.Language.languages={en:{name:"English",lang:"en",api:{wikipedia:"en"},messages:{loading:"Loading",wikipedia:"From Wikipedia, the free encyclopedia",error:"Error",contract_timeline:"Contract Timeline",return_to_title:"Return to Title",loading_content:"Loading Content",expand_timeline:"Expand Timeline",loading_timeline:"Loading Timeline... ",swipe_to_navigate:"Swipe to Navigate<br><span class='tl-button'>OK</span>",unknown_read_err:"An unexpected error occurred trying to read your spreadsheet data",invalid_url_err:"Unable to read Timeline data. Make sure your URL is for a Google Spreadsheet or a Timeline JSON file.",network_err:"Unable to read your Google Spreadsheet. Make sure you have published it to the web.",empty_feed_err:"No data entries found",missing_start_date_err:"Missing start_date",invalid_data_format_err:"Header row has been modified.",date_compare_err:"Can't compare TL.Dates on different scales",invalid_scale_err:"Invalid scale",invalid_date_err:"Invalid date: month, day and year must be numbers.",invalid_separator_error:"Invalid time: misuse of : or . as separator.",invalid_hour_err:"Invalid time (hour)",invalid_minute_err:"Invalid time (minute)",invalid_second_err:"Invalid time (second)",invalid_fractional_err:"Invalid time (fractional seconds)",invalid_second_fractional_err:"Invalid time (seconds and fractional seconds)",invalid_year_err:"Invalid year",flickr_notfound_err:"Photo not found or private",flickr_invalidurl_err:"Invalid Flickr URL",imgur_invalidurl_err:"Invalid Imgur URL",twitter_invalidurl_err:"Invalid Twitter URL",twitter_load_err:"Unable to load Tweet",twitterembed_invalidurl_err:"Invalid Twitter Embed url",wikipedia_load_err:"Unable to load Wikipedia entry",youtube_invalidurl_err:"Invalid YouTube URL",spotify_invalid_url:"Invalid Spotify URL",template_value_err:"No value provided for variable",invalid_rgb_err:"Invalid RGB argument",time_scale_scale_err:"Don't know how to get date from time for scale",axis_helper_no_options_err:"Axis helper must be configured with options",axis_helper_scale_err:"No AxisHelper available for scale",invalid_integer_option:"Invalid option valueâmust be a whole number."},date:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],month_abbr:["Jan.","Feb.","March","April","May","June","July","Aug.","Sept.","Oct.","Nov.","Dec."],day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_abbr:["Sun.","Mon.","Tues.","Wed.","Thurs.","Fri.","Sat."]},era_labels:{positive_year:{prefix:"",suffix:""},negative_year:{prefix:"",suffix:"BCE"}},period_labels:{t:["a","p"],tt:["am","pm"],T:["A","P"],TT:["AM","PM"]},dateformats:{year:"yyyy",month_short:"mmm",month:"mmmm yyyy",full_short:"mmm d",full:"mmmm d',' yyyy",time:"h:MM:ss TT' <small>'mmmm d',' yyyy'</small>'",time_short:"h:MM:ss TT",time_no_seconds_short:"h:MM TT",time_no_minutes_short:"h TT",time_no_seconds_small_date:"h:MM TT' <small>'mmmm d',' yyyy'</small>'",time_milliseconds:"l",full_long:"mmm d',' yyyy 'at' h:MM TT",full_long_small_date:"h:MM TT' <small>mmm d',' yyyy'</small>'"},bigdateformats:{fallback:[[1e9,"%.2f billion years ago"],[1e6,"%.1f million years ago"],[1e3,"%.1f thousand years ago"],[1,"%f years ago"]],compact:[[1e9,"%.2f bya"],[1e6,"%.1f mya"],[1e3,"%.1f kya"],[1,"%f years ago"]],verbose:[[1e9,"%.2f billion years ago"],[1e6,"%.1f million years ago"],[1e3,"%.1f thousand years ago"],[1,"%f years ago"]]}}},TL.Language.fallback=new TL.Language,TL.I18NMixins={getLanguage:function(){return this.options&&this.options.language?this.options.language:(trace("Expected a language option"),TL.Language.fallback)},_:function(a){return this.getLanguage()._(a)}},TL.Easings={ease:[.25,.1,.25,1],linear:[0,0,1,1],easein:[.42,0,1,1],easeout:[0,0,.58,1],easeinout:[.42,0,.58,1]},TL.Ease={KeySpline:function(a){function b(a,b){return 1-3*b+3*a}function c(a,b){return 3*b-6*a}function d(a){return 3*a}function e(a,e,f){return((b(e,f)*a+c(e,f))*a+d(e))*a}function f(a,e,f){return 3*b(e,f)*a*a+2*c(e,f)*a+d(e)}function g(b){for(var c=b,d=0;d<4;++d){var g=f(c,a[0],a[2]);if(0==g)return c;var h=e(c,a[0],a[2])-b;c-=h/g}return c}this.get=function(b){return a[0]==a[1]&&a[2]==a[3]?b:e(g(b),a[1],a[3])}},easeInSpline:function(a){var b=new TL.Ease.KeySpline(TL.Easings.easein);return b.get(a)},easeInOutExpo:function(a){var b=new TL.Ease.KeySpline(TL.Easings.easein);return b.get(a)},easeOut:function(a){return Math.sin(a*Math.PI/2)},easeOutStrong:function(a){return 1==a?1:1-Math.pow(2,-10*a)},easeIn:function(a){return a*a},easeInStrong:function(a){return 0==a?0:Math.pow(2,10*(a-1))},easeOutBounce:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},easeInBack:function(a){var b=1.70158;return a*a*((b+1)*a-b)},easeOutBack:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},bounce:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},bouncePast:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?2-(7.5625*(a-=1.5/2.75)*a+.75):a<2.5/2.75?2-(7.5625*(a-=2.25/2.75)*a+.9375):2-(7.5625*(a-=2.625/2.75)*a+.984375)},swingTo:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},swingFrom:function(a){var b=1.70158;return a*a*((b+1)*a-b)},elastic:function(a){return-1*Math.pow(4,-8*a)*Math.sin((6*a-1)*(2*Math.PI)/2)+1},spring:function(a){return 1-Math.cos(4.5*a*Math.PI)*Math.exp(6*-a)},blink:function(a,b){return Math.round(a*(b||5))%2},pulse:function(a,b){return-Math.cos(a*((b||5)-.5)*2*Math.PI)/2+.5},wobble:function(a){return-Math.cos(a*Math.PI*(9*a))/2+.5},sinusoidal:function(a){return-Math.cos(a*Math.PI)/2+.5},flicker:function(a){var a=a+(Math.random()-.5)/5;return easings.sinusoidal(a<0?0:a>1?1:a)},mirror:function(a){return a<.5?easings.sinusoidal(2*a):easings.sinusoidal(1-2*(a-.5))},easeInQuad:function(a){return a*a},easeOutQuad:function(a){return a*(2-a)},easeInOutQuad:function(a){return a<.5?2*a*a:-1+(4-2*a)*a},easeInCubic:function(a){return a*a*a},easeOutCubic:function(a){return--a*a*a+1},easeInOutCubic:function(a){return a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},easeInQuart:function(a){return a*a*a*a},easeOutQuart:function(a){return 1- --a*a*a*a},easeInOutQuart:function(a){return a<.5?8*a*a*a*a:1-8*--a*a*a*a},easeInQuint:function(a){return a*a*a*a*a},easeOutQuint:function(a){return 1+--a*a*a*a*a},easeInOutQuint:function(a){return a<.5?16*a*a*a*a*a:1+16*--a*a*a*a*a}},TL.Animate=function(a,b){var c=new tlanimate(a,b);return c},window.tlanimate=function(){function v(a,b,c){if(Array.prototype.indexOf)return a.indexOf(b);for(c=0;c<a.length;++c)if(a[c]===b)return c}function w(a){var b,c=u.length;for(d&&a>1e12&&(a=e()),g&&(a=e()),b=c;b--;)u[b](a);u.length&&t(w)}function x(a){1===u.push(a)&&t(w)}function y(a){var b,c=v(u,a);c>=0&&(b=u.slice(c+1),u.length=c,u=u.concat(b))}function z(a,b){var d,c={};return(d=a.match(l))&&(c.rotate=K(d[1],b?b.rotate:null)),(d=a.match(m))&&(c.scale=K(d[1],b?b.scale:null)),(d=a.match(n))&&(c.skewx=K(d[1],b?b.skewx:null),c.skewy=K(d[3],b?b.skewy:null)),(d=a.match(o))&&(c.translatex=K(d[1],b?b.translatex:null),c.translatey=K(d[3],b?b.translatey:null)),c}function A(a){var b="";return"rotate"in a&&(b+="rotate("+a.rotate+"deg) "),"scale"in a&&(b+="scale("+a.scale+") "),"translatex"in a&&(b+="translate("+a.translatex+"px,"+a.translatey+"px) "),"skewx"in a&&(b+="skew("+a.skewx+"deg,"+a.skewy+"deg)"),b}function B(a,b,c){return"#"+(1<<24|a<<16|b<<8|c).toString(16).slice(1)}function C(a){var b=a.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return(b?B(b[1],b[2],b[3]):a).replace(/#(\w)(\w)(\w)$/,"#$1$1$2$2$3$3")}function D(a){return a.replace(/-(.)/g,function(a,b){return b.toUpperCase()})}function E(a){return"function"==typeof a}function F(a){return Math.sin(a*Math.PI/2)}function G(a,b,c,d,f,g){function o(a){var e=a-l;return e>i||m?(g=isFinite(g)?g:1,m?n&&b(g):b(g),y(o),c&&c.apply(j)):void b(isFinite(g)?k*d(e/i)+f:d(e/i))}d=E(d)?d:L.easings[d]||F;var i=a||h,j=this,k=g-f,l=e(),m=0,n=0;return x(o),{stop:function(a){m=1,n=a,a||(c=null)}}}function H(a,b){var e,f,c=a.length,d=[];for(e=0;e<c;++e)d[e]=[a[e][0],a[e][1]];for(f=1;f<c;++f)for(e=0;e<c-f;++e)d[e][0]=(1-b)*d[e][0]+b*d[parseInt(e+1,10)][0],d[e][1]=(1-b)*d[e][1]+b*d[parseInt(e+1,10)][1];return[d[0][0],d[0][1]]}function I(a,b,c){var e,f,g,h,d=[];for(e=0;e<6;e++)g=Math.min(15,parseInt(b.charAt(e),16)),h=Math.min(15,parseInt(c.charAt(e),16)),f=Math.floor((h-g)*a+g),f=f>15?15:f<0?0:f,d[e]=f.toString(16);return"#"+d.join("")}function J(a,b,c,d,e,f,g){if("transform"==e){g={};for(var i in c[f][e])g[i]=i in d[f][e]?Math.round(((d[f][e][i]-c[f][e][i])*a+c[f][e][i])*h)/h:c[f][e][i];return g}return"string"==typeof c[f][e]?I(a,c[f][e],d[f][e]):(g=Math.round(((d[f][e]-c[f][e])*a+c[f][e])*h)/h,e in p||(g+=b[f][e]||"px"),g)}function K(a,b,c,d,e){return(c=j.exec(a))?(e=parseFloat(c[2]))&&b+("+"==c[1]?1:-1)*e:parseFloat(a)}function L(a,b){var d,o,p,c=a?c=isFinite(a.length)?a:[a]:[],e=b.complete,f=b.duration,g=b.easing,h=b.bezier,j=[],l=[],m=[],n=[];for(h&&(o=b.left,p=b.top,delete b.right,delete b.bottom,delete b.left,delete b.top),d=c.length;d--;){if(j[d]={},l[d]={},m[d]={},h){var t=s(c[d],"left"),u=s(c[d],"top"),v=[K(E(o)?o(c[d]):o||0,parseFloat(t)),K(E(p)?p(c[d]):p||0,parseFloat(u))];n[d]=E(h)?h(c[d],v):h,n[d].push(v),n[d].unshift([parseInt(t,10),parseInt(u,10)])}for(var w in b){switch(w){case"complete":case"duration":case"easing":case"bezier":continue}var y,x=s(c[d],w),B=E(b[w])?b[w](c[d]):b[w];"string"!=typeof B||!i.test(B)||i.test(x)?(j[d][w]="transform"==w?z(x):"string"==typeof B&&i.test(B)?C(x).slice(1):parseFloat(x),l[d][w]="transform"==w?z(B,j[d][w]):"string"==typeof B&&"#"==B.charAt(0)?C(B).slice(1):K(B,parseFloat(x)),"string"==typeof B&&(y=B.match(k))&&(m[d][w]=y[1])):delete b[w]}}return G.apply(c,[f,function(a,e,f){for(d=c.length;d--;){h&&(f=H(n[d],a),c[d].style.left=f[0]+"px",c[d].style.top=f[1]+"px");for(var g in b)e=J(a,m,j,l,g,d),"transform"==g?c[d].style[q]=A(e):"opacity"!=g||r?c[d].style[D(g)]=e:c[d].style.filter="alpha(opacity="+100*e+")"}},e,g])}var a=document,b=window,c=b.performance,d=c&&(c.now||c.webkitNow||c.msNow||c.mozNow),e=d?function(){return d.call(c)}:function(){return+new Date},f=a.documentElement,g=!1,h=1e3,i=/^rgb\(|#/,j=/^([+\-])=([\d\.]+)/,k=/^(?:[\+\-]=?)?\d+(?:\.\d+)?(%|in|cm|mm|em|ex|pt|pc|px)$/,l=/rotate\(((?:[+\-]=)?([\-\d\.]+))deg\)/,m=/scale\(((?:[+\-]=)?([\d\.]+))\)/,n=/skew\(((?:[+\-]=)?([\-\d\.]+))deg, ?((?:[+\-]=)?([\-\d\.]+))deg\)/,o=/translate\(((?:[+\-]=)?([\-\d\.]+))px, ?((?:[+\-]=)?([\-\d\.]+))px\)/,p={lineHeight:1,zoom:1,zIndex:1,opacity:1,transform:1},q=function(){var d,b=a.createElement("a").style,c=["webkitTransform","MozTransform","OTransform","msTransform","Transform"];for(d=0;d<c.length;d++)if(c[d]in b)return c[d]}(),r=function(){return"undefined"!=typeof a.createElement("a").style.opacity}(),s=a.defaultView&&a.defaultView.getComputedStyle?function(b,c){c="transform"==c?q:c,c=D(c);var d=null,e=a.defaultView.getComputedStyle(b,"");return e&&(d=e[c]),b.style[c]||d}:f.currentStyle?function(a,b){if(b=D(b),"opacity"==b){var c=100;try{c=a.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(b){try{c=a.filters("alpha").opacity}catch(a){}}return c/100}var d=a.currentStyle?a.currentStyle[b]:null;return a.style[b]||d}:function(a,b){return a.style[D(b)]},t=function(){return b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.msRequestAnimationFrame||b.oRequestAnimationFrame||function(a){b.setTimeout(function(){a(+new Date)},17)}}(),u=[];return t(function(a){g=a>1e12!=e()>1e12}),L.tween=G,L.getStyle=s,L.bezier=H,L.transform=q,L.parseTransform=z,L.formatTransform=A,L.easings={},L}(),TL.Point=function(a,b,c){this.x=c?Math.round(a):a,this.y=c?Math.round(b):b},TL.Point.prototype={add:function(a){return this.clone()._add(a)},_add:function(a){return this.x+=a.x,this.y+=a.y,this},subtract:function(a){return this.clone()._subtract(a)},_subtract:function(a){return this.x-=a.x,this.y-=a.y,this},divideBy:function(a,b){return new TL.Point(this.x/a,this.y/a,b)},multiplyBy:function(a){return new TL.Point(this.x*a,this.y*a)},distanceTo:function(a){var b=a.x-this.x,c=a.y-this.y;return Math.sqrt(b*b+c*c)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},clone:function(){return new TL.Point(this.x,this.y)},toString:function(){return"Point("+TL.Util.formatNum(this.x)+", "+TL.Util.formatNum(this.y)+")"}},TL.DomMixins={show:function(a){
a||(this._el.container.style.display="block")},hide:function(a){this._el.container.style.display="none"},addTo:function(a){a.appendChild(this._el.container),this.onAdd()},removeFrom:function(a){a.removeChild(this._el.container),this.onRemove()},animatePosition:function(a,b){var c={duration:this.options.duration,easing:this.options.ease};for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]+"px");this.animator&&this.animator.stop(),this.animator=TL.Animate(b,c)},onLoaded:function(){this.fire("loaded",this.data)},onAdd:function(){this.fire("added",this.data)},onRemove:function(){this.fire("removed",this.data)},setPosition:function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b?b.style[c]=a[c]+"px":this._el.container.style[c]=a[c]+"px")},getPosition:function(){return TL.Dom.getPosition(this._el.container)}},TL.Dom={get:function(a){return"string"==typeof a?document.getElementById(a):a},getByClass:function(a){if(a)return document.getElementsByClassName(a)},create:function(a,b,c){var d=document.createElement(a);return d.className=b,c&&c.appendChild(d),d},createText:function(a,b){var c=document.createTextNode(a);return b&&b.appendChild(c),c},getTranslateString:function(a){return TL.Dom.TRANSLATE_OPEN+a.x+"px,"+a.y+"px"+TL.Dom.TRANSLATE_CLOSE},setPosition:function(a,b){a._tl_pos=b,TL.Browser.webkit3d?(a.style[TL.Dom.TRANSFORM]=TL.Dom.getTranslateString(b),TL.Browser.android&&(a.style["-webkit-perspective"]="1000",a.style["-webkit-backface-visibility"]="hidden")):(a.style.left=b.x+"px",a.style.top=b.y+"px")},getPosition:function(a){for(var b={x:0,y:0};a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b.x+=a.offsetLeft,b.y+=a.offsetTop,a=a.offsetParent;return b},testProp:function(a){for(var b=document.documentElement.style,c=0;c<a.length;c++)if(a[c]in b)return a[c];return!1}},TL.Util.mergeData(TL.Dom,{TRANSITION:TL.Dom.testProp(["transition","webkitTransition","OTransition","MozTransition","msTransition"]),TRANSFORM:TL.Dom.testProp(["transformProperty","WebkitTransform","OTransform","MozTransform","msTransform"]),TRANSLATE_OPEN:"translate"+(TL.Browser.webkit3d?"3d(":"("),TRANSLATE_CLOSE:TL.Browser.webkit3d?",0)":")"}),TL.DomUtil={get:function(a){return"string"==typeof a?document.getElementById(a):a},getStyle:function(a,b){var c=a.style[b];if(!c&&a.currentStyle&&(c=a.currentStyle[b]),!c||"auto"===c){var d=document.defaultView.getComputedStyle(a,null);c=d?d[b]:null}return"auto"===c?null:c},getViewportOffset:function(a){var b=0,c=0,d=a,e=document.body;do{if(b+=d.offsetTop||0,c+=d.offsetLeft||0,d.offsetParent===e&&"absolute"===TL.DomUtil.getStyle(d,"position"))break;d=d.offsetParent}while(d);d=a;do{if(d===e)break;b-=d.scrollTop||0,c-=d.scrollLeft||0,d=d.parentNode}while(d);return new TL.Point(c,b)},create:function(a,b,c){var d=document.createElement(a);return d.className=b,c&&c.appendChild(d),d},disableTextSelection:function(){document.selection&&document.selection.empty&&document.selection.empty(),this._onselectstart||(this._onselectstart=document.onselectstart,document.onselectstart=TL.Util.falseFn)},enableTextSelection:function(){document.onselectstart=this._onselectstart,this._onselectstart=null},hasClass:function(a,b){return a.className.length>0&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(a.className)},addClass:function(a,b){TL.DomUtil.hasClass(a,b)||(a.className+=(a.className?" ":"")+b)},removeClass:function(a,b){a.className=a.className.replace(/(\S+)\s*/g,function(a,c){return c===b?"":a}).replace(/^\s+/,"")},setOpacity:function(a,b){TL.Browser.ie?a.style.filter="alpha(opacity="+Math.round(100*b)+")":a.style.opacity=b},testProp:function(a){for(var b=document.documentElement.style,c=0;c<a.length;c++)if(a[c]in b)return a[c];return!1},getTranslateString:function(a){return TL.DomUtil.TRANSLATE_OPEN+a.x+"px,"+a.y+"px"+TL.DomUtil.TRANSLATE_CLOSE},getScaleString:function(a,b){var c=TL.DomUtil.getTranslateString(b),d=" scale("+a+") ",e=TL.DomUtil.getTranslateString(b.multiplyBy(-1));return c+d+e},setPosition:function(a,b){a._tl_pos=b,TL.Browser.webkit3d?(a.style[TL.DomUtil.TRANSFORM]=TL.DomUtil.getTranslateString(b),TL.Browser.android&&(a.style["-webkit-perspective"]="1000",a.style["-webkit-backface-visibility"]="hidden")):(a.style.left=b.x+"px",a.style.top=b.y+"px")},getPosition:function(a){return a._tl_pos}},TL.DomEvent={addListener:function(a,b,c,d){var e=TL.Util.stamp(c),f="_tl_"+b+e;if(!a[f]){var g=function(b){return c.call(d||a,b||TL.DomEvent._getEvent())};if(TL.Browser.touch&&"dblclick"===b&&this.addDoubleTapListener)this.addDoubleTapListener(a,g,e);else if("addEventListener"in a)if("mousewheel"===b)a.addEventListener("DOMMouseScroll",g,!1),a.addEventListener(b,g,!1);else if("mouseenter"===b||"mouseleave"===b){var h=g,i="mouseenter"===b?"mouseover":"mouseout";g=function(b){if(TL.DomEvent._checkMouse(a,b))return h(b)},a.addEventListener(i,g,!1)}else a.addEventListener(b,g,!1);else"attachEvent"in a&&a.attachEvent("on"+b,g);a[f]=g}},removeListener:function(a,b,c){var d=TL.Util.stamp(c),e="_tl_"+b+d,f=a[e];f&&(TL.Browser.touch&&"dblclick"===b&&this.removeDoubleTapListener?this.removeDoubleTapListener(a,d):"removeEventListener"in a?"mousewheel"===b?(a.removeEventListener("DOMMouseScroll",f,!1),a.removeEventListener(b,f,!1)):"mouseenter"===b||"mouseleave"===b?a.removeEventListener("mouseenter"===b?"mouseover":"mouseout",f,!1):a.removeEventListener(b,f,!1):"detachEvent"in a&&a.detachEvent("on"+b,f),a[e]=null)},_checkMouse:function(a,b){var c=b.relatedTarget;if(!c)return!0;try{for(;c&&c!==a;)c=c.parentNode}catch(a){return!1}return c!==a},_getEvent:function(){var a=window.event;if(!a)for(var b=arguments.callee.caller;b&&(a=b.arguments[0],!a||window.Event!==a.constructor);)b=b.caller;return a},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},disableClickPropagation:function(a){TL.DomEvent.addListener(a,TL.Draggable.START,TL.DomEvent.stopPropagation),TL.DomEvent.addListener(a,"click",TL.DomEvent.stopPropagation),TL.DomEvent.addListener(a,"dblclick",TL.DomEvent.stopPropagation)},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){TL.DomEvent.preventDefault(a),TL.DomEvent.stopPropagation(a)},getWheelDelta:function(a){var b=0;return a.wheelDelta&&(b=a.wheelDelta/120),a.detail&&(b=-a.detail/3),b}},TL.StyleSheet=TL.Class.extend({includes:[TL.Events],_el:{},initialize:function(){this.style=document.createElement("style"),this.style.appendChild(document.createTextNode("")),document.head.appendChild(this.style),this.sheet=this.style.sheet},addRule:function(a,b,c){var d=0;c&&(d=c),"insertRule"in this.sheet?this.sheet.insertRule(a+"{"+b+"}",d):"addRule"in this.sheet&&this.sheet.addRule(a,b,d)},onLoaded:function(a){this._state.loaded=!0,this.fire("loaded",this.data)}}),TL.Date=TL.Class.extend({initialize:function(a,b,c){"number"==typeof a?this.data={format:"yyyy mmmm",date_obj:new Date(a)}:Date==a.constructor?this.data={format:"yyyy mmmm",date_obj:a}:(this.data=JSON.parse(JSON.stringify(a)),this._createDateObj()),this._setFormat(b,c)},setDateFormat:function(a){this.data.format=a},getDisplayDate:function(a,b){if(this.data.display_date)return this.data.display_date;a||(a=TL.Language.fallback),a.constructor!=TL.Language&&(trace("First argument to getDisplayDate must be TL.Language"),a=TL.Language.fallback);var c=b||this.data.format;return a.formatDate(this.data.date_obj,c)},getMillisecond:function(){return this.getTime()},getTime:function(){return this.data.date_obj.getTime()},isBefore:function(a){if(!this.data.date_obj.constructor==a.data.date_obj.constructor)throw new TL.Error("date_compare_err");return"isBefore"in this.data.date_obj?this.data.date_obj.isBefore(a.data.date_obj):this.data.date_obj<a.data.date_obj},isAfter:function(a){if(!this.data.date_obj.constructor==a.data.date_obj.constructor)throw new TL.Error("date_compare_err");return"isAfter"in this.data.date_obj?this.data.date_obj.isAfter(a.data.date_obj):this.data.date_obj>a.data.date_obj},floor:function(a){for(var b=new Date(this.data.date_obj.getTime()),c=0;c<TL.Date.SCALES.length;c++)if(TL.Date.SCALES[c][2](b),TL.Date.SCALES[c][0]==a)return new TL.Date(b);throw new TL.Error("invalid_scale_err",a)},_getDateData:function(){var a={year:0,month:1,day:1,hour:0,minute:0,second:0,millisecond:0};TL.Util.mergeData(a,this.data);var b=TL.Date.DATE_PARTS;for(var c in b){var d=TL.Util.trim(a[b[c]]);if(!d.match(/^-?\d*$/))throw new TL.Error("invalid_date_err",b[c]+" = '"+a[b[c]]+"'");var e=parseInt(a[b[c]]);isNaN(e)&&(e=4==c||5==c?1:0),a[b[c]]=e}return a.month>0&&a.month<=12&&(a.month=a.month-1),a},_createDateObj:function(){var a=this._getDateData();this.data.date_obj=new Date(a.year,a.month,a.day,a.hour,a.minute,a.second,a.millisecond),this.data.date_obj.getFullYear()!=a.year&&this.data.date_obj.setFullYear(a.year)},findBestFormat:function(a){for(var b=TL.Date.DATE_PARTS,d=0;d<b.length;d++)if(this.data[b[d]])return a?a in TL.Date.BEST_DATEFORMATS||(a="short"):a="base",TL.Date.BEST_DATEFORMATS[a][b[d]];return""},_setFormat:function(a,b){a?this.data.format=a:this.data.format||(this.data.format=this.findBestFormat()),b?this.data.format_short=b:this.data.format_short||(this.data.format_short=this.findBestFormat(!0))}}),TL.Date.makeDate=function(a){var b=new TL.Date(a);return isNaN(b.getTime())?new TL.BigDate(a):b},TL.BigYear=TL.Class.extend({initialize:function(a){if(this.year=parseInt(a),isNaN(this.year))throw new TL.Error("invalid_year_err",a)},isBefore:function(a){return this.year<a.year},isAfter:function(a){return this.year>a.year},getTime:function(){return this.year}}),function(a){a.SCALES=[["millisecond",1,function(a){}],["second",1e3,function(a){a.setMilliseconds(0)}],["minute",6e4,function(a){a.setSeconds(0)}],["hour",36e5,function(a){a.setMinutes(0)}],["day",864e5,function(a){a.setHours(0)}],["month",2592e6,function(a){a.setDate(1)}],["year",31536e6,function(a){a.setMonth(0)}],["decade",31536e7,function(a){var b=a.getFullYear();a.setFullYear(b-b%10)}],["century",31536e8,function(a){var b=a.getFullYear();a.setFullYear(b-b%100)}],["millennium",31536e9,function(a){var b=a.getFullYear();a.setFullYear(b-b%1e3)}]],a.DATE_PARTS=["millisecond","second","minute","hour","day","month","year"];var b=/^([\+-]?\d+?)(-\d{2}?)?(-\d{2}?)?$/,c=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;a.parseISODate=function(a){var b=new Date(a);if(isNaN(b))throw new TL.Error("invalid_date_err",a);return{year:b.getFullYear(),month:b.getMonth()+1,day:b.getDate(),hour:b.getHours(),minute:b.getMinutes(),second:b.getSeconds(),millisecond:b.getMilliseconds()}},a.parseDate=function(d){if(d.match(b)){var e=d.match(b).slice(1),f={year:e[0].replace("+","")};return e[1]&&(f.month=e[1].replace("-","")),e[2]&&(f.day=e[2].replace("-","")),f}if(d.match(c))return a.parseISODate(d);if(d.match(/^\-?\d+$/))return{year:d};var g={};if(d.match(/\d+\/\d+\/\d+/)){var h=d.match(/\d+\/\d+\/\d+/)[0];d=TL.Util.trim(d.replace(h,""));var i=h.split("/");g.month=i[0],g.day=i[1],g.year=i[2]}if(d.match(/\d+\/\d+/)){var h=d.match(/\d+\/\d+/)[0];d=TL.Util.trim(d.replace(h,""));var i=h.split("/");g.month=i[0],g.year=i[1]}if(d.match(":")){var j=d.split(":");g.hour=j[0],g.minute=j[1],j[2]&&(second_parts=j[2].split("."),g.second=second_parts[0],g.millisecond=second_parts[1])}return g},a.BEST_DATEFORMATS={base:{millisecond:"time_short",second:"time",minute:"time_no_seconds_small_date",hour:"time_no_seconds_small_date",day:"full",month:"month",year:"year",decade:"year",century:"year",millennium:"year",age:"fallback",epoch:"fallback",era:"fallback",eon:"fallback",eon2:"fallback"},short:{millisecond:"time_short",second:"time_short",minute:"time_no_seconds_short",hour:"time_no_minutes_short",day:"full_short",month:"month_short",year:"year",decade:"year",century:"year",millennium:"year",age:"fallback",epoch:"fallback",era:"fallback",eon:"fallback",eon2:"fallback"}}}(TL.Date),TL.BigDate=TL.Date.extend({initialize:function(a,b,c){TL.BigYear==a.constructor?this.data={date_obj:a}:(this.data=JSON.parse(JSON.stringify(a)),this._createDateObj()),this._setFormat(b,c)},_createDateObj:function(){var a=this._getDateData();this.data.date_obj=new TL.BigYear(a.year)},floor:function(a){for(var b=0;b<TL.BigDate.SCALES.length;b++)if(TL.BigDate.SCALES[b][0]==a){var c=TL.BigDate.SCALES[b][2](this.data.date_obj);return new TL.BigDate(c)}throw new TL.Error("invalid_scale_err",a)}}),function(a){var b=1e6,c=10*b,d=10*c,e=10*d,f=function(a){return function(b){var c=b.getTime();return new TL.BigYear(Math.floor(c/a)*a)}};a.SCALES=[["year",1,new f(1)],["decade",10,new f(10)],["century",100,new f(100)],["millennium",1e3,new f(1e3)],["age",b,new f(b)],["epoch",c,new f(c)],["era",d,new f(d)],["eon",e,new f(e)]]}(TL.BigDate),TL.DateUtil={get:function(a){return"string"==typeof a?document.getElementById(a):a},sortByDate:function(a,b){var b=b||"start_date";a.sort(function(a,c){return a[b].isBefore(c[b])?-1:a[b].isAfter(c[b])?1:0})},parseTime:function(a){var b={hour:null,minute:null,second:null,millisecond:null},c=null,d=a.match(/(\s*[AaPp]\.?[Mm]\.?\s*)$/);d&&(c=TL.Util.trim(d[0]),a=TL.Util.trim(a.substring(0,a.lastIndexOf(c))));var e=[],f=a.match(/^\s*(\d{1,2})(\d{2})\s*$/);if(f?e=f.slice(1):(e=a.split(":"),1==e.length&&(e=a.split("."))),e.length>4)throw new TL.Error("invalid_separator_error");if(b.hour=parseInt(e[0]),c&&"p"==c.toLowerCase()[0]&&12!=b.hour?b.hour+=12:c&&"a"==c.toLowerCase()[0]&&12==b.hour&&(b.hour=0),isNaN(b.hour)||b.hour<0||b.hour>23)throw new TL.Error("invalid_hour_err",b.hour);if(e.length>1&&(b.minute=parseInt(e[1]),isNaN(b.minute)))throw new TL.Error("invalid_minute_err",b.minute);if(e.length>2){var g=e[2].split(/[\.,]/);if(e=g.concat(e.slice(3)),e.length>2)throw new TL.Error("invalid_second_fractional_err");if(b.second=parseInt(e[0]),isNaN(b.second))throw new TL.Error("invalid_second_err");if(2==e.length){var h=parseInt(e[1]);if(isNaN(h))throw new TL.Error("invalid_fractional_err");b.millisecond=100*h}}return b},SCALE_DATE_CLASSES:{human:TL.Date,cosmological:TL.BigDate}},TL.Draggable=TL.Class.extend({includes:TL.Events,_el:{},mousedrag:{down:"mousedown",up:"mouseup",leave:"mouseleave",move:"mousemove"},touchdrag:{down:"touchstart",up:"touchend",leave:"mouseleave",move:"touchmove"},initialize:function(a,b,c){this._el={drag:a,move:a},c&&(this._el.move=c),this.options={enable:{x:!0,y:!0},constraint:{top:!1,bottom:!1,left:!1,right:!1},momentum_multiplier:2e3,duration:1e3,ease:TL.Ease.easeInOutQuint},this.animator=null,this.dragevent=this.mousedrag,TL.Browser.touch&&(this.dragevent=this.touchdrag),this.data={sliding:!1,direction:"none",pagex:{start:0,end:0},pagey:{start:0,end:0},pos:{start:{x:0,y:0},end:{x:0,y:0}},new_pos:{x:0,y:0},new_pos_parent:{x:0,y:0},time:{start:0,end:0},touch:!1},TL.Util.mergeData(this.options,b)},enable:function(a){this.data.pos.start=0,this._el.move.style.left=this.data.pos.start.x+"px",this._el.move.style.top=this.data.pos.start.y+"px",this._el.move.style.position="absolute"},disable:function(){TL.DomEvent.removeListener(this._el.drag,this.dragevent.down,this._onDragStart,this),TL.DomEvent.removeListener(this._el.drag,this.dragevent.up,this._onDragEnd,this)},stopMomentum:function(){this.animator&&this.animator.stop()},updateConstraint:function(a){this.options.constraint=a},_onDragStart:function(a){TL.Browser.touch?a.originalEvent?(this.data.pagex.start=a.originalEvent.touches[0].screenX,this.data.pagey.start=a.originalEvent.touches[0].screenY):(this.data.pagex.start=a.targetTouches[0].screenX,this.data.pagey.start=a.targetTouches[0].screenY):(this.data.pagex.start=a.pageX,this.data.pagey.start=a.pageY),this.options.enable.x&&(this._el.move.style.left=this.data.pagex.start-this._el.move.offsetWidth/2+"px"),this.options.enable.y&&(this._el.move.style.top=this.data.pagey.start-this._el.move.offsetHeight/2+"px"),this.data.pos.start=TL.Dom.getPosition(this._el.drag),this.data.time.start=(new Date).getTime(),this.fire("dragstart",this.data),TL.DomEvent.addListener(this._el.drag,this.dragevent.move,this._onDragMove,this),TL.DomEvent.addListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this)},_onDragEnd:function(a){this.data.sliding=!1,TL.DomEvent.removeListener(this._el.drag,this.dragevent.move,this._onDragMove,this),TL.DomEvent.removeListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this),this.fire("dragend",this.data),this._momentum()},_onDragMove:function(a){a.preventDefault(),this.data.sliding=!0,TL.Browser.touch?a.originalEvent?(this.data.pagex.end=a.originalEvent.touches[0].screenX,this.data.pagey.end=a.originalEvent.touches[0].screenY):(this.data.pagex.end=a.targetTouches[0].screenX,this.data.pagey.end=a.targetTouches[0].screenY):(this.data.pagex.end=a.pageX,this.data.pagey.end=a.pageY),this.data.pos.end=TL.Dom.getPosition(this._el.drag),this.data.new_pos.x=-(this.data.pagex.start-this.data.pagex.end-this.data.pos.start.x),this.data.new_pos.y=-(this.data.pagey.start-this.data.pagey.end-this.data.pos.start.y),this.options.enable.x&&(this._el.move.style.left=this.data.new_pos.x+"px"),this.options.enable.y&&(this._el.move.style.top=this.data.new_pos.y+"px"),this.fire("dragmove",this.data)},_momentum:function(){var a={x:0,y:0,time:0},b={x:0,y:0,time:0},c=!1;TL.Browser.touch,a.time=10*((new Date).getTime()-this.data.time.start),b.time=10*((new Date).getTime()-this.data.time.start),b.x=this.options.momentum_multiplier*(Math.abs(this.data.pagex.end)-Math.abs(this.data.pagex.start)),b.y=this.options.momentum_multiplier*(Math.abs(this.data.pagey.end)-Math.abs(this.data.pagey.start)),a.x=Math.round(b.x/b.time),a.y=Math.round(b.y/b.time),this.data.new_pos.x=Math.min(this.data.pos.end.x+a.x),this.data.new_pos.y=Math.min(this.data.pos.end.y+a.y),this.options.enable.x?this.data.new_pos.x<0&&(this.data.new_pos.x=0):this.data.new_pos.x=this.data.pos.start.x,this.options.enable.y?this.data.new_pos.y<0&&(this.data.new_pos.y=0):this.data.new_pos.y=this.data.pos.start.y,b.time<3e3&&(c=!0),Math.abs(b.x)>1e4&&(this.data.direction="left",b.x>0&&(this.data.direction="right")),Math.abs(b.y)>1e4&&(this.data.direction="up",b.y>0&&(this.data.direction="down")),this._animateMomentum(),c&&this.fire("swipe_"+this.data.direction,this.data)},_animateMomentum:function(){var a={x:this.data.new_pos.x,y:this.data.new_pos.y},b={duration:this.options.duration,easing:TL.Ease.easeOutStrong};this.options.enable.y&&((this.options.constraint.top||this.options.constraint.bottom)&&(a.y>this.options.constraint.bottom?a.y=this.options.constraint.bottom:a.y<this.options.constraint.top&&(a.y=this.options.constraint.top)),b.top=Math.floor(a.y)+"px"),this.options.enable.x&&((this.options.constraint.left||this.options.constraint.right)&&(a.x>this.options.constraint.left?a.x=this.options.constraint.left:a.x<this.options.constraint.right&&(a.x=this.options.constraint.right)),b.left=Math.floor(a.x)+"px"),this.animator=TL.Animate(this._el.move,b),this.fire("momentum",this.data)}}),TL.Swipable=TL.Class.extend({includes:TL.Events,_el:{},mousedrag:{down:"mousedown",up:"mouseup",leave:"mouseleave",move:"mousemove"},touchdrag:{down:"touchstart",up:"touchend",leave:"mouseleave",move:"touchmove"},initialize:function(a,b,c){this._el={drag:a,move:a},b&&(this._el.move=b),this.options={snap:!1,enable:{x:!0,y:!0},constraint:{top:!1,bottom:!1,left:0,right:!1},momentum_multiplier:2e3,duration:1e3,ease:TL.Ease.easeInOutQuint},this.animator=null,this.dragevent=this.mousedrag,TL.Browser.touch&&(this.dragevent=this.touchdrag),this.data={sliding:!1,direction:"none",pagex:{start:0,end:0},pagey:{start:0,end:0},pos:{start:{x:0,y:0},end:{x:0,y:0}},new_pos:{x:0,y:0},new_pos_parent:{x:0,y:0},time:{start:0,end:0},touch:!1},TL.Util.mergeData(this.options,c)},enable:function(a){TL.DomEvent.addListener(this._el.drag,this.dragevent.down,this._onDragStart,this),TL.DomEvent.addListener(this._el.drag,this.dragevent.up,this._onDragEnd,this),this.data.pos.start=0,this._el.move.style.left=this.data.pos.start.x+"px",this._el.move.style.top=this.data.pos.start.y+"px",this._el.move.style.position="absolute"},disable:function(){TL.DomEvent.removeListener(this._el.drag,this.dragevent.down,this._onDragStart,this),TL.DomEvent.removeListener(this._el.drag,this.dragevent.up,this._onDragEnd,this)},stopMomentum:function(){this.animator&&this.animator.stop()},updateConstraint:function(a){this.options.constraint=a},_onDragStart:function(a){this.animator&&this.animator.stop(),TL.Browser.touch?a.originalEvent?(this.data.pagex.start=a.originalEvent.touches[0].screenX,this.data.pagey.start=a.originalEvent.touches[0].screenY):(this.data.pagex.start=a.targetTouches[0].screenX,this.data.pagey.start=a.targetTouches[0].screenY):(this.data.pagex.start=a.pageX,this.data.pagey.start=a.pageY),this.options.enable.x,this.options.enable.y,this.data.pos.start={x:this._el.move.offsetLeft,y:this._el.move.offsetTop},this.data.time.start=(new Date).getTime(),this.fire("dragstart",this.data),TL.DomEvent.addListener(this._el.drag,this.dragevent.move,this._onDragMove,this),TL.DomEvent.addListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this)},_onDragEnd:function(a){this.data.sliding=!1,TL.DomEvent.removeListener(this._el.drag,this.dragevent.move,this._onDragMove,this),TL.DomEvent.removeListener(this._el.drag,this.dragevent.leave,this._onDragEnd,this),this.fire("dragend",this.data),this._momentum()},_onDragMove:function(a){var b={x:0,y:0};this.data.sliding=!0,TL.Browser.touch?a.originalEvent?(this.data.pagex.end=a.originalEvent.touches[0].screenX,this.data.pagey.end=a.originalEvent.touches[0].screenY):(this.data.pagex.end=a.targetTouches[0].screenX,this.data.pagey.end=a.targetTouches[0].screenY):(this.data.pagex.end=a.pageX,this.data.pagey.end=a.pageY),b.x=this.data.pagex.start-this.data.pagex.end,b.y=this.data.pagey.start-this.data.pagey.end,this.data.pos.end={x:this._el.drag.offsetLeft,y:this._el.drag.offsetTop},this.data.new_pos.x=-(b.x-this.data.pos.start.x),this.data.new_pos.y=-(b.y-this.data.pos.start.y),this.options.enable.x&&Math.abs(b.x)>Math.abs(b.y)&&(a.preventDefault(),this._el.move.style.left=this.data.new_pos.x+"px"),this.options.enable.y&&Math.abs(b.y)>Math.abs(b.y)&&(a.preventDefault(),this._el.move.style.top=this.data.new_pos.y+"px"),this.fire("dragmove",this.data)},_momentum:function(){var a={x:0,y:0,time:0},b={x:0,y:0,time:0},c={x:!1,y:!1},d=!1;this.data.direction=null,a.time=10*((new Date).getTime()-this.data.time.start),b.time=10*((new Date).getTime()-this.data.time.start),b.x=this.options.momentum_multiplier*(Math.abs(this.data.pagex.end)-Math.abs(this.data.pagex.start)),b.y=this.options.momentum_multiplier*(Math.abs(this.data.pagey.end)-Math.abs(this.data.pagey.start)),a.x=Math.round(b.x/b.time),a.y=Math.round(b.y/b.time),this.data.new_pos.x=Math.min(this.data.new_pos.x+a.x),this.data.new_pos.y=Math.min(this.data.new_pos.y+a.y),this.options.enable.x?this.options.constraint.left&&this.data.new_pos.x>this.options.constraint.left&&(this.data.new_pos.x=this.options.constraint.left):this.data.new_pos.x=this.data.pos.start.x,this.options.enable.y?this.data.new_pos.y<0&&(this.data.new_pos.y=0):this.data.new_pos.y=this.data.pos.start.y,b.time<2e3&&(d=!0),this.options.enable.x&&this.options.enable.y?Math.abs(b.x)>Math.abs(b.y)?c.x=!0:c.y=!0:this.options.enable.x?Math.abs(b.x)>Math.abs(b.y)&&(c.x=!0):Math.abs(b.y)>Math.abs(b.x)&&(c.y=!0),c.x&&(Math.abs(b.x)>this._el.drag.offsetWidth/2&&(d=!0),Math.abs(b.x)>1e4&&(this.data.direction="left",b.x>0&&(this.data.direction="right"))),c.y&&(Math.abs(b.y)>this._el.drag.offsetHeight/2&&(d=!0),Math.abs(b.y)>1e4&&(this.data.direction="up",b.y>0&&(this.data.direction="down"))),b.time<1e3||this._animateMomentum(),d&&this.data.direction?this.fire("swipe_"+this.data.direction,this.data):this.data.direction?this.fire("swipe_nodirection",this.data):this.options.snap&&(this.animator.stop(),this.animator=TL.Animate(this._el.move,{top:this.data.pos.start.y,left:this.data.pos.start.x,duration:this.options.duration,easing:TL.Ease.easeOutStrong}))},_animateMomentum:function(){var a={x:this.data.new_pos.x,y:this.data.new_pos.y},b={duration:this.options.duration,easing:TL.Ease.easeOutStrong};this.options.enable.y&&((this.options.constraint.top||this.options.constraint.bottom)&&(a.y>this.options.constraint.bottom?a.y=this.options.constraint.bottom:a.y<this.options.constraint.top&&(a.y=this.options.constraint.top)),b.top=Math.floor(a.y)+"px"),this.options.enable.x&&(this.options.constraint.left&&a.x>=this.options.constraint.left&&(a.x=this.options.constraint.left),this.options.constraint.right&&a.x<this.options.constraint.right&&(a.x=this.options.constraint.right),b.left=Math.floor(a.x)+"px"),this.animator=TL.Animate(this._el.move,b),this.fire("momentum",this.data)}}),TL.MenuBar=TL.Class.extend({includes:[TL.Events,TL.DomMixins],_el:{},initialize:function(a,b,c){this._el={parent:{},container:{},button_backtostart:{},button_zoomin:{},button_zoomout:{},arrow:{},line:{},coverbar:{},grip:{}},this.collapsed=!1,"object"==typeof a?this._el.container=a:this._el.container=TL.Dom.get(a),b&&(this._el.parent=b),this.options={width:600,height:600,duration:1e3,ease:TL.Ease.easeInOutQuint,menubar_default_y:0},this.animator={},TL.Util.mergeData(this.options,c),this._initLayout(),this._initEvents()},show:function(a){var b=this.options.duration;a&&(b=a)},hide:function(a){},toogleZoomIn:function(a){a?TL.DomUtil.removeClass(this._el.button_zoomin,"tl-menubar-button-inactive"):TL.DomUtil.addClass(this._el.button_zoomin,"tl-menubar-button-inactive")},toogleZoomOut:function(a){a?TL.DomUtil.removeClass(this._el.button_zoomout,"tl-menubar-button-inactive"):TL.DomUtil.addClass(this._el.button_zoomout,"tl-menubar-button-inactive")},setSticky:function(a){this.options.menubar_default_y=a},setColor:function(a){a?this._el.container.className="tl-menubar tl-menubar-inverted":this._el.container.className="tl-menubar"},updateDisplay:function(a,b,c,d){this._updateDisplay(a,b,c,d)},_onButtonZoomIn:function(a){this.fire("zoom_in",a)},_onButtonZoomOut:function(a){this.fire("zoom_out",a)},_onButtonBackToStart:function(a){this.fire("back_to_start",a)},_initLayout:function(){this._el.button_zoomin=TL.Dom.create("span","tl-menubar-button",this._el.container),this._el.button_zoomout=TL.Dom.create("span","tl-menubar-button",this._el.container),this._el.button_backtostart=TL.Dom.create("span","tl-menubar-button",this._el.container),TL.Browser.mobile&&this._el.container.setAttribute("ontouchstart"," "),this._el.button_backtostart.innerHTML="<span class='tl-icon-goback'></span>",this._el.button_zoomin.innerHTML="<span class='tl-icon-zoom-in'></span>",this._el.button_zoomout.innerHTML="<span class='tl-icon-zoom-out'></span>"},_initEvents:function(){TL.DomEvent.addListener(this._el.button_backtostart,"click",this._onButtonBackToStart,this),TL.DomEvent.addListener(this._el.button_zoomin,"click",this._onButtonZoomIn,this),TL.DomEvent.addListener(this._el.button_zoomout,"click",this._onButtonZoomOut,this)},_updateDisplay:function(a,b,c){a&&(this.options.width=a),b&&(this.options.height=b)}}),TL.Message=TL.Class.extend({includes:[TL.Events,TL.DomMixins,TL.I18NMixins],_el:{},initialize:function(a,b,c){this._el={parent:{},container:{},message_container:{},loading_icon:{},message:{}},this.options={width:600,height:600,message_class:"tl-message",message_icon_class:"tl-loading-icon"},this._add_to_container=c||{},TL.Util.mergeData(this.data,a),TL.Util.mergeData(this.options,b),this._el.container=TL.Dom.create("div",this.options.message_class),c&&(c.appendChild(this._el.container),this._el.parent=c),this.animator={},this._initLayout(),this._initEvents()},updateMessage:function(a){this._updateMessage(a)},updateDisplay:function(a,b){this._updateDisplay(a,b)},_updateMessage:function(a){a?this._el.message.innerHTML=a:this._el.message.innerHTML=this._("loading"),!this._el.parent.atrributes&&this._add_to_container.attributes&&(this._add_to_container.appendChild(this._el.container),this._el.parent=this._add_to_container)},_onMouseClick:function(){this.fire("clicked",this.options)},_onRemove:function(){this._el.parent={}},_initLayout:function(){this._el.message_container=TL.Dom.create("div","tl-message-container",this._el.container),this._el.loading_icon=TL.Dom.create("div",this.options.message_icon_class,this._el.message_container),this._el.message=TL.Dom.create("div","tl-message-content",this._el.message_container),this._updateMessage()},_initEvents:function(){TL.DomEvent.addListener(this._el.container,"click",this._onMouseClick,this),TL.DomEvent.addListener(this,"removed",this._onRemove,this)},_updateDisplay:function(a,b,c){}}),TL.MediaType=function(a,b){var c={},d=[{type:"youtube",name:"YouTube",match_str:"^(https?:)?/*(www.)?youtube|youtu.be",cls:TL.Media.YouTube},{type:"vimeo",name:"Vimeo",match_str:"^(https?:)?/*(player.)?vimeo.com",cls:TL.Media.Vimeo},{type:"dailymotion",name:"DailyMotion",match_str:"^(https?:)?/*(www.)?dailymotion.com",cls:TL.Media.DailyMotion},{type:"vine",name:"Vine",match_str:"^(https?:)?/*(www.)?vine.co",cls:TL.Media.Vine},{type:"soundcloud",name:"SoundCloud",match_str:"^(https?:)?/*(player.)?soundcloud.com",cls:TL.Media.SoundCloud},{type:"twitter",name:"Twitter",match_str:"^(https?:)?/*(www.)?twitter.com",cls:TL.Media.Twitter},{type:"twitterembed",name:"TwitterEmbed",match_str:'<blockquote class="twitter-tweet"',cls:TL.Media.TwitterEmbed},{type:"googlemaps",name:"Google Map",match_str:/google.+?\/maps\/@([-\d.]+),([-\d.]+),((?:[-\d.]+[zmayht],?)*)|google.+?\/maps\/search\/([\w\W]+)\/@([-\d.]+),([-\d.]+),((?:[-\d.]+[zmayht],?)*)|google.+?\/maps\/place\/([\w\W]+)\/@([-\d.]+),([-\d.]+),((?:[-\d.]+[zmayht],?)*)|google.+?\/maps\/dir\/([\w\W]+)\/([\w\W]+)\/@([-\d.]+),([-\d.]+),((?:[-\d.]+[zmayht],?)*)/,cls:TL.Media.GoogleMap},{type:"googleplus",name:"Google+",match_str:"^(https?:)?/*plus.google",cls:TL.Media.GooglePlus},{type:"flickr",name:"Flickr",match_str:"^(https?:)?/*(www.)?flickr.com/photos",cls:TL.Media.Flickr},{type:"flickr",name:"Flickr",match_str:"^(https?://)?flic.kr/.*",cls:TL.Media.Flickr},{type:"instagram",name:"Instagram",match_str:/^(https?:)?\/*(www.)?(instagr.am|^(https?:)?\/*(www.)?instagram.com)\/p\//,cls:TL.Media.Instagram},{type:"profile",name:"Profile",match_str:/^(https?:)?\/*(www.)?instagr.am\/[a-zA-Z0-9]{2,}|^(https?:)?\/*(www.)?instagram.com\/[a-zA-Z0-9]{2,}/,cls:TL.Media.Profile},{type:"documentcloud",name:"Document Cloud",match_str:/documentcloud.org\//,cls:TL.Media.DocumentCloud},{type:"image",name:"Image",match_str:/(jpg|jpeg|png|gif|svg)(\?.*)?$/i,cls:TL.Media.Image},{type:"imgur",name:"Imgur",match_str:/^.*imgur.com\/.+$/i,cls:TL.Media.Imgur},{type:"googledocs",name:"Google Doc",match_str:"^(https?:)?/*[^.]*.google.com/[^/]*/d/[^/]*/[^/]*?usp=sharing|^(https?:)?/*drive.google.com/open?id=[^&]*&authuser=0|^(https?:)?/*drive.google.com/open?id=[^&]*|^(https?:)?/*[^.]*.googledrive.com/host/[^/]*/",cls:TL.Media.GoogleDoc},{type:"pdf",name:"PDF",match_str:/^.*\.pdf(\?.*)?(\#.*)?/,cls:TL.Media.PDF},{type:"wikipedia",name:"Wikipedia",match_str:"^(https?:)?/*(www.)?wikipedia.org|^(https?:)?/*([a-z][a-z].)?wikipedia.org",cls:TL.Media.Wikipedia},{type:"spotify",name:"spotify",match_str:"spotify",cls:TL.Media.Spotify},{type:"iframe",name:"iFrame",match_str:"iframe",cls:TL.Media.IFrame},{type:"storify",name:"Storify",match_str:"storify",cls:TL.Media.Storify},{type:"blockquote",name:"Quote",match_str:"blockquote",cls:TL.Media.Blockquote},{type:"imageblank",name:"Imageblank",match_str:"",cls:TL.Media.Image}];if(b){if(a instanceof Array)return!1;for(var e=0;e<d.length;e++)switch(d[e].type){case"flickr":case"image":case"imgur":case"instagram":if(a.url.match(d[e].match_str))return c=d[e]}}else for(var e=0;e<d.length;e++){if(a instanceof Array)return c={type:"slider",cls:TL.Media.Slider};if(a.url.match(d[e].match_str))return c=d[e]}return!1},TL.Media=TL.Class.extend({includes:[TL.Events,TL.I18NMixins],_el:{},initialize:function(a,b,c){
this._el={container:{},content_container:{},content:{},content_item:{},content_link:{},caption:null,credit:null,parent:{},link:null},this.player=null,this.timer=null,this.load_timer=null,this.message=null,this.media_id=null,this._state={loaded:!1,show_meta:!1,media_loaded:!1},this.data={unique_id:null,url:null,credit:null,caption:null,credit_alternate:null,caption_alternate:null,link:null,link_target:null},this.options={api_key_flickr:"f2cc870b4d233dd0a5bfe73fd0d64ef0",api_key_googlemaps:"AIzaSyB9dW8e_iRrATFa8g24qB6BDBGdkrLDZYI",api_key_embedly:"",credit_height:0,caption_height:0,background:0},this.animator={},TL.Util.mergeData(this.options,b),TL.Util.mergeData(this.data,a),this.options.background||(this._el.container=TL.Dom.create("div","tl-media"),this.data.unique_id&&(this._el.container.id=this.data.unique_id),this._initLayout(),c&&(c.appendChild(this._el.container),this._el.parent=c))},loadMedia:function(){var a=this;if(!this._state.loaded)try{this.load_timer=setTimeout(function(){a.loadingMessage(),a._loadMedia(),a._updateDisplay()},1200)}catch(a){trace("Error loading media for ",this._media),trace(a)}},_updateMessage:function(a){this.message&&this.message.updateMessage(a)},loadingMessage:function(){this._updateMessage(this._("loading")+" "+this.options.media_name)},errorMessage:function(a){a=a?this._("error")+": "+a:this._("error"),this._updateMessage(a)},updateMediaDisplay:function(a){this._state.loaded&&!this.options.background&&(TL.Browser.mobile?this._el.content_item.style.maxHeight=this.options.height/2+"px":this._el.content_item.style.maxHeight=this.options.height-this.options.credit_height-this.options.caption_height-30+"px",this._el.container.style.maxWidth=this.options.width+"px",TL.Browser.firefox&&this._el.content_item.offsetWidth>this._el.content_item.offsetHeight,this._updateMediaDisplay(a),this._state.media_loaded&&(this._el.credit&&(this._el.credit.style.width=this._el.content_item.offsetWidth+"px"),this._el.caption&&(this._el.caption.style.width=this._el.content_item.offsetWidth+"px")))},_loadMedia:function(){this.onLoaded()},_updateMediaDisplay:function(a){TL.Browser.firefox&&(this._el.content_item.style.maxWidth=this.options.width+"px",this._el.content_item.style.width="auto")},_getMeta:function(){},_getImageURL:function(a,b){return""},show:function(){},hide:function(){},addTo:function(a){a.appendChild(this._el.container),this.onAdd()},removeFrom:function(a){a.removeChild(this._el.container),this.onRemove()},getImageURL:function(a,b){return this._getImageURL(a,b)},updateDisplay:function(a,b,c){this._updateDisplay(a,b,c)},stopMedia:function(){this._stopMedia()},loadErrorDisplay:function(a){try{this._el.content.removeChild(this._el.content_item)}catch(a){}this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-loaderror",this._el.content),this._el.content_item.innerHTML="<div class='tl-icon-"+this.options.media_type+"'></div><p>"+a+"</p>",this.onLoaded(!0)},onLoaded:function(a){this._state.loaded=!0,this.fire("loaded",this.data),this.message&&this.message.hide(),a||this.options.background||this.showMeta(),this.updateDisplay()},onMediaLoaded:function(a){this._state.media_loaded=!0,this.fire("media_loaded",this.data),this._el.credit&&(this._el.credit.style.width=this._el.content_item.offsetWidth+"px"),this._el.caption&&(this._el.caption.style.width=this._el.content_item.offsetWidth+"px")},showMeta:function(a,b){this._state.show_meta=!0,this.data.credit&&""!=this.data.credit&&(this._el.credit=TL.Dom.create("div","tl-credit",this._el.content_container),this._el.credit.innerHTML=1==this.options.autolink?TL.Util.linkify(this.data.credit):this.data.credit,this.options.credit_height=this._el.credit.offsetHeight),this.data.caption&&""!=this.data.caption&&(this._el.caption=TL.Dom.create("div","tl-caption",this._el.content_container),this._el.caption.innerHTML=1==this.options.autolink?TL.Util.linkify(this.data.caption):this.data.caption,this.options.caption_height=this._el.caption.offsetHeight),this.data.caption&&this.data.credit||this.getMeta()},getMeta:function(){this._getMeta()},updateMeta:function(){!this.data.credit&&this.data.credit_alternate&&(this._el.credit=TL.Dom.create("div","tl-credit",this._el.content_container),this._el.credit.innerHTML=this.data.credit_alternate,this.options.credit_height=this._el.credit.offsetHeight),!this.data.caption&&this.data.caption_alternate&&(this._el.caption=TL.Dom.create("div","tl-caption",this._el.content_container),this._el.caption.innerHTML=this.data.caption_alternate,this.options.caption_height=this._el.caption.offsetHeight),this.updateDisplay()},onAdd:function(){this.fire("added",this.data)},onRemove:function(){this.fire("removed",this.data)},_initLayout:function(){this.message=new TL.Message({},this.options),this.message.addTo(this._el.container),this._el.content_container=TL.Dom.create("div","tl-media-content-container",this._el.container),this.data.link&&""!=this.data.link?(this._el.link=TL.Dom.create("a","tl-media-link",this._el.content_container),this._el.link.href=this.data.link,this.data.link_target&&""!=this.data.link_target?this._el.link.target=this.data.link_target:this._el.link.target="_blank",this._el.content=TL.Dom.create("div","tl-media-content",this._el.link)):this._el.content=TL.Dom.create("div","tl-media-content",this._el.content_container)},_updateDisplay:function(a,b,c){a&&(this.options.width=a),b&&(this.options.height=b),c&&(this.options.layout=c),this._el.credit&&(this.options.credit_height=this._el.credit.offsetHeight),this._el.caption&&(this.options.caption_height=this._el.caption.offsetHeight+5),this.updateMediaDisplay(this.options.layout)},_stopMedia:function(){}}),TL.Media.Blockquote=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-blockquote",this._el.content),this._el.content_container.className="tl-media-content-container tl-media-content-container-text",this.media_id=this.data.url,this._el.content_item.innerHTML=this.media_id,this.onLoaded()},updateMediaDisplay:function(){},_updateMediaDisplay:function(){}}),TL.Media.DailyMotion=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a;this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-iframe tl-media-dailymotion",this._el.content),this.data.url.match("video")?this.media_id=this.data.url.split("video/")[1].split(/[?&]/)[0]:this.media_id=this.data.url.split("embed/")[1].split(/[?&]/)[0],a="https://www.dailymotion.com/embed/video/"+this.media_id+"?api=postMessage",this._el.content_item.innerHTML="<iframe autostart='false' frameborder='0' width='100%' height='100%' src='"+a+"'></iframe>",this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=TL.Util.ratio.r16_9({w:this._el.content_item.offsetWidth})+"px"},_stopMedia:function(){this._el.content_item.querySelector("iframe").contentWindow.postMessage('{"command":"pause","parameters":[]}',"*")}}),TL.Media.DocumentCloud=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a=this;this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-documentcloud tl-media-shadow",this._el.content),this._el.content_item.id=TL.Util.unique_ID(7),this.data.url.match(/\.html$/)?this.data.url=this._transformURL(this.data.url):this.data.url.match(/.(json|js)$/)||trace("DOCUMENT CLOUD IN URL BUT INVALID SUFFIX"),TL.Load.js(["https://assets.documentcloud.org/viewer/loader.js","https://assets.documentcloud.org/viewer/viewer.js"],function(){a.createMedia()})},_transformURL:function(a){return a.replace(/(.*)\.html$/,"$1.js")},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"},createMedia:function(){DV.load(this.data.url,{container:"#"+this._el.content_item.id,showSidebar:!1}),this.onLoaded()}}),TL.Media.Flickr=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a,b=this;try{this.establishMediaID(),a="https://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key="+this.options.api_key_flickr+"&photo_id="+this.media_id+"&format=json&jsoncallback=?",TL.getJSON(a,function(a){"ok"==a.stat?(b.sizes=a.sizes.size,b.options.background||b.createMedia(),b.onLoaded()):b.loadErrorDisplay(b._("flickr_notfound_err"))})}catch(a){b.loadErrorDisplay(b._(a.message_key))}},establishMediaID:function(){if(this.data.url.match(/flic.kr\/.+/i)){var a=this.data.url.split("/").slice(-1)[0];this.media_id=TL.Util.base58.decode(a)}else{var b="flickr.com/photos/",c=this.data.url.indexOf(b);if(c==-1)throw new TL.Error("flickr_invalidurl_err");var d=c+b.length;this.media_id=this.data.url.substr(d).split("/")[1]}},createMedia:function(){var a=this;this._el.content_link=TL.Dom.create("a","",this._el.content),this._el.content_link.href=this.data.url,this._el.content_link.target="_blank",this._el.content_item=TL.Dom.create("img","tl-media-item tl-media-image tl-media-flickr tl-media-shadow",this._el.content_link),this._el.content_item.addEventListener("load",function(b){a.onMediaLoaded()}),this._el.content_item.src=this.getImageURL(this.options.width,this.options.height)},getImageURL:function(a,b){for(var c=this.size_label(b),d=this.sizes[this.sizes.length-2].source,e=0;e<this.sizes.length;e++)this.sizes[e].label==c&&(d=this.sizes[e].source);return d},_getMeta:function(){var b,a=this;b="https://api.flickr.com/services/rest/?method=flickr.photos.getInfo&api_key="+this.options.api_key_flickr+"&photo_id="+this.media_id+"&format=json&jsoncallback=?",TL.getJSON(b,function(b){a.data.credit_alternate="<a href='"+a.data.url+"' target='_blank'>"+b.photo.owner.realname+"</a>",a.data.caption_alternate=b.photo.title._content+" "+b.photo.description._content,a.updateMeta()})},size_label:function(a){var b="";return b=a<=75?a<=0?"Large":"Thumbnail":a<=180?"Small":a<=240?"Small 320":a<=375?"Medium":a<=480?"Medium 640":"Large"}}),TL.Media.GoogleDoc=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a;if(this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-iframe",this._el.content),this.data.url.match("open?id="))this.media_id=this.data.url.split("open?id=")[1],this.data.url.match("&authuser=0")&&(a=this.media_id.match("&authuser=0")[0]);else if(this.data.url.match(/file\/d\/([^/]*)\/?/)){var c=this.data.url.match(/file\/d\/([^/]*)\/?/)[1];a="https://drive.google.com/file/d/"+c+"/preview"}else a=this.data.url;this._el.content_item.innerHTML="<iframe class='doc' frameborder='0' width='100%' height='100%' src='"+a+"'></iframe>",this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}}),TL.Media.GooglePlus=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a;this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-googleplus",this._el.content),this.media_id=this.data.url,a=this.media_id,this._el.content_item.innerHTML="<iframe frameborder='0' width='100%' height='100%' src='"+a+"'></iframe>",this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}}),TL.Media.IFrame=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a;this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-iframe",this._el.content),this.media_id=this.data.url,a=this.media_id,this._el.content_item.innerHTML=a,this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}}),TL.Media.Image=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){this.loadingMessage(),this.options.background||this.createMedia(),this.onLoaded()},createMedia:function(){var a=this,b="tl-media-item tl-media-image tl-media-shadow";(this.data.url.match(/.png(\?.*)?$/)||this.data.url.match(/.svg(\?.*)?$/))&&(b="tl-media-item tl-media-image"),this.data.link?(this._el.content_link=TL.Dom.create("a","",this._el.content),this._el.content_link.href=this.data.link,this._el.content_link.target="_blank",this._el.content_item=TL.Dom.create("img",b,this._el.content_link)):this._el.content_item=TL.Dom.create("img",b,this._el.content),this._el.content_item.addEventListener("load",function(b){a.onMediaLoaded()}),this._el.content_item.src=this.getImageURL()},getImageURL:function(a,b){return TL.Util.transformImageURL(this.data.url)},_updateMediaDisplay:function(a){TL.Browser.firefox&&(this._el.content_item.style.width="auto")}}),TL.Media.Imgur=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){try{this.media_id=this.data.url.split("/").slice(-1)[0],this.options.background||this.createMedia(),this.onLoaded()}catch(a){this.loadErrorDisplay(this._("imgur_invalidurl_err"))}},createMedia:function(){var a=this;this._el.content_link=TL.Dom.create("a","",this._el.content),this._el.content_link.href=this.data.url,this._el.content_link.target="_blank",this._el.content_item=TL.Dom.create("img","tl-media-item tl-media-image tl-media-imgur tl-media-shadow",this._el.content_link),this._el.content_item.addEventListener("load",function(b){a.onMediaLoaded()}),this._el.content_item.src=this.getImageURL()},getImageURL:function(a,b){return"https://i.imgur.com/"+this.media_id+".jpg"}}),TL.Media.Instagram=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){this.media_id=this.data.url.split("/p/")[1].split("/")[0],this.options.background||this.createMedia(),this.onLoaded()},createMedia:function(){var a=this;this._el.content_link=TL.Dom.create("a","",this._el.content),this._el.content_link.href=this.data.url,this._el.content_link.target="_blank",this._el.content_item=TL.Dom.create("img","tl-media-item tl-media-image tl-media-instagram tl-media-shadow",this._el.content_link),this._el.content_item.addEventListener("load",function(b){a.onMediaLoaded()}),this._el.content_item.src=this.getImageURL(this._el.content.offsetWidth)},getImageURL:function(a,b){return"https://instagram.com/p/"+this.media_id+"/media/?size="+this.sizes(a)},_getMeta:function(){var b,a=this;b="https://api.instagram.com/oembed?url=https://instagr.am/p/"+this.media_id+"&callback=?",TL.getJSON(b,function(b){a.data.credit_alternate="<a href='"+b.author_url+"' target='_blank'>"+b.author_name+"</a>",a.data.caption_alternate=b.title,a.updateMeta()})},sizes:function(a){var b="";return b=a<=150?"t":a<=306?"m":"l"}}),TL.Media.GoogleMap=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-map tl-media-shadow",this._el.content),this.media_id=this.data.url,this.mapframe=TL.Dom.create("iframe","",this._el.content_item),window.stash=this,this.mapframe.width="100%",this.mapframe.height="100%",this.mapframe.frameBorder="0",this.mapframe.src=this.makeGoogleMapsEmbedURL(this.media_id,this.options.api_key_googlemaps),this.onLoaded()},_updateMediaDisplay:function(){if(this._state.loaded){var a=TL.Util.ratio.square({w:this._el.content_item.offsetWidth});this._el.content_item.style.height=a.h+"px"}},makeGoogleMapsEmbedURL:function(a,b){function d(a){function d(b,d){if("z"==b.slice(-1))d.zoom=b;else if("m"==b.slice(-1))d.zoom=14,d.maptype="satellite";else if("t"==b.slice(-1)){if(c=!0,"place"==mapmode)var f=a.match(k.place)[3]+","+a.match(k.place)[4];else{var f=d.center;delete d.center}d={},d.location=f,streetview_params=b.split(",");for(param in e.streetview){var g=parseInt(param)+1;"pitch"==e.streetview[param]&&"90t"==streetview_params[g]?d[e.streetview[param]]=0:d[e.streetview[param]]=streetview_params[g].slice(0,-1)}}return d}function f(a,f){var g={},h=f[1],i=f[f.length-1];for(param in e[a]){var j=parseInt(param)+2;"center"==e[a][param]?g[e[a][param]]=f[j]+","+f[++j]:g[e[a][param]]=f[j]}return g=d(i,g),g.key=b,1==c&&(a="streetview"),h+"/embed/v1/"+a+TL.Util.getParamString(g)}return mapmode="view",a.match(k.place)?mapmode="place":a.match(k.directions)?mapmode="directions":a.match(k.search)&&(mapmode="search"),f(mapmode,a.match(k[mapmode]))}var c=!1,e={view:["center"],place:["q","center"],directions:["origin","destination","center"],search:["q","center"],streetview:["fov","heading","pitch"]},f=/(https:\/\/.+google.+?\/maps)/,g=/@([-\d.]+),([-\d.]+)/,h=/([\w\W]+)/,j=/,((?:[-\d.]+[zmayht],?)*)/,k={view:new RegExp(f.source+"/"+g.source+j.source),place:new RegExp(f.source+"/place/"+h.source+"/"+g.source+j.source),directions:new RegExp(f.source+"/dir/"+h.source+"/"+h.source+"/"+g.source+j.source),search:new RegExp(f.source+"/search/"+h.source+"/"+g.source+j.source)};return d(a)}}),TL.Media.PDF=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a=TL.Util.transformImageURL(this.data.url);this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-iframe",this._el.content);var c="";c=TL.Browser.ie||TL.Browser.edge||a.match(/dl.dropboxusercontent.com/)?"<iframe class='doc' frameborder='0' width='100%' height='100%' src='//docs.google.com/viewer?url="+a+"&amp;embedded=true'></iframe>":"<iframe class='doc' frameborder='0' width='100%' height='100%' src='"+a+"'></iframe>",this._el.content_item.innerHTML=c,this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}}),TL.Media.Profile=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){this._el.content_item=TL.Dom.create("img","tl-media-item tl-media-image tl-media-profile tl-media-shadow",this._el.content),this._el.content_item.src=this.data.url,this.onLoaded()},_updateMediaDisplay:function(a){TL.Browser.firefox&&(this._el.content_item.style.maxWidth=this.options.width/2-40+"px")}}),TL.Media.Slider=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){this._el.content_item=TL.Dom.create("img","tl-media-item tl-media-image",this._el.content),this._el.content_item.src=this.data.url,this.onLoaded()}});var soundCoudCreated=!1;TL.Media.SoundCloud=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a,b=this;this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-iframe tl-media-soundcloud tl-media-shadow",this._el.content),this.media_id=this.data.url,a="https://soundcloud.com/oembed?url="+this.media_id+"&format=js&callback=?",TL.getJSON(a,function(a){TL.Load.js("https://w.soundcloud.com/player/api.js",function(){b.createMedia(a)})})},createMedia:function(a){this._el.content_item.innerHTML=a.html,this.soundCloudCreated=!0,self.widget=SC.Widget(this._el.content_item.querySelector("iframe")),this.onLoaded()},_stopMedia:function(){this.soundCloudCreated&&self.widget.pause()}}),TL.Media.Spotify=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a;if(this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-iframe tl-media-spotify",this._el.content),(this.data.url.match(/^spotify:track/)||this.data.url.match(/^spotify:user:.+:playlist:/))&&(this.media_id=this.data.url),this.data.url.match(/spotify.com\/track\/(.+)/))this.media_id="spotify:track:"+this.data.url.match(/spotify.com\/track\/(.+)/)[1];else if(this.data.url.match(/spotify.com\/user\/(.+?)\/playlist\/(.+)/)){var c=this.data.url.match(/spotify.com\/user\/(.+?)\/playlist\/(.+)/)[1],d=this.data.url.match(/spotify.com\/user\/(.+?)\/playlist\/(.+)/)[2];this.media_id="spotify:user:"+c+":playlist:"+d}this.media_id?(a="https://embed.spotify.com/?uri="+this.media_id+"&theme=white&view=coverart",this.player=TL.Dom.create("iframe","tl-media-shadow",this._el.content_item),this.player.width="100%",this.player.height="100%",this.player.frameBorder="0",this.player.src=a,this.onLoaded()):this.loadErrorDisplay(this._("spotify_invalid_url"))},_updateMediaDisplay:function(a){var b=this.options.height,c=0,d=0;b=TL.Browser.mobile?this.options.height/2:this.options.height-this.options.credit_height-this.options.caption_height-30,this._el.content_item.style.maxHeight="none",trace(b),trace(this.options.width),b>this.options.width?(trace("height is greater"),c=this.options.width+80+"px",d=this.options.width+"px"):(trace("width is greater"),trace(this.options.width),c=b+"px",d=b-80+"px"),this.player.style.width=d,this.player.style.height=c,this._el.credit&&(this._el.credit.style.width=d),this._el.caption&&(this._el.caption.style.width=d)},_stopMedia:function(){}}),TL.Media.Storify=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a;this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-iframe tl-media-storify",this._el.content),this.media_id=this.data.url,a="<iframe frameborder='0' width='100%' height='100%' src='"+this.media_id+"/embed'></iframe>",a+="<script src='"+this.media_id+".js'></script>",this._el.content_item.innerHTML=a,this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=this.options.height+"px"}}),TL.Media.Text=TL.Class.extend({includes:[TL.Events],_el:{container:{},content_container:{},content:{},headline:{},date:{}},data:{unique_id:"",headline:"headline",text:"text"},options:{title:!1},initialize:function(a,b,c){TL.Util.setData(this,a),TL.Util.mergeData(this.options,b),this._el.container=TL.Dom.create("div","tl-text"),this._el.container.id=this.data.unique_id,this._initLayout(),c&&c.appendChild(this._el.container)},show:function(){},hide:function(){},addTo:function(a){a.appendChild(this._el.container)},removeFrom:function(a){a.removeChild(this._el.container)},headlineHeight:function(){return this._el.headline.offsetHeight+40},addDateText:function(a){this._el.date.innerHTML=a},onLoaded:function(){this.fire("loaded",this.data)},onAdd:function(){this.fire("added",this.data)},onRemove:function(){this.fire("removed",this.data)},_initLayout:function(){if(this._el.content_container=TL.Dom.create("div","tl-text-content-container",this._el.container),this._el.date=TL.Dom.create("h3","tl-headline-date",this._el.content_container),""!=this.data.headline){var a="tl-headline";this.options.title&&(a="tl-headline tl-headline-title"),this._el.headline=TL.Dom.create("h2",a,this._el.content_container),this._el.headline.innerHTML=this.data.headline}if(""!=this.data.text){var b="";b+=TL.Util.htmlify(1==this.options.autolink?TL.Util.linkify(this.data.text):this.data.text),trace(this.data.text),this._el.content=TL.Dom.create("div","tl-text-content",this._el.content_container),this._el.content.innerHTML=b,trace(b),trace(this._el.content)}this.onLoaded()}}),TL.Media.Twitter=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a,b=this;this._el.content_item=TL.Dom.create("div","tl-media-twitter",this._el.content),this._el.content_container.className="tl-media-content-container tl-media-content-container-text",this.data.url.match("status/")?this.media_id=this.data.url.split("status/")[1]:this.data.url.match("statuses/")?this.media_id=this.data.url.split("statuses/")[1]:this.media_id="",a="https://api.twitter.com/1/statuses/oembed.json?id="+this.media_id+"&omit_script=true&include_entities=true&callback=?",TL.ajax({type:"GET",url:a,dataType:"json",success:function(a){b.createMedia(a)},error:function(a,c){var d="";d+=b._("twitter_load_err")+"<br/>"+b.media_id+"<br/>"+c,b.loadErrorDisplay(d)}})},createMedia:function(a){var b="",c="",d="",e="",f="",g="";c=a.html.split("</p>&mdash;")[0]+"</p></blockquote>",d=a.author_url.split("twitter.com/")[1],e=a.html.split("</p>&mdash;")[1].split('<a href="')[1],f=e.split('">')[0],g=e.split('">')[1].split("</a>")[0],c=c.replace(/<a href/gi,'<a class="tl-makelink" target="_blank" href'),b+=c,b+="<div class='vcard'>",b+="<a href='"+f+"' class='twitter-date' target='_blank'>"+g+"</a>",b+="<div class='author'>",b+="<a class='screen-name url' href='"+a.author_url+"' target='_blank'>",b+="<span class='avatar'></span>",b+="<span class='fn'>"+a.author_name+" <span class='tl-icon-twitter'></span></span>",b+="<span class='nickname'>@"+d+"<span class='thumbnail-inline'></span></span>",b+="</a>",b+="</div>",b+="</div>",this._el.content_item.innerHTML=b,this.onLoaded()},updateMediaDisplay:function(){},_updateMediaDisplay:function(){}}),TL.Media.TwitterEmbed=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a,b=this;this._el.content_item=TL.Dom.create("div","tl-media-twitter",this._el.content),this._el.content_container.className="tl-media-content-container tl-media-content-container-text";var c=this.data.url.match(/(status|statuses)\/(\d+)/);return c&&c.length>2?(this.media_id=c[2],a="https://api.twitter.com/1/statuses/oembed.json?id="+this.media_id+"&omit_script=true&include_entities=true&callback=?",void TL.ajax({type:"GET",url:a,dataType:"json",success:function(a){b.createMedia(a)},error:function(a,c){var d="";d+=b._("twitter_load_err")+"<br/>"+b.media_id+"<br/>"+c,b.loadErrorDisplay(d)}})):void b.loadErrorDisplay(b._("twitterembed_invalidurl_err"))},createMedia:function(a){trace("create_media");var b="",c="",d="",e="",f="",g="";c=a.html.split("</p>&mdash;")[0]+"</p></blockquote>",d=a.author_url.split("twitter.com/")[1],e=a.html.split("</p>&mdash;")[1].split('<a href="')[1],f=e.split('">')[0],g=e.split('">')[1].split("</a>")[0],c=c.replace(/<a href/gi,'<a target="_blank" href'),b+=c,b+="<div class='vcard'>",b+="<a href='"+f+"' class='twitter-date' target='_blank'>"+g+"</a>",b+="<div class='author'>",b+="<a class='screen-name url' href='"+a.author_url+"' target='_blank'>",b+="<span class='avatar'></span>",b+="<span class='fn'>"+a.author_name+" <span class='tl-icon-twitter'></span></span>",b+="<span class='nickname'>@"+d+"<span class='thumbnail-inline'></span></span>",b+="</a>",b+="</div>",b+="</div>",this._el.content_item.innerHTML=b,this.onLoaded()},updateMediaDisplay:function(){},_updateMediaDisplay:function(){}}),TL.Media.Vimeo=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a,b=this;this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-iframe tl-media-vimeo tl-media-shadow",this._el.content),this.media_id=this.data.url.split(/video\/|\/\/vimeo\.com\//)[1].split(/[?&]/)[0],a="https://player.vimeo.com/video/"+this.media_id+"?api=1&title=0&amp;byline=0&amp;portrait=0&amp;color=ffffff",this.player=TL.Dom.create("iframe","",this._el.content_item),this.player.addEventListener("load",function(a){b.onMediaLoaded()}),this.player.width="100%",this.player.height="100%",this.player.frameBorder="0",this.player.src=a,this.onLoaded()},_updateMediaDisplay:function(){this._el.content_item.style.height=TL.Util.ratio.r16_9({w:this._el.content_item.offsetWidth})+"px"},_stopMedia:function(){try{this.player.contentWindow.postMessage(JSON.stringify({method:"pause"}),"https://player.vimeo.com")}catch(a){trace(a)}}}),TL.Media.Vine=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a;this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-iframe tl-media-vine tl-media-shadow",this._el.content),this.media_id=this.data.url.split("vine.co/v/")[1],a="https://vine.co/v/"+this.media_id+"/embed/simple",this._el.content_item.innerHTML="<iframe frameborder='0' width='100%' height='100%' src='"+a+"'></iframe><script async src='https://platform.vine.co/static/scripts/embed.js' charset='utf-8'></script>",this.onLoaded()},_updateMediaDisplay:function(){var a=TL.Util.ratio.square({w:this._el.content_item.offsetWidth,h:this.options.height});this._el.content_item.style.height=a.h+"px"},_stopMedia:function(){this._el.content_item.querySelector("iframe").contentWindow.postMessage("pause","*")}}),TL.Media.Website=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a=this;this.media_id=this.data.url.replace(/.*?:\/\//g,""),this.options.api_key_embedly?(api_url="https://api.embed.ly/1/extract?key="+this.options.api_key_embedly+"&url="+this.media_id+"&callback=?",TL.getJSON(api_url,function(b){a.createMedia(b)})):this.createCardContent()},createCardContent:function(){!function(a,b){var c="embedly-platform",d="script";if(!b.getElementById(c)){a.embedly=a.embedly||function(){(a.embedly.q=a.embedly.q||[]).push(arguments)};var e=b.createElement(d);e.id=c,e.async=1,e.src=("https:"===document.location.protocol?"https":"http")+"://cdn.embedly.com/widgets/platform.js";var f=b.getElementsByTagName(d)[0];f.parentNode.insertBefore(e,f)}}(window,document);var a='<a href="'+this.data.url+'" class="embedly-card">'+this.data.url+"</a>";this._setContent(a)},createMedia:function(a){var b="";b+="<h4><a href='"+this.data.url+"' target='_blank'>"+a.title+"</a></h4>",a.images&&a.images[0]&&(trace(a.images[0].url),b+="<img src='"+a.images[0].url+"' />"),a.favicon_url&&(b+="<img class='tl-media-website-icon' src='"+a.favicon_url+"' />"),b+="<span class='tl-media-website-description'>"+a.provider_name+"</span><br/>",b+="<p>"+a.description+"</p>",this._setContent(b)},_setContent:function(a){this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-website",this._el.content),this._el.content_container.className="tl-media-content-container tl-media-content-container-text",this._el.content_item.innerHTML=a,this.onLoaded()},updateMediaDisplay:function(){},_updateMediaDisplay:function(){}}),TL.Media.Wikipedia=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var a,b,c=this;this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-wikipedia",this._el.content),this._el.content_container.className="tl-media-content-container tl-media-content-container-text",this.media_id=this.data.url.split("wiki/")[1].split("#")[0].replace("_"," "),this.media_id=this.media_id.replace(" ","%20"),b=this.data.url.split("//")[1].split(".wikipedia")[0],a="https://"+b+".wikipedia.org/w/api.php?action=query&prop=extracts|pageimages&redirects=&titles="+this.media_id+"&exintro=1&format=json&callback=?",TL.ajax({type:"GET",url:a,dataType:"json",success:function(a){c.createMedia(a)},error:function(a,b){var d="";d+=c._("wikipedia_load_err")+"<br/>"+c.media_id+"<br/>"+b,c.loadErrorDisplay(d)}})},createMedia:function(a){var b="";if(a.query){var c="",b={entry:{},title:"",text:"",extract:"",paragraphs:1,page_image:"",text_array:[]};b.entry=TL.Util.getObjectAttributeByIndex(a.query.pages,0),b.extract=b.entry.extract,b.title=b.entry.title,b.page_image=b.entry.thumbnail,b.extract.match("<p>")?b.text_array=b.extract.split("<p>"):b.text_array.push(b.extract);for(var d=0;d<b.text_array.length;d++)d+1<=b.paragraphs&&d+1<b.text_array.length&&(b.text+="<p>"+b.text_array[d+1]);c+="<span class='tl-icon-wikipedia'></span>",c+="<div class='tl-wikipedia-title'><h4><a href='"+this.data.url+"' target='_blank'>"+b.title+"</a></h4>",c+="<span class='tl-wikipedia-source'>"+this._("wikipedia")+"</span></div>",b.page_image,c+=b.text,b.extract.match("REDIRECT")||(this._el.content_item.innerHTML=c,this.onLoaded())}},updateMediaDisplay:function(){},_updateMediaDisplay:function(){}}),TL.Media.YouTube=TL.Media.extend({includes:[TL.Events],_loadMedia:function(){var b,a=this;this.youtube_loaded=!1,this._el.content_item=TL.Dom.create("div","tl-media-item tl-media-youtube tl-media-shadow",this._el.content),this._el.content_item.id=TL.Util.unique_ID(7),b=TL.Util.getUrlVars(this.data.url),this.media_id={},this.data.url.match("v=")?this.media_id.id=b.v:this.data.url.match("/embed/")?this.media_id.id=this.data.url.split("embed/")[1].split(/[?&]/)[0]:this.data.url.match(/v\/|v=|youtu\.be\//)?this.media_id.id=this.data.url.split(/v\/|v=|youtu\.be\//)[1].split(/[?&]/)[0]:trace("YOUTUBE IN URL BUT NOT A VALID VIDEO"),this.media_id.start=TL.Util.parseYouTubeTime(b.t),this.media_id.hd=Boolean("undefined"!=typeof b.hd),TL.Load.js("https://www.youtube.com/iframe_api",function(){a.createMedia()})},_updateMediaDisplay:function(){this._el.content_item.style.height=TL.Util.ratio.r16_9({w:this.options.width})+"px",this._el.content_item.style.width=this.options.width+"px"},_stopMedia:function(){if(this.youtube_loaded)try{this.player.getPlayerState()==YT.PlayerState.PLAYING&&this.player.pauseVideo()}catch(a){trace(a)}},createMedia:function(){var a=this;clearTimeout(this.timer),"undefined"!=typeof YT&&"undefined"!=typeof YT.Player?this.player=new YT.Player(this._el.content_item.id,{playerVars:{enablejsapi:1,color:"white",autohide:1,showinfo:0,theme:"light",start:this.media_id.start,fs:0,rel:0},videoId:this.media_id.id,events:{onReady:function(){a.onPlayerReady(),a.onLoaded()},onStateChange:a.onStateChange}}):this.timer=setTimeout(function(){a.createMedia()},1e3)},onPlayerReady:function(a){this.youtube_loaded=!0,
this._el.content_item=document.getElementById(this._el.content_item.id),this.onMediaLoaded()},onStateChange:function(a){a.data==YT.PlayerState.ENDED&&(a.target.seekTo(0),a.target.pauseVideo())}}),TL.Slide=TL.Class.extend({includes:[TL.Events,TL.DomMixins,TL.I18NMixins],_el:{},initialize:function(a,b,c){this._el={container:{},scroll_container:{},background:{},content_container:{},content:{}},this._media=null,this._mediaclass={},this._text={},this._background_media=null,this._state={loaded:!1},this.has={headline:!1,text:!1,media:!1,title:!1,background:{image:!1,color:!1,color_value:""}},this.has.title=c,this.data={unique_id:null,background:null,start_date:null,end_date:null,location:null,text:null,media:null,autolink:!0},this.options={duration:1e3,slide_padding_lr:40,ease:TL.Ease.easeInSpline,width:600,height:600,skinny_size:650,media_name:""},this.active=!1,this.animator={},TL.Util.mergeData(this.options,b),TL.Util.mergeData(this.data,a),this._initLayout(),this._initEvents()},show:function(){this.animator=TL.Animate(this._el.slider_container,{left:-(this._el.container.offsetWidth*n)+"px",duration:this.options.duration,easing:this.options.ease})},hide:function(){},setActive:function(a){this.active=a,this.active?(this.data.background&&this.fire("background_change",this.has.background),this.loadMedia()):this.stopMedia()},addTo:function(a){a.appendChild(this._el.container)},removeFrom:function(a){a.removeChild(this._el.container)},updateDisplay:function(a,b,c){this._updateDisplay(a,b,c)},loadMedia:function(){var a=this;this._media&&!this._state.loaded&&(this._media.loadMedia(),this._state.loaded=!0),this._background_media&&!this._background_media._state.loaded&&(this._background_media.on("loaded",function(){a._updateBackgroundDisplay()}),this._background_media.loadMedia())},stopMedia:function(){this._media&&this._state.loaded&&this._media.stopMedia()},getBackground:function(){return this.has.background},scrollToTop:function(){this._el.container.scrollTop=0},getFormattedDate:function(){if(TL.Util.trim(this.data.display_date).length>0)return this.data.display_date;var a="";return this.has.title||(this.data.end_date&&(a=" &mdash; "+this.data.end_date.getDisplayDate(this.getLanguage())),this.data.start_date&&(a=this.data.start_date.getDisplayDate(this.getLanguage())+a)),a},_initLayout:function(){if(this._el.container=TL.Dom.create("div","tl-slide"),this.has.title&&(this._el.container.className="tl-slide tl-slide-titleslide"),this.data.unique_id&&(this._el.container.id=this.data.unique_id),this._el.scroll_container=TL.Dom.create("div","tl-slide-scrollable-container",this._el.container),this._el.content_container=TL.Dom.create("div","tl-slide-content-container",this._el.scroll_container),this._el.content=TL.Dom.create("div","tl-slide-content",this._el.content_container),this._el.background=TL.Dom.create("div","tl-slide-background",this._el.container),this.data.background){if(this.data.background.url){var a=TL.MediaType(this.data.background,!0);a&&(this._background_media=new a.cls(this.data.background,{background:1}),this.has.background.image=!0,this._el.container.className+=" tl-full-image-background",this.has.background.color_value="#000",this._el.background.style.display="block")}this.data.background.color&&(this.has.background.color=!0,this._el.container.className+=" tl-full-color-background",this.has.background.color_value=this.data.background.color),this.data.background.text_background&&(this._el.container.className+=" tl-text-background")}this.data.media&&this.data.media.url&&""!=this.data.media.url&&(this.has.media=!0),this.data.text&&this.data.text.text&&(this.has.text=!0),this.data.text&&this.data.text.headline&&(this.has.headline=!0),this.has.media&&(this.data.media.mediatype=TL.MediaType(this.data.media),this.options.media_name=this.data.media.mediatype.name,this.options.media_type=this.data.media.mediatype.type,this.options.autolink=this.data.autolink,this._media=new this.data.media.mediatype.cls(this.data.media,this.options)),(this.has.text||this.has.headline)&&(this._text=new TL.Media.Text(this.data.text,{title:this.has.title,language:this.options.language,autolink:this.data.autolink}),this._text.addDateText(this.getFormattedDate())),this.has.text||this.has.headline||!this.has.media?this.has.headline&&this.has.media&&!this.has.text?(TL.DomUtil.addClass(this._el.container,"tl-slide-media-only"),this._text.addTo(this._el.content),this._media.addTo(this._el.content)):this.has.text&&this.has.media?(this._media.addTo(this._el.content),this._text.addTo(this._el.content)):(this.has.text||this.has.headline)&&(TL.DomUtil.addClass(this._el.container,"tl-slide-text-only"),this._text.addTo(this._el.content)):(TL.DomUtil.addClass(this._el.container,"tl-slide-media-only"),this._media.addTo(this._el.content)),this.onLoaded()},_initEvents:function(){},_updateDisplay:function(a,b,c){var d,e=this.options.slide_padding_lr,f=this.options.slide_padding_lr;a?this.options.width=a:this.options.width=this._el.container.offsetWidth,d=this.options.width-2*this.options.slide_padding_lr,TL.Browser.mobile&&this.options.width<=this.options.skinny_size?(e=0,f=0,d=this.options.width):"landscape"==c||this.options.width<=this.options.skinny_size&&(e=50,f=50,d=this.options.width-e-f),this._el.content.style.paddingLeft=e+"px",this._el.content.style.paddingRight=f+"px",this._el.content.style.width=d+"px",b?this.options.height=b:this.options.height=this._el.container.offsetHeight,this._media&&(!this.has.text&&this.has.headline?this._media.updateDisplay(d,this.options.height-this._text.headlineHeight(),c):this.has.text||this.has.headline?this.options.width<=this.options.skinny_size?this._media.updateDisplay(d,this.options.height,c):this._media.updateDisplay(d/2,this.options.height,c):this._media.updateDisplay(d,this.options.height,c)),this._updateBackgroundDisplay()},_updateBackgroundDisplay:function(){this._background_media&&this._background_media._state.loaded&&(this._el.background.style.backgroundImage="url('"+this._background_media.getImageURL(this.options.width,this.options.height)+"')")}}),TL.SlideNav=TL.Class.extend({includes:[TL.Events,TL.DomMixins],_el:{},initialize:function(a,b,c){this._el={container:{},content_container:{},icon:{},title:{},description:{}},this.mediatype={},this.data={title:"Navigation",description:"Description",date:"Date"},this.options={direction:"previous"},this.animator=null,TL.Util.mergeData(this.options,b),TL.Util.mergeData(this.data,a),this._el.container=TL.Dom.create("div","tl-slidenav-"+this.options.direction),TL.Browser.mobile&&this._el.container.setAttribute("ontouchstart"," "),this._initLayout(),this._initEvents(),c&&c.appendChild(this._el.container)},update:function(a){var b={title:"",description:"",date:a.getFormattedDate()};a.data.text&&a.data.text.headline&&(b.title=a.data.text.headline),this._update(b)},setColor:function(a){a?this._el.content_container.className="tl-slidenav-content-container tl-slidenav-inverted":this._el.content_container.className="tl-slidenav-content-container"},_onMouseClick:function(){this.fire("clicked",this.options)},_update:function(a){this.data=TL.Util.mergeData(this.data,a),this._el.title.innerHTML=TL.Util.unlinkify(this.data.title),this._el.description.innerHTML=TL.Util.unlinkify(this.data.date)},_initLayout:function(){this._el.content_container=TL.Dom.create("div","tl-slidenav-content-container",this._el.container),this._el.icon=TL.Dom.create("div","tl-slidenav-icon",this._el.content_container),this._el.title=TL.Dom.create("div","tl-slidenav-title",this._el.content_container),this._el.description=TL.Dom.create("div","tl-slidenav-description",this._el.content_container),this._el.icon.innerHTML="&nbsp;",this._update()},_initEvents:function(){TL.DomEvent.addListener(this._el.container,"click",this._onMouseClick,this)}}),TL.StorySlider=TL.Class.extend({includes:[TL.Events,TL.I18NMixins],initialize:function(a,b,c,d){this._el={container:{},background:{},slider_container_mask:{},slider_container:{},slider_item_container:{}},this._nav={},this._nav.previous={},this._nav.next={},this.slide_spacing=0,this._slides=[],this._swipable,this.preloadTimer,this._message,this.current_id="",this.data={},this.options={id:"",layout:"portrait",width:600,height:600,default_bg_color:{r:255,g:255,b:255},slide_padding_lr:40,start_at_slide:1,slide_default_fade:"0%",duration:1e3,ease:TL.Ease.easeInOutQuint,dragging:!0,trackResize:!0},"object"==typeof a?(this._el.container=a,this.options.id=TL.Util.unique_ID(6,"tl")):(this.options.id=a,this._el.container=TL.Dom.get(a)),this._el.container.id||(this._el.container.id=this.options.id),this.animator=null,TL.Util.mergeData(this.options,c),TL.Util.mergeData(this.data,b),d&&this.init()},init:function(){this._initLayout(),this._initEvents(),this._initData(),this._updateDisplay(),this.goTo(this.options.start_at_slide),this._onLoaded()},_addSlide:function(a){a.addTo(this._el.slider_item_container),a.on("added",this._onSlideAdded,this),a.on("background_change",this._onBackgroundChange,this)},_createSlide:function(a,b,c){var d=new TL.Slide(a,this.options,b);this._addSlide(d),c<0?this._slides.push(d):this._slides.splice(c,0,d)},_createSlides:function(a){for(var b=0;b<a.length;b++)""==a[b].unique_id&&(a[b].unique_id=TL.Util.unique_ID(6,"tl-slide")),this._createSlide(a[b],!1,-1)},_removeSlide:function(a){a.removeFrom(this._el.slider_item_container),a.off("added",this._onSlideRemoved,this),a.off("background_change",this._onBackgroundChange)},_destroySlide:function(a){this._removeSlide(this._slides[a]),this._slides.splice(a,1)},_findSlideIndex:function(a){var b=a;return("string"==typeof a||a instanceof String)&&(b=TL.Util.findArrayNumberByUniqueID(a,this._slides,"unique_id")),b},updateDisplay:function(a,b,c,d){this._updateDisplay(a,b,c,d)},createSlide:function(a,b){this._createSlide(a,!1,b)},createSlides:function(a){this._createSlides(a)},destroySlide:function(a){this._destroySlide(a)},destroySlideId:function(a){this.destroySlide(this._findSlideIndex(a))},goTo:function(a,b,c){a=parseInt(a),isNaN(a)&&(a=0);var d=this;this.changeBackground({color_value:"",image:!1}),this.preloadTimer&&clearTimeout(this.preloadTimer);for(var e=0;e<this._slides.length;e++)this._slides[e].setActive(!1);a<this._slides.length&&a>=0&&(this.current_id=this._slides[a].data.unique_id,this.animator&&this.animator.stop(),this._swipable&&this._swipable.stopMomentum(),b?(this._el.slider_container.style.left=-(this.slide_spacing*a)+"px",this._onSlideChange(c)):this.animator=TL.Animate(this._el.slider_container,{left:-(this.slide_spacing*a)+"px",duration:this.options.duration,easing:this.options.ease,complete:this._onSlideChange(c)}),this._slides[a].setActive(!0),this._slides[a+1]?(this.showNav(this._nav.next,!0),this._nav.next.update(this._slides[a+1])):this.showNav(this._nav.next,!1),this._slides[a-1]?(this.showNav(this._nav.previous,!0),this._nav.previous.update(this._slides[a-1])):this.showNav(this._nav.previous,!1),this.preloadTimer=setTimeout(function(){d.preloadSlides(a)},this.options.duration))},goToId:function(a,b,c){this.goTo(this._findSlideIndex(a),b,c)},preloadSlides:function(a){this._slides[a+1]&&(this._slides[a+1].loadMedia(),this._slides[a+1].scrollToTop()),this._slides[a+2]&&(this._slides[a+2].loadMedia(),this._slides[a+2].scrollToTop()),this._slides[a-1]&&(this._slides[a-1].loadMedia(),this._slides[a-1].scrollToTop()),this._slides[a-2]&&(this._slides[a-2].loadMedia(),this._slides[a-2].scrollToTop())},next:function(){var a=this._findSlideIndex(this.current_id);a+1<this._slides.length?this.goTo(a+1):this.goTo(a)},previous:function(){var a=this._findSlideIndex(this.current_id);a-1>=0?this.goTo(a-1):this.goTo(a)},showNav:function(a,b){this.options.width<=500&&TL.Browser.mobile||(b?a.show():a.hide())},changeBackground:function(a){var c,b={r:256,g:256,b:256};a.color_value&&""!=a.color_value?(b=TL.Util.hexToRgb(a.color_value),b||(trace("Invalid color value "+a.color_value),b=this.options.default_bg_color)):(b=this.options.default_bg_color,a.color_value="rgb("+b.r+" , "+b.g+", "+b.b+")"),c=b.r+","+b.g+","+b.b,this._el.background.style.backgroundImage="none",a.color_value?this._el.background.style.backgroundColor=a.color_value:this._el.background.style.backgroundColor="transparent",b.r<255||b.g<255||b.b<255||a.image?(this._nav.next.setColor(!0),this._nav.previous.setColor(!0)):(this._nav.next.setColor(!1),this._nav.previous.setColor(!1))},_updateDisplay:function(a,b,c,d){var e,f;f="undefined"==typeof d?this.options.layout:d,this.options.layout=f,this.slide_spacing=2*this.options.width,a?this.options.width=a:this.options.width=this._el.container.offsetWidth,b?this.options.height=b:this.options.height=this._el.container.offsetHeight,e=this.options.height/2,this._nav.next.setPosition({top:e}),this._nav.previous.setPosition({top:e});for(var g=0;g<this._slides.length;g++)this._slides[g].updateDisplay(this.options.width,this.options.height,f),this._slides[g].setPosition({left:this.slide_spacing*g,top:0});this.goToId(this.current_id,!0,!0)},_updateDrawSlides:function(){for(var a=this.options.layout,b=0;b<this._slides.length;b++)this._slides[b].updateDisplay(this.options.width,this.options.height,a),this._slides[b].setPosition({left:this.slide_spacing*b,top:0});this.goToId(this.current_id,!0,!1)},_initLayout:function(){TL.DomUtil.addClass(this._el.container,"tl-storyslider"),this._el.slider_container_mask=TL.Dom.create("div","tl-slider-container-mask",this._el.container),this._el.background=TL.Dom.create("div","tl-slider-background tl-animate",this._el.container),this._el.slider_container=TL.Dom.create("div","tl-slider-container tlanimate",this._el.slider_container_mask),this._el.slider_item_container=TL.Dom.create("div","tl-slider-item-container",this._el.slider_container),this.options.width=this._el.container.offsetWidth,this.options.height=this._el.container.offsetHeight,this._nav.previous=new TL.SlideNav({title:"Previous",description:"description"},{direction:"previous"}),this._nav.next=new TL.SlideNav({title:"Next",description:"description"},{direction:"next"}),this._nav.next.addTo(this._el.container),this._nav.previous.addTo(this._el.container),this._el.slider_container.style.left="0px",TL.Browser.touch&&(this._swipable=new TL.Swipable(this._el.slider_container_mask,this._el.slider_container,{enable:{x:!0,y:!1},snap:!0}),this._swipable.enable(),this._message=new TL.Message({},{message_class:"tl-message-full",message_icon_class:"tl-icon-swipe-left"}),this._message.updateMessage(this._("swipe_to_navigate")),this._message.addTo(this._el.container))},_initEvents:function(){this._nav.next.on("clicked",this._onNavigation,this),this._nav.previous.on("clicked",this._onNavigation,this),this._message&&this._message.on("clicked",this._onMessageClick,this),this._swipable&&(this._swipable.on("swipe_left",this._onNavigation,this),this._swipable.on("swipe_right",this._onNavigation,this),this._swipable.on("swipe_nodirection",this._onSwipeNoDirection,this))},_initData:function(){this.data.title&&this._createSlide(this.data.title,!0,-1),this._createSlides(this.data.events)},_onBackgroundChange:function(a){var b=this._findSlideIndex(this.current_id),c=this._slides[b].getBackground();this.changeBackground(a),this.fire("colorchange",c)},_onMessageClick:function(a){this._message.hide()},_onSwipeNoDirection:function(a){this.goToId(this.current_id)},_onNavigation:function(a){"next"==a.direction||"left"==a.direction?this.next():"previous"!=a.direction&&"right"!=a.direction||this.previous(),this.fire("nav_"+a.direction,this.data)},_onSlideAdded:function(a){trace("slideadded"),this.fire("slideAdded",this.data)},_onSlideRemoved:function(a){this.fire("slideRemoved",this.data)},_onSlideChange:function(a){a||this.fire("change",{unique_id:this.current_id})},_onMouseClick:function(a){},_fireMouseEvent:function(a){if(this._loaded){var b=a.type;b="mouseenter"===b?"mouseover":"mouseleave"===b?"mouseout":b,this.hasEventListeners(b)&&("contextmenu"===b&&TL.DomEvent.preventDefault(a),this.fire(b,{latlng:"something",layerPoint:"something else"}))}},_onLoaded:function(){this.fire("loaded",this.data)}}),TL.TimeNav=TL.Class.extend({includes:[TL.Events,TL.DomMixins],_el:{},initialize:function(a,b,c,d){this._el={parent:{},container:{},slider:{},slider_background:{},line:{},marker_container_mask:{},marker_container:{},marker_item_container:{},timeaxis:{},timeaxis_background:{},attribution:{}},this.collapsed=!1,"object"==typeof a?this._el.container=a:this._el.container=TL.Dom.get(a),this.config=b,this.options={width:600,height:600,duration:1e3,ease:TL.Ease.easeInOutQuint,has_groups:!1,optimal_tick_width:50,scale_factor:2,marker_padding:5,timenav_height_min:150,marker_height_min:30,marker_width_min:100,zoom_sequence:[.5,1,2,3,5,8,13,21,34,55,89]},this.animator=null,this.ready=!1,this._markers=[],this._eras=[],this.has_eras=!1,this._groups=[],this._calculated_row_height=100,this.current_id="",this.timescale={},this.timeaxis={},this.axishelper={},this.max_rows=6,this.animate_css=!1,this._swipable,TL.Util.mergeData(this.options,c),d&&this.init()},init:function(){this._initLayout(),this._initEvents(),this._initData(),this._updateDisplay(),this._onLoaded()},positionMarkers:function(){this._positionMarkers()},updateDisplay:function(a,b,c,d){this._updateDisplay(a,b,c,d)},_getTimeScale:function(){var a=0;try{a=parseInt(this.options.marker_height_min)}catch(b){trace("Invalid value for marker_height_min option."),a=30}return 0==a&&(trace("marker_height_min option must not be zero."),a=30),this.max_rows=Math.round((this.options.height-this._el.timeaxis_background.offsetHeight-this.options.marker_padding)/a),this.max_rows<1&&(this.max_rows=1),new TL.TimeScale(this.config,{display_width:this._el.container.offsetWidth,screen_multiplier:this.options.scale_factor,max_rows:this.max_rows})},_updateTimeScale:function(a){this.options.scale_factor=a,this._updateDrawTimeline()},zoomIn:function(){var a=TL.Util.findNextGreater(this.options.zoom_sequence,this.options.scale_factor);this.setZoomFactor(a)},zoomOut:function(){var a=TL.Util.findNextLesser(this.options.zoom_sequence,this.options.scale_factor);this.setZoomFactor(a)},setZoom:function(a){var b=this.options.zoom_sequence[a];"number"==typeof b?this.setZoomFactor(b):console.warn("Invalid zoom level. Please use an index number between 0 and "+(this.options.zoom_sequence.length-1))},setZoomFactor:function(a){a<=this.options.zoom_sequence[0]?this.fire("zoomtoggle",{zoom:"out",show:!1}):this.fire("zoomtoggle",{zoom:"out",show:!0}),a>=this.options.zoom_sequence[this.options.zoom_sequence.length-1]?this.fire("zoomtoggle",{zoom:"in",show:!1}):this.fire("zoomtoggle",{zoom:"in",show:!0}),0==a&&(console.warn("Zoom factor must be greater than zero. Using 0.1"),a=.1),this.options.scale_factor=a,this.goToId(this.current_id,!this._updateDrawTimeline(!0),!0)},_createGroups:function(){var a=this.timescale.getGroupLabels();if(a){this.options.has_groups=!0;for(var b=0;b<a.length;b++)this._createGroup(a[b])}},_createGroup:function(a){var b=new TL.TimeGroup(a);this._addGroup(b),this._groups.push(b)},_addGroup:function(a){a.addTo(this._el.container)},_positionGroups:function(){if(this.options.has_groups)for(var a=this.options.height-this._el.timeaxis_background.offsetHeight,b=Math.floor(a/this.timescale.getNumberOfRows()-this.options.marker_padding),d=(this.timescale.getGroupLabels(),0),e=0;d<this._groups.length;d++){var f=Math.floor(e*(b+this.options.marker_padding)),g=!1;f>a-this.options.marker_padding&&(g=!0),this._groups[d].setRowPosition(f,this._calculated_row_height+this.options.marker_padding/2),this._groups[d].setAlternateRowColor(TL.Util.isEven(d),g),e+=this._groups[d].data.rows}},_addMarker:function(a){a.addTo(this._el.marker_item_container),a.on("markerclick",this._onMarkerClick,this),a.on("added",this._onMarkerAdded,this)},_createMarker:function(a,b){var c=new TL.TimeMarker(a,this.options);this._addMarker(c),b<0?this._markers.push(c):this._markers.splice(b,0,c)},_createMarkers:function(a){for(var b=0;b<a.length;b++)this._createMarker(a[b],-1)},_removeMarker:function(a){a.removeFrom(this._el.marker_item_container)},_destroyMarker:function(a){this._removeMarker(this._markers[a]),this._markers.splice(a,1)},_positionMarkers:function(a){for(var b=0;b<this._markers.length;b++){var c=this.timescale.getPositionInfo(b);a?this._markers[b].setClass("tl-timemarker tl-timemarker-fast"):this._markers[b].setClass("tl-timemarker"),this._markers[b].setPosition({left:c.start}),this._markers[b].setWidth(c.width)}},_calculateMarkerHeight:function(a){return a/this.timescale.getNumberOfRows()-this.options.marker_padding},_calculateRowHeight:function(a){return a/this.timescale.getNumberOfRows()},_calculateAvailableHeight:function(){return this.options.height-this._el.timeaxis_background.offsetHeight-this.options.marker_padding},_calculateMinimumTimeNavHeight:function(){return this.timescale.getNumberOfRows()*this.options.marker_height_min+this._el.timeaxis_background.offsetHeight+this.options.marker_padding},getMinimumHeight:function(){return this._calculateMinimumTimeNavHeight()},_assignRowsToMarkers:function(){var a=this._calculateAvailableHeight(),b=this._calculateMarkerHeight(a);this._positionGroups(),this._calculated_row_height=this._calculateRowHeight(a);for(var c=0;c<this._markers.length;c++){this._markers[c].setHeight(b);var d=this.timescale.getPositionInfo(c).row,e=Math.floor(d*(b+this.options.marker_padding))+this.options.marker_padding,f=a-e+this.options.marker_padding;this._markers[c].setRowPosition(e,f)}},_resetMarkersActive:function(){for(var a=0;a<this._markers.length;a++)this._markers[a].setActive(!1)},_findMarkerIndex:function(a){var b=-1;return("string"==typeof a||a instanceof String)&&(b=TL.Util.findArrayNumberByUniqueID(a,this._markers,"unique_id",b)),b},_createEras:function(a){for(var b=0;b<a.length;b++)this._createEra(a[b],-1)},_createEra:function(a,b){var c=new TL.TimeEra(a,this.options);this._addEra(c),b<0?this._eras.push(c):this._eras.splice(b,0,c)},_addEra:function(a){a.addTo(this._el.marker_item_container),a.on("added",this._onEraAdded,this)},_removeEra:function(a){a.removeFrom(this._el.marker_item_container)},_destroyEra:function(a){this._removeEra(this._eras[a]),this._eras.splice(a,1)},_positionEras:function(a){for(var b=0,c=0;c<this._eras.length;c++){var d={start:0,end:0,width:0};d.start=this.timescale.getPosition(this._eras[c].data.start_date.getTime()),d.end=this.timescale.getPosition(this._eras[c].data.end_date.getTime()),d.width=d.end-d.start,a?this._eras[c].setClass("tl-timeera tl-timeera-fast"):this._eras[c].setClass("tl-timeera"),this._eras[c].setPosition({left:d.start}),this._eras[c].setWidth(d.width),b++,b>5&&(b=0),this._eras[c].setColor(b)}},createMarker:function(a,b){this._createMarker(a,b)},createMarkers:function(a){this._createMarkers(a)},destroyMarker:function(a){this._destroyMarker(a)},destroyMarkerId:function(a){this.destroyMarker(this._findMarkerIndex(a))},goTo:function(a,b,c){var e=this.options.ease,f=this.options.duration,g=a<0?0:a;this._resetMarkersActive(),a>=0&&a<this._markers.length&&this._markers[a].setActive(!0),this.animator&&this.animator.stop(),b?(this._el.slider.className="tl-timenav-slider",this._el.slider.style.left=-this._markers[g].getLeft()+this.options.width/2+"px"):c?(this._el.slider.className="tl-timenav-slider tl-timenav-slider-animate",this.animate_css=!0,this._el.slider.style.left=-this._markers[g].getLeft()+this.options.width/2+"px"):(this._el.slider.className="tl-timenav-slider",this.animator=TL.Animate(this._el.slider,{left:-this._markers[g].getLeft()+this.options.width/2+"px",duration:f,easing:e})),a>=0&&a<this._markers.length?this.current_id=this._markers[a].data.unique_id:this.current_id=""},goToId:function(a,b,c){this.goTo(this._findMarkerIndex(a),b,c)},_onLoaded:function(){this.ready=!0,this.fire("loaded",this.config)},_onMarkerAdded:function(a){this.fire("dateAdded",this.config)},_onEraAdded:function(a){this.fire("eraAdded",this.config)},_onMarkerRemoved:function(a){this.fire("dateRemoved",this.config)},_onMarkerClick:function(a){this.goToId(a.unique_id),this.fire("change",{unique_id:a.unique_id})},_onMouseScroll:function(a){var b=0,c=0,d={right:-(this.timescale.getPixelWidth()-this.options.width/2),left:this.options.width/2};a||(a=window.event),a.originalEvent&&(a=a.originalEvent),"undefined"!=typeof a.wheelDeltaX&&(b=a.wheelDeltaY/6,b=Math.abs(a.wheelDeltaX)>Math.abs(a.wheelDeltaY)?a.wheelDeltaX/6:0),b&&(a.preventDefault&&a.preventDefault(),a.returnValue=!1),c=parseInt(this._el.slider.style.left.replace("px",""))+b,c>d.left?c=d.left:c<d.right&&(c=d.right),this.animate_css&&(this._el.slider.className="tl-timenav-slider",this.animate_css=!1),this._el.slider.style.left=c+"px"},_onDragMove:function(a){this.animate_css&&(this._el.slider.className="tl-timenav-slider",this.animate_css=!1)},_updateDisplay:function(a,b,c){a&&(this.options.width=a),b&&b!=this.options.height&&(this.options.height=b,this.timescale=this._getTimeScale()),this._assignRowsToMarkers(),this._el.slider_background.style.width=this.timescale.getPixelWidth()+this.options.width+"px",this._el.slider_background.style.left=-(this.options.width/2)+"px",this._el.slider.style.width=this.timescale.getPixelWidth()+this.options.width+"px",this._swipable.updateConstraint({top:!1,bottom:!1,left:this.options.width/2,right:-(this.timescale.getPixelWidth()-this.options.width/2)}),this.goToId(this.current_id,!0)},_drawTimeline:function(a){this.timescale=this._getTimeScale(),this.timeaxis.drawTicks(this.timescale,this.options.optimal_tick_width),this._positionMarkers(a),this._assignRowsToMarkers(),this._createGroups(),this._positionGroups(),this.has_eras&&this._positionEras(a)},_updateDrawTimeline:function(a){var b=!1;if(a){var c=new TL.TimeScale(this.config,{display_width:this._el.container.offsetWidth,screen_multiplier:this.options.scale_factor,max_rows:this.max_rows});this.timescale.getMajorScale()==c.getMajorScale()&&this.timescale.getMinorScale()==c.getMinorScale()&&(b=!0)}else b=!0;return b?(this.timescale=this._getTimeScale(),this.timeaxis.positionTicks(this.timescale,this.options.optimal_tick_width),this._positionMarkers(),this._assignRowsToMarkers(),this._positionGroups(),this.has_eras&&this._positionEras(),this._updateDisplay()):this._drawTimeline(!0),b},_initLayout:function(){this._el.attribution=TL.Dom.create("div","tl-attribution",this._el.container),this._el.line=TL.Dom.create("div","tl-timenav-line",this._el.container),this._el.slider=TL.Dom.create("div","tl-timenav-slider",this._el.container),this._el.slider_background=TL.Dom.create("div","tl-timenav-slider-background",this._el.slider),this._el.marker_container_mask=TL.Dom.create("div","tl-timenav-container-mask",this._el.slider),this._el.marker_container=TL.Dom.create("div","tl-timenav-container",this._el.marker_container_mask),this._el.marker_item_container=TL.Dom.create("div","tl-timenav-item-container",this._el.marker_container),this._el.timeaxis=TL.Dom.create("div","tl-timeaxis",this._el.slider),this._el.timeaxis_background=TL.Dom.create("div","tl-timeaxis-background",this._el.container),this._el.attribution.innerHTML="<a href='http://timeline.knightlab.com' target='_blank'><span class='tl-knightlab-logo'></span>Timeline JS</a>",this.timeaxis=new TL.TimeAxis(this._el.timeaxis,this.options),this._swipable=new TL.Swipable(this._el.slider_background,this._el.slider,{enable:{x:!0,y:!1},constraint:{top:!1,bottom:!1,left:this.options.width/2,right:!1},snap:!1}),this._swipable.enable()},_initEvents:function(){this._swipable.on("dragmove",this._onDragMove,this),TL.DomEvent.addListener(this._el.container,"mousewheel",this._onMouseScroll,this),TL.DomEvent.addListener(this._el.container,"DOMMouseScroll",this._onMouseScroll,this)},_initData:function(){this._createMarkers(this.config.events),this.config.eras&&(this.has_eras=!0,this._createEras(this.config.eras)),this._drawTimeline()}}),TL.TimeMarker=TL.Class.extend({includes:[TL.Events,TL.DomMixins],_el:{},initialize:function(a,b){this._el={container:{},content_container:{},media_container:{},timespan:{},line_left:{},line_right:{},content:{},text:{},media:{}},this._text={},this._state={loaded:!1},this.data={unique_id:"",background:null,date:{year:0,month:0,day:0,hour:0,minute:0,second:0,millisecond:0,thumbnail:"",format:""},text:{headline:"",text:""},media:null},this.options={duration:1e3,ease:TL.Ease.easeInSpline,width:600,height:600,marker_width_min:100},this.active=!1,this.animator={},this.has_end_date=!1,TL.Util.mergeData(this.options,b),TL.Util.mergeData(this.data,a),this._initLayout(),this._initEvents()},show:function(){},hide:function(){},setActive:function(a){this.active=a,this.active&&this.has_end_date?this._el.container.className="tl-timemarker tl-timemarker-with-end tl-timemarker-active":this.active?this._el.container.className="tl-timemarker tl-timemarker-active":this.has_end_date?this._el.container.className="tl-timemarker tl-timemarker-with-end":this._el.container.className="tl-timemarker"},addTo:function(a){a.appendChild(this._el.container)},removeFrom:function(a){a.removeChild(this._el.container)},updateDisplay:function(a,b){this._updateDisplay(a,b)},loadMedia:function(){this._media&&!this._state.loaded&&(this._media.loadMedia(),this._state.loaded=!0)},stopMedia:function(){this._media&&this._state.loaded&&this._media.stopMedia()},getLeft:function(){return this._el.container.style.left.slice(0,-2)},getTime:function(){return this.data.start_date.getTime()},getEndTime:function(){return!!this.data.end_date&&this.data.end_date.getTime()},setHeight:function(a){var b=12,c=1;this._el.content_container.style.height=a+"px",this._el.timespan_content.style.height=a+"px",a<=30?this._el.content.className="tl-timemarker-content tl-timemarker-content-small":this._el.content.className="tl-timemarker-content",a<=56?TL.DomUtil.addClass(this._el.content_container,"tl-timemarker-content-container-small"):TL.DomUtil.removeClass(this._el.content_container,"tl-timemarker-content-container-small"),TL.Browser.webkit?(c=Math.floor(a/(b+2)),c<1&&(c=1),this._text.className="tl-headline",this._text.style.webkitLineClamp=c):(c=a/b,c>1?this._text.className="tl-headline tl-headline-fadeout":this._text.className="tl-headline",this._text.style.height=c*b+"px")},setWidth:function(a){this.data.end_date&&(this._el.container.style.width=a+"px",a>this.options.marker_width_min?(this._el.content_container.style.width=a+"px",this._el.content_container.className="tl-timemarker-content-container tl-timemarker-content-container-long"):(this._el.content_container.style.width=this.options.marker_width_min+"px",this._el.content_container.className="tl-timemarker-content-container"))},setClass:function(a){this._el.container.className=a},setRowPosition:function(a,b){this.setPosition({top:a}),this._el.timespan.style.height=b+"px"},_onMarkerClick:function(a){this.fire("markerclick",{unique_id:this.data.unique_id})},_initLayout:function(){if(this._el.container=TL.Dom.create("div","tl-timemarker"),this.data.unique_id&&(this._el.container.id=this.data.unique_id+"-marker"),this.data.end_date&&(this.has_end_date=!0,this._el.container.className="tl-timemarker tl-timemarker-with-end"),this._el.timespan=TL.Dom.create("div","tl-timemarker-timespan",this._el.container),this._el.timespan_content=TL.Dom.create("div","tl-timemarker-timespan-content",this._el.timespan),this._el.content_container=TL.Dom.create("div","tl-timemarker-content-container",this._el.container),this._el.content=TL.Dom.create("div","tl-timemarker-content",this._el.content_container),this._el.line_left=TL.Dom.create("div","tl-timemarker-line-left",this._el.timespan),this._el.line_right=TL.Dom.create("div","tl-timemarker-line-right",this._el.timespan),this.data.media){this._el.media_container=TL.Dom.create("div","tl-timemarker-media-container",this._el.content);var a={url:this.data.media.thumbnail},b=this.data.media.thumbnail?TL.MediaType(a,!0):null;if(b){var c=new b.cls(a);c.on("loaded",function(){this._el.media=TL.Dom.create("img","tl-timemarker-media",this._el.media_container),
this._el.media.src=c.getImageURL()}.bind(this)),c.loadMedia()}else{var d=TL.MediaType(this.data.media).type;this._el.media=TL.Dom.create("span","tl-icon-"+d,this._el.media_container)}}this._el.text=TL.Dom.create("div","tl-timemarker-text",this._el.content),this._text=TL.Dom.create("h2","tl-headline",this._el.text),this.data.text.headline&&""!=this.data.text.headline?this._text.innerHTML=TL.Util.unlinkify(this.data.text.headline):this.data.text.text&&""!=this.data.text.text?this._text.innerHTML=TL.Util.unlinkify(this.data.text.text):this.data.media.caption&&""!=this.data.media.caption&&(this._text.innerHTML=TL.Util.unlinkify(this.data.media.caption)),this.onLoaded()},_initEvents:function(){TL.DomEvent.addListener(this._el.container,"click",this._onMarkerClick,this)},_updateDisplay:function(a,b,c){a&&(this.options.width=a),b&&(this.options.height=b)}}),TL.TimeEra=TL.Class.extend({includes:[TL.Events,TL.DomMixins],_el:{},initialize:function(a,b){this._el={container:{},background:{},content_container:{},content:{},text:{}},this._text={},this._state={loaded:!1},this.data={unique_id:"",date:{year:0,month:0,day:0,hour:0,minute:0,second:0,millisecond:0,thumbnail:"",format:""},text:{headline:"",text:""}},this.options={duration:1e3,ease:TL.Ease.easeInSpline,width:600,height:600,marker_width_min:100},this.active=!1,this.animator={},this.has_end_date=!1,TL.Util.mergeData(this.options,b),TL.Util.mergeData(this.data,a),this._initLayout(),this._initEvents()},show:function(){},hide:function(){},setActive:function(a){},addTo:function(a){a.appendChild(this._el.container)},removeFrom:function(a){a.removeChild(this._el.container)},updateDisplay:function(a,b){this._updateDisplay(a,b)},getLeft:function(){return this._el.container.style.left.slice(0,-2)},getTime:function(){return this.data.start_date.getTime()},getEndTime:function(){return!!this.data.end_date&&this.data.end_date.getTime()},setHeight:function(a){var b=12,c=1;this._el.content_container.style.height=a+"px",this._el.content.className="tl-timeera-content",TL.Browser.webkit?(c=Math.floor(a/(b+2)),c<1&&(c=1),this._text.className="tl-headline",this._text.style.webkitLineClamp=c):(c=a/b,c>1?this._text.className="tl-headline tl-headline-fadeout":this._text.className="tl-headline",this._text.style.height=c*b+"px")},setWidth:function(a){this.data.end_date&&(this._el.container.style.width=a+"px",a>this.options.marker_width_min?(this._el.content_container.style.width=a+"px",this._el.content_container.className="tl-timeera-content-container tl-timeera-content-container-long"):(this._el.content_container.style.width=this.options.marker_width_min+"px",this._el.content_container.className="tl-timeera-content-container"))},setClass:function(a){this._el.container.className=a},setRowPosition:function(a,b){this.setPosition({top:a})},setColor:function(a){this._el.container.className="tl-timeera tl-timeera-color"+a},_initLayout:function(){this._el.container=TL.Dom.create("div","tl-timeera"),this.data.unique_id&&(this._el.container.id=this.data.unique_id+"-era"),this.data.end_date&&(this.has_end_date=!0,this._el.container.className="tl-timeera tl-timeera-with-end"),this._el.content_container=TL.Dom.create("div","tl-timeera-content-container",this._el.container),this._el.background=TL.Dom.create("div","tl-timeera-background",this._el.content_container),this._el.content=TL.Dom.create("div","tl-timeera-content",this._el.content_container),this._el.text=TL.Dom.create("div","tl-timeera-text",this._el.content),this._text=TL.Dom.create("h2","tl-headline",this._el.text),this.data.text.headline&&""!=this.data.text.headline&&(this._text.innerHTML=TL.Util.unlinkify(this.data.text.headline)),this.onLoaded()},_initEvents:function(){},_updateDisplay:function(a,b,c){a&&(this.options.width=a),b&&(this.options.height=b)}}),TL.TimeGroup=TL.Class.extend({includes:[TL.Events,TL.DomMixins],_el:{},initialize:function(a){this._el={parent:{},container:{},message:{}},this.options={width:600,height:600},this.data={label:"",rows:1},this._el.container=TL.Dom.create("div","tl-timegroup"),TL.Util.mergeData(this.data,a),this.animator={},this._initLayout(),this._initEvents()},updateDisplay:function(a,b){},setRowPosition:function(a,b){this.options.height=b*this.data.rows,this.setPosition({top:a}),this._el.container.style.height=this.options.height+"px"},setAlternateRowColor:function(a,b){var c="tl-timegroup";a&&(c+=" tl-timegroup-alternate"),b&&(c+=" tl-timegroup-hidden"),this._el.container.className=c},_onMouseClick:function(){this.fire("clicked",this.options)},_initLayout:function(){this._el.message=TL.Dom.create("div","tl-timegroup-message",this._el.container),this._el.message.innerHTML=this.data.label},_initEvents:function(){TL.DomEvent.addListener(this._el.container,"click",this._onMouseClick,this)},_updateDisplay:function(a,b,c){}}),TL.TimeScale=TL.Class.extend({initialize:function(a,b){var c=a.events;this._scale=a.scale,b=TL.Util.mergeData({display_width:500,screen_multiplier:3,max_rows:null},b),this._display_width=b.display_width,this._screen_multiplier=b.screen_multiplier,this._pixel_width=this._screen_multiplier*this._display_width,this._group_labels=void 0,this._positions=[],this._pixels_per_milli=0,this._earliest=a.getEarliestDate().getTime(),this._latest=a.getLatestDate().getTime(),this._span_in_millis=this._latest-this._earliest,this._span_in_millis<=0&&(this._span_in_millis=this._computeDefaultSpan(a)),this._average=this._span_in_millis/c.length,this._pixels_per_milli=this.getPixelWidth()/this._span_in_millis,this._axis_helper=TL.AxisHelper.getBestHelper(this),this._scaled_padding=1/this.getPixelsPerTick()*(this._display_width/2),this._computePositionInfo(c,b.max_rows)},_computeDefaultSpan:function(a){if("human"==a.scale){for(var b={},c=0;c<a.events.length;c++){var d=a.events[c].start_date.findBestFormat();b[d]=b[d]?b[d]+1:1}for(var c=TL.Date.SCALES.length-1;c>=0;c--)if(b.hasOwnProperty(TL.Date.SCALES[c][0])){var e=TL.Date.SCALES[TL.Date.SCALES.length-1];return TL.Date.SCALES[c+1]&&(e=TL.Date.SCALES[c+1]),e[1]}return 31536e6}return 2e5},getGroupLabels:function(){return this._group_labels||[]},getScale:function(){return this._scale},getNumberOfRows:function(){return this._number_of_rows},getPixelWidth:function(){return this._pixel_width},getPosition:function(a){return(a-this._earliest)*this._pixels_per_milli},getPositionInfo:function(a){return this._positions[a]},getPixelsPerTick:function(){return this._axis_helper.getPixelsPerTick(this._pixels_per_milli)},getTicks:function(){return{major:this._axis_helper.getMajorTicks(this),minor:this._axis_helper.getMinorTicks(this)}},getDateFromTime:function(a){if("human"==this._scale)return new TL.Date(a);if("cosmological"==this._scale)return new TL.BigDate(new TL.BigYear(a));throw new TL.Error("time_scale_scale_err",this._scale)},getMajorScale:function(){return this._axis_helper.major.name},getMinorScale:function(){return this._axis_helper.minor.name},_assessGroups:function(a){for(var b=[],c=!1,d=0;d<a.length;d++)a[d].group&&(b.indexOf(a[d].group)<0?b.push(a[d].group):c=!0);return b.length&&c&&b.push(""),b},_computeRowInfo:function(a,b){for(var c=[],d=0,e=0;e<a.length;e++){var f=a[e],g=[];delete f.row;for(var h=0;h<c.length;h++)if(g.push(c[h].end-f.start),g[h]<=0){f.row=h,c[h]=f;break}if("undefined"==typeof f.row)if(null===b)f.row=c.length,c.push(f);else if(b>0)f.row=c.length,c.push(f),b--;else{var i=Math.min.apply(null,g),j=g.indexOf(i);f.row=j,f.end>c[j].end&&(c[j]=f),d++}}return{n_rows:c.length,n_overlaps:d}},_computePositionInfo:function(a,b,c){c=c||100;for(var d=[],e=!1,f=0;f<a.length;f++){var g={start:this.getPosition(a[f].start_date.getTime())};if(this._positions.push(g),"undefined"!=typeof a[f].end_date){var h=this.getPosition(a[f].end_date.getTime());g.width=h-g.start,g.width>c?g.end=g.start+g.width:g.end=g.start+c}else g.width=c,g.end=g.start+c;a[f].group?d.indexOf(a[f].group)<0&&d.push(a[f].group):e=!0}if(d.length){e&&d.push("");for(var j=[],f=0;f<d.length;f++)j[f]={label:d[f],idx:f,positions:[],n_rows:1,n_overlaps:0};for(var f=0;f<this._positions.length;f++){var g=this._positions[f];g.group=d.indexOf(a[f].group||""),g.row=0;for(var k=j[g.group],l=k.positions.length-1;l>=0;l--)k.positions[l].end>g.start&&k.n_overlaps++;k.positions.push(g)}for(var m=d.length;;){var n=Math.max(0,b-m);if(!n)break;if(j.sort(function(a,b){return a.n_overlaps>b.n_overlaps?-1:a.n_overlaps<b.n_overlaps?1:a.idx-b.idx}),!j[0].n_overlaps)break;for(var m=0,f=0;f<j.length;f++){var k=j[f];if(k.n_overlaps&&n){var o=this._computeRowInfo(k.positions,k.n_rows+1);k.n_rows=o.n_rows,k.n_overlaps=o.n_overlaps,n--}m+=k.n_rows}}this._number_of_rows=m,this._group_labels=[],j.sort(function(a,b){return a.idx-b.idx});for(var f=0,p=0;f<j.length;f++){this._group_labels.push({label:j[f].label,rows:j[f].n_rows});for(var l=0;l<j[f].positions.length;l++){var g=j[f].positions[l];g.row+=p}p+=j[f].n_rows}}else{var i=this._computeRowInfo(this._positions,b);this._number_of_rows=i.n_rows}}}),TL.TimeAxis=TL.Class.extend({includes:[TL.Events,TL.DomMixins,TL.I18NMixins],_el:{},initialize:function(a,b){this._el={container:{},content_container:{},major:{},minor:{}},this._text={},this._state={loaded:!1},this.data={},this.options={duration:1e3,ease:TL.Ease.easeInSpline,width:600,height:600},this.active=!1,this.animator={},this.axis_helper={},this.minor_ticks=[],this.major_ticks=[],this.dateformat_lookup={millisecond:"time_milliseconds",second:"time_short",minute:"time_no_seconds_short",hour:"time_no_minutes_short",day:"full_short",month:"month_short",year:"year",decade:"year",century:"year",millennium:"year",age:"compact",epoch:"compact",era:"compact",eon:"compact",eon2:"compact"},"object"==typeof a?this._el.container=a:this._el.container=TL.Dom.get(a),TL.Util.mergeData(this.options,b),this._initLayout(),this._initEvents()},show:function(){},hide:function(){},addTo:function(a){a.appendChild(this._el.container)},removeFrom:function(a){a.removeChild(this._el.container)},updateDisplay:function(a,b){this._updateDisplay(a,b)},getLeft:function(){return this._el.container.style.left.slice(0,-2)},drawTicks:function(a,b){var c=a.getTicks();({minor:{el:this._el.minor,dateformat:this.dateformat_lookup[c.minor.name],ts_ticks:c.minor.ticks,tick_elements:this.minor_ticks},major:{el:this._el.major,dateformat:this.dateformat_lookup[c.major.name],ts_ticks:c.major.ticks,tick_elements:this.major_ticks}});this._el.major.className="tl-timeaxis-major",this._el.minor.className="tl-timeaxis-minor",this._el.major.style.opacity=0,this._el.minor.style.opacity=0,this.major_ticks=this._createTickElements(c.major.ticks,this._el.major,this.dateformat_lookup[c.major.name]),this.minor_ticks=this._createTickElements(c.minor.ticks,this._el.minor,this.dateformat_lookup[c.minor.name],c.major.ticks),this.positionTicks(a,b,!0),this._el.major.className="tl-timeaxis-major tl-animate-opacity tl-timeaxis-animate-opacity",this._el.minor.className="tl-timeaxis-minor tl-animate-opacity tl-timeaxis-animate-opacity",this._el.major.style.opacity=1,this._el.minor.style.opacity=1},_createTickElements:function(a,b,c,d){b.innerHTML="";var e={};if(d)for(var f=0;f<d.length;f++)e[d[f].getTime()]=!0;for(var g=[],f=0;f<a.length;f++){var h=a[f];if(!(h.getTime()in e)){var i=TL.Dom.create("div","tl-timeaxis-tick",b),j=TL.Dom.create("span","tl-timeaxis-tick-text tl-animate-opacity",i);j.innerHTML=h.getDisplayDate(this.getLanguage(),c),g.push({tick:i,tick_text:j,display_date:h.getDisplayDate(this.getLanguage(),c),date:h})}}return g},positionTicks:function(a,b,c){c?(this._el.major.className="tl-timeaxis-major",this._el.minor.className="tl-timeaxis-minor"):(this._el.major.className="tl-timeaxis-major tl-timeaxis-animate",this._el.minor.className="tl-timeaxis-minor tl-timeaxis-animate"),this._positionTickArray(this.major_ticks,a,b),this._positionTickArray(this.minor_ticks,a,b)},_positionTickArray:function(a,b,c){if(a[1]&&a[0]){var d=b.getPosition(a[1].date.getMillisecond())-b.getPosition(a[0].date.getMillisecond()),e=1;d<c&&(e=Math.round(c/b.getPixelsPerTick()));for(var f=1,g=0;g<a.length;g++){var h=a[g];h.tick.style.left=b.getPosition(h.date.getMillisecond())+"px",h.tick_text.innerHTML=h.display_date,e>1?f>=e?(f=1,h.tick_text.style.opacity=1,h.tick.className="tl-timeaxis-tick"):(f++,h.tick_text.style.opacity=0,h.tick.className="tl-timeaxis-tick tl-timeaxis-tick-hidden"):(h.tick_text.style.opacity=1,h.tick.className="tl-timeaxis-tick")}}},_initLayout:function(){this._el.content_container=TL.Dom.create("div","tl-timeaxis-content-container",this._el.container),this._el.major=TL.Dom.create("div","tl-timeaxis-major",this._el.content_container),this._el.minor=TL.Dom.create("div","tl-timeaxis-minor",this._el.content_container),this.onLoaded()},_initEvents:function(){},_updateDisplay:function(a,b,c){a&&(this.options.width=a),b&&(this.options.height=b)}}),TL.AxisHelper=TL.Class.extend({initialize:function(a){if(!a)throw new TL.Error("axis_helper_no_options_err");this.scale=a.scale,this.minor=a.minor,this.major=a.major},getPixelsPerTick:function(a){return a*this.minor.factor},getMajorTicks:function(a){return this._getTicks(a,this.major)},getMinorTicks:function(a){return this._getTicks(a,this.minor)},_getTicks:function(a,b){for(var c=a._scaled_padding*b.factor,d=a._earliest-c,e=a._latest+c,f=[],g=d;g<e;g+=b.factor)f.push(a.getDateFromTime(g).floor(b.name));return{name:b.name,ticks:f}}}),function(a){var b={},c=function(c,d){b[c]=[];for(var e=0;e<d.length-1;e++){var f=d[e],g=d[e+1];b[c].push(new a({scale:f[3],minor:{name:f[0],factor:f[1]},major:{name:g[0],factor:g[1]}}))}};c("human",TL.Date.SCALES),c("cosmological",TL.BigDate.SCALES),a.HELPERS=b,a.getBestHelper=function(a,c){"number"!=typeof c&&(c=100);var d=a.getScale(),e=b[d];if(!e)throw new TL.Error("axis_helper_scale_err",d);for(var f=null,g=0;g<e.length;g++){var h=e[g],i=h.getPixelsPerTick(a._pixels_per_milli);if(i>c){if(null==f)return h;var j=Math.abs(c-i),k=Math.abs(c-i);return j<k?h:f}f=h}return e[e.length-1]}}(TL.AxisHelper),TL.Timeline=TL.Class.extend({includes:[TL.Events,TL.I18NMixins],initialize:function(a,b,c){var d=this;if(c||(c={}),this.version="3.2.6",this.ready=!1,this._el={container:{},storyslider:{},timenav:{},menubar:{}},"object"==typeof a?this._el.container=a:this._el.container=TL.Dom.get(a),this._storyslider={},this._style_sheet=new TL.StyleSheet,this._timenav={},this._menubar={},this._loaded={storyslider:!1,timenav:!1},this.config=null,this.options={script_path:"",height:this._el.container.offsetHeight,width:this._el.container.offsetWidth,debug:!1,is_embed:!1,is_full_embed:!1,hash_bookmark:!1,default_bg_color:{r:255,g:255,b:255},scale_factor:2,layout:"landscape",timenav_position:"bottom",optimal_tick_width:60,base_class:"tl-timeline",timenav_height:null,timenav_height_percentage:25,timenav_mobile_height_percentage:40,timenav_height_min:175,marker_height_min:30,marker_width_min:100,marker_padding:5,start_at_slide:0,start_at_end:!1,menubar_height:0,skinny_size:650,medium_size:800,relative_date:!1,use_bc:!1,duration:1e3,ease:TL.Ease.easeInOutQuint,dragging:!0,trackResize:!0,map_type:"stamen:toner-lite",slide_padding_lr:100,slide_default_fade:"0%",zoom_sequence:[.5,1,2,3,5,8,13,21,34,55,89],language:"en",ga_property_id:null,track_events:["back_to_start","nav_next","nav_previous","zoom_in","zoom_out"]},this.animator_timenav=null,this.animator_storyslider=null,this.animator_menubar=null,this.message=new TL.Message({},{message_class:"tl-message-full"},this._el.container),"string"==typeof c.default_bg_color){var e=TL.Util.hexToRgb(c.default_bg_color);e?c.default_bg_color=e:(delete c.default_bg_color,trace("Invalid default background color. Ignoring."))}TL.Util.mergeData(this.options,c),window.addEventListener("resize",function(a){d.updateDisplay()}),TL.debug=this.options.debug,TL.DomUtil.addClass(this._el.container,"tl-timeline"),this.options.is_embed&&TL.DomUtil.addClass(this._el.container,"tl-timeline-embed"),this.options.is_full_embed&&TL.DomUtil.addClass(this._el.container,"tl-timeline-full-embed"),this.options.relative_date?"undefined"!=typeof moment?d._loadLanguage(b):TL.Load.js(this.options.script_path+"/library/moment.js",function(){d._loadLanguage(b),trace("LOAD MOMENTJS")}):d._loadLanguage(b)},_translateError:function(a){return a.hasOwnProperty("stack")&&trace(a.stack),a.message_key?this._(a.message_key)+(a.detail?" ["+a.detail+"]":""):a},_loadLanguage:function(a){try{this.options.language=new TL.Language(this.options),this._initData(a)}catch(a){this.showMessage(this._translateError(a))}},goToId:function(a){this.current_id!=a&&(this.current_id=a,this._timenav.goToId(this.current_id),this._storyslider.goToId(this.current_id,!1,!0),this.fire("change",{unique_id:this.current_id},this))},goTo:function(a){this.config.title?0==a?this.goToId(this.config.title.unique_id):this.goToId(this.config.events[a-1].unique_id):this.goToId(this.config.events[a].unique_id)},goToStart:function(){this.goTo(0)},goToEnd:function(){var a=this.config.events.length-1;this.goTo(this.config.title?a+1:a)},goToPrev:function(){this.goTo(this._getSlideIndex(this.current_id)-1)},goToNext:function(){this.goTo(this._getSlideIndex(this.current_id)+1)},add:function(a){var b=this.config.addEvent(a),c=this._getEventIndex(b),d=this.config.events[c];this._storyslider.createSlide(d,this.config.title?c+1:c),this._storyslider._updateDrawSlides(),this._timenav.createMarker(d,c),this._timenav._updateDrawTimeline(!1),this.fire("added",{unique_id:b})},remove:function(a){if(a>=0&&a<this.config.events.length){this.config.events[a].unique_id==this.current_id&&(a<this.config.events.length-1?this.goTo(a+1):this.goTo(a-1));var b=this.config.events.splice(a,1);delete this.config.event_dict[b[0].unique_id],this._storyslider.destroySlide(this.config.title?a+1:a),this._storyslider._updateDrawSlides(),this._timenav.destroyMarker(a),this._timenav._updateDrawTimeline(!1),this.fire("removed",{unique_id:b[0].unique_id})}},removeId:function(a){this.remove(this._getEventIndex(a))},getData:function(a){if(this.config.title){if(0==a)return this.config.title;if(a>0&&a<=this.config.events.length)return this.config.events[a-1]}else if(a>=0&&a<this.config.events.length)return this.config.events[a];return null},getDataById:function(a){return this.getData(this._getSlideIndex(a))},getSlide:function(a){return a>=0&&a<this._storyslider._slides.length?this._storyslider._slides[a]:null},getSlideById:function(a){return this.getSlide(this._getSlideIndex(a))},getCurrentSlide:function(){return this.getSlideById(this.current_id)},updateDisplay:function(){this.ready&&this._updateDisplay()},_calculateTimeNavHeight:function(a,b){var c=0;return a?c=a:(this.options.timenav_height_percentage||b)&&(c=b?Math.round(this.options.height/100*b):Math.round(this.options.height/100*this.options.timenav_height_percentage)),this._timenav.ready&&this.options.timenav_height_min<this._timenav.getMinimumHeight()&&(this.options.timenav_height_min=this._timenav.getMinimumHeight()),c<this.options.timenav_height_min&&(c=this.options.timenav_height_min),c-=2*this.options.marker_padding},_updateDisplay:function(a,b,c){var d=this.options.duration,e=this.options.base_class,f=0;c&&(d=c),this.options.width=this._el.container.offsetWidth,this.options.height=this._el.container.offsetHeight,this.options.width<=this.options.skinny_size?(e+=" tl-skinny",this.options.layout="portrait"):this.options.width<=this.options.medium_size?(e+=" tl-medium",this.options.layout="landscape"):this.options.layout="landscape",TL.Browser.touch&&(this.options.layout=TL.Browser.orientation()),TL.Browser.mobile?(e+=" tl-mobile",this.options.timenav_height=this._calculateTimeNavHeight(a,this.options.timenav_mobile_height_percentage)):this.options.timenav_height=this._calculateTimeNavHeight(a),e+="portrait"==this.options.layout?" tl-layout-portrait":" tl-layout-landscape",this.options.storyslider_height=this.options.height-this.options.timenav_height,f="top"==this.options.timenav_position?Math.ceil(this.options.timenav_height)/2-this._el.menubar.offsetHeight/2-19.5:Math.round(this.options.storyslider_height+1+Math.ceil(this.options.timenav_height)/2-this._el.menubar.offsetHeight/2-17.5),b?(this._el.timenav.style.height=Math.ceil(this.options.timenav_height)+"px",this.animator_storyslider&&this.animator_storyslider.stop(),this.animator_storyslider=TL.Animate(this._el.storyslider,{height:this.options.storyslider_height+"px",duration:d/2,easing:TL.Ease.easeOutStrong}),this.animator_menubar&&this.animator_menubar.stop(),this.animator_menubar=TL.Animate(this._el.menubar,{top:f+"px",duration:d/2,easing:TL.Ease.easeOutStrong})):(this._el.timenav.style.height=Math.ceil(this.options.timenav_height)+"px",this._el.storyslider.style.height=this.options.storyslider_height+"px",this._el.menubar.style.top=f+"px"),this.message&&this.message.updateDisplay(this.options.width,this.options.height),this._timenav.updateDisplay(this.options.width,this.options.timenav_height,b),this._storyslider.updateDisplay(this.options.width,this.options.storyslider_height,b,this.options.layout),"rtl"==this.options.language.direction&&(e+=" tl-rtl"),this._el.container.className=e},_updateHashBookmark:function(a){var b="#event-"+a.toString();"file:"!=window.location.protocol&&window.history.replaceState(null,"Browsing TimelineJS",b),this.fire("hash_updated",{unique_id:this.current_id,hashbookmark:"#event-"+a.toString()},this)},_initData:function(a){var b=this;if("string"==typeof a){var b=this;TL.ConfigFactory.makeConfig(a,function(a){b.setConfig(a)})}else TL.TimelineConfig==a.constructor?this.setConfig(a):this.setConfig(new TL.TimelineConfig(a))},setConfig:function(a){if(this.config=a,this.config.validate(),this._validateOptions(),this.config.isValid())try{this._onDataLoaded()}catch(a){this.showMessage("<strong>"+this._("error")+":</strong> "+this._translateError(a))}else{for(var b=[],c=0,d=this.config.getErrors();c<d.length;c++)b.push(this._translateError(d[c]));this.showMessage("<strong>"+this._("error")+":</strong> "+b.join("<br>"))}},_validateOptions:function(){for(var a=["timenav_height","timenav_height_min","marker_height_min","marker_width_min","marker_padding","start_at_slide","slide_padding_lr"],b=0;b<a.length;b++){var c=a[b],d=this.options[c];valid=!0,"number"==typeof d?valid=d==parseInt(d):"string"==typeof d&&(valid=d.match(/^\s*(\-?\d+)?\s*$/)),valid||this.config.logError({message_key:"invalid_integer_option",detail:c})}},_initLayout:function(){this.message.removeFrom(this._el.container),this._el.container.innerHTML="","top"==this.options.timenav_position?(this._el.timenav=TL.Dom.create("div","tl-timenav",this._el.container),this._el.storyslider=TL.Dom.create("div","tl-storyslider",this._el.container)):(this._el.storyslider=TL.Dom.create("div","tl-storyslider",this._el.container),this._el.timenav=TL.Dom.create("div","tl-timenav",this._el.container)),this._el.menubar=TL.Dom.create("div","tl-menubar",this._el.container),this.options.width=this._el.container.offsetWidth,this.options.height=this._el.container.offsetHeight,this._el.storyslider.style.top="1px",this.options.timenav_height=this._calculateTimeNavHeight(this.options.timenav_height),this._timenav=new TL.TimeNav(this._el.timenav,this.config,this.options),this._timenav.on("loaded",this._onTimeNavLoaded,this),this._timenav.on("update_timenav_min",this._updateTimeNavHeightMin,this),this._timenav.options.height=this.options.timenav_height,this._timenav.init(),this.options.initial_zoom&&this.setZoom(this.options.initial_zoom),this._storyslider=new TL.StorySlider(this._el.storyslider,this.config,this.options),this._storyslider.on("loaded",this._onStorySliderLoaded,this),this._storyslider.init(),this._menubar=new TL.MenuBar(this._el.menubar,this._el.container,this.options),"portrait"==this.options.layout?this.options.storyslider_height=this.options.height-this.options.timenav_height-1:this.options.storyslider_height=this.options.height-1,this._updateDisplay(this._timenav.options.height,!0,2e3)},_initEvents:function(){this._timenav.on("change",this._onTimeNavChange,this),this._timenav.on("zoomtoggle",this._onZoomToggle,this),this._storyslider.on("change",this._onSlideChange,this),this._storyslider.on("colorchange",this._onColorChange,this),this._storyslider.on("nav_next",this._onStorySliderNext,this),this._storyslider.on("nav_previous",this._onStorySliderPrevious,this),this._menubar.on("zoom_in",this._onZoomIn,this),this._menubar.on("zoom_out",this._onZoomOut,this),this._menubar.on("back_to_start",this._onBackToStart,this)},_initGoogleAnalytics:function(){!function(a,b,c,d,e,f,g){a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",this.options.ga_property_id,"auto")},_initAnalytics:function(){if(null!==this.options.ga_property_id){this._initGoogleAnalytics(),ga("send","pageview");var a=this.options.track_events;for(i=0;i<a.length;i++){var b=a[i];this.addEventListener(b,function(a){ga("send","event",a.type,"clicked")})}}},_onZoomToggle:function(a){"in"==a.zoom?this._menubar.toogleZoomIn(a.show):"out"==a.zoom&&this._menubar.toogleZoomOut(a.show)},_getEventIndex:function(a){for(var b=0;b<this.config.events.length;b++)if(a==this.config.events[b].unique_id)return b;return-1},_getSlideIndex:function(a){if(this.config.title&&this.config.title.unique_id==a)return 0;for(var b=0;b<this.config.events.length;b++)if(a==this.config.events[b].unique_id)return this.config.title?b+1:b;return-1},_onDataLoaded:function(a){this.fire("dataloaded"),this._initLayout(),this._initEvents(),this._initAnalytics(),this.message&&this.message.hide(),this.ready=!0},showMessage:function(a){this.message?this.message.updateMessage(a):(trace("No message display available."),trace(a))},_onColorChange:function(a){this.fire("color_change",{unique_id:this.current_id},this),a.color||a.image},_onSlideChange:function(a){this.current_id!=a.unique_id&&(this.current_id=a.unique_id,this._timenav.goToId(this.current_id),this._onChange(a))},_onTimeNavChange:function(a){this.current_id!=a.unique_id&&(this.current_id=a.unique_id,this._storyslider.goToId(this.current_id),this._onChange(a))},_onChange:function(a){this.fire("change",{unique_id:this.current_id},this),this.options.hash_bookmark&&this.current_id&&this._updateHashBookmark(this.current_id)},_onBackToStart:function(a){this._storyslider.goTo(0),this.fire("back_to_start",{unique_id:this.current_id},this)},zoomIn:function(){this._timenav.zoomIn()},zoomOut:function(){this._timenav.zoomOut()},setZoom:function(a){this._timenav.setZoom(a)},_onZoomIn:function(a){this._timenav.zoomIn(),this.fire("zoom_in",{zoom_level:this._timenav.options.scale_factor},this)},_onZoomOut:function(a){this._timenav.zoomOut(),this.fire("zoom_out",{zoom_level:this._timenav.options.scale_factor},this)},_onTimeNavLoaded:function(){this._loaded.timenav=!0,this._onLoaded()},_onStorySliderLoaded:function(){this._loaded.storyslider=!0,this._onLoaded()},_onStorySliderNext:function(a){this.fire("nav_next",a)},_onStorySliderPrevious:function(a){this.fire("nav_previous",a)},_onLoaded:function(){this._loaded.storyslider&&this._loaded.timenav&&(this.fire("loaded",this.config),this.options.hash_bookmark&&""!=window.location.hash?this.goToId(window.location.hash.replace("#event-","")):(TL.Util.isTrue(this.options.start_at_end)||this.options.start_at_slide>this.config.events.length?this.goToEnd():this.goTo(this.options.start_at_slide),this.options.hash_bookmark&&this._updateHashBookmark(this.current_id)))}}),TL.Timeline.source_path=function(){var a=document.getElementsByTagName("script"),b=a[a.length-1].src;return b.substr(0,b.lastIndexOf("/"))}();